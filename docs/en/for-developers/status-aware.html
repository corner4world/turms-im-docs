<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>业务模型状态感知 | Turms Documentation</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/docs/assets/css/0.styles.7540e094.css" as="style"><link rel="preload" href="/docs/assets/js/app.0f70b506.js" as="script"><link rel="preload" href="/docs/assets/js/2.5e4175dd.js" as="script"><link rel="preload" href="/docs/assets/js/30.bc7c7100.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.d6c8656f.js"><link rel="prefetch" href="/docs/assets/js/100.cc7c829a.js"><link rel="prefetch" href="/docs/assets/js/101.ec582e6f.js"><link rel="prefetch" href="/docs/assets/js/102.58360eb1.js"><link rel="prefetch" href="/docs/assets/js/103.c8556f04.js"><link rel="prefetch" href="/docs/assets/js/104.020f5751.js"><link rel="prefetch" href="/docs/assets/js/105.ed19eef0.js"><link rel="prefetch" href="/docs/assets/js/106.27fb4984.js"><link rel="prefetch" href="/docs/assets/js/107.01863b4c.js"><link rel="prefetch" href="/docs/assets/js/108.4d0e7df6.js"><link rel="prefetch" href="/docs/assets/js/109.0cd74806.js"><link rel="prefetch" href="/docs/assets/js/11.daea0053.js"><link rel="prefetch" href="/docs/assets/js/110.d6d729d5.js"><link rel="prefetch" href="/docs/assets/js/111.454e1dad.js"><link rel="prefetch" href="/docs/assets/js/112.b0e35dc7.js"><link rel="prefetch" href="/docs/assets/js/113.d7d1a8e0.js"><link rel="prefetch" href="/docs/assets/js/12.81bc6399.js"><link rel="prefetch" href="/docs/assets/js/13.7d9b39ca.js"><link rel="prefetch" href="/docs/assets/js/14.3aaeddf0.js"><link rel="prefetch" href="/docs/assets/js/15.16de0dfb.js"><link rel="prefetch" href="/docs/assets/js/16.006c2611.js"><link rel="prefetch" href="/docs/assets/js/17.81763b28.js"><link rel="prefetch" href="/docs/assets/js/18.d112a6ee.js"><link rel="prefetch" href="/docs/assets/js/19.9d2774b4.js"><link rel="prefetch" href="/docs/assets/js/20.4144ba26.js"><link rel="prefetch" href="/docs/assets/js/21.72bfd7f6.js"><link rel="prefetch" href="/docs/assets/js/22.a001b5cd.js"><link rel="prefetch" href="/docs/assets/js/23.6edad22c.js"><link rel="prefetch" href="/docs/assets/js/24.17250e6f.js"><link rel="prefetch" href="/docs/assets/js/25.7c0422b3.js"><link rel="prefetch" href="/docs/assets/js/26.6e7239a8.js"><link rel="prefetch" href="/docs/assets/js/27.dc800fcb.js"><link rel="prefetch" href="/docs/assets/js/28.8ebd9bb6.js"><link rel="prefetch" href="/docs/assets/js/29.d95f9df0.js"><link rel="prefetch" href="/docs/assets/js/3.3b03183a.js"><link rel="prefetch" href="/docs/assets/js/31.169ac06a.js"><link rel="prefetch" href="/docs/assets/js/32.9a1ed1eb.js"><link rel="prefetch" href="/docs/assets/js/33.72d7054b.js"><link rel="prefetch" href="/docs/assets/js/34.9100ca91.js"><link rel="prefetch" href="/docs/assets/js/35.a2ae9ff1.js"><link rel="prefetch" href="/docs/assets/js/36.daa2d584.js"><link rel="prefetch" href="/docs/assets/js/37.4ec9a7f5.js"><link rel="prefetch" href="/docs/assets/js/38.d3f78676.js"><link rel="prefetch" href="/docs/assets/js/39.a6e8f8b4.js"><link rel="prefetch" href="/docs/assets/js/4.9507d158.js"><link rel="prefetch" href="/docs/assets/js/40.d7469ea4.js"><link rel="prefetch" href="/docs/assets/js/41.adea4556.js"><link rel="prefetch" href="/docs/assets/js/42.e9da53c2.js"><link rel="prefetch" href="/docs/assets/js/43.39f0758d.js"><link rel="prefetch" href="/docs/assets/js/44.515fe088.js"><link rel="prefetch" href="/docs/assets/js/45.37956431.js"><link rel="prefetch" href="/docs/assets/js/46.91dbf187.js"><link rel="prefetch" href="/docs/assets/js/47.ca2a5aa9.js"><link rel="prefetch" href="/docs/assets/js/48.7a5f1f46.js"><link rel="prefetch" href="/docs/assets/js/49.b404bd5c.js"><link rel="prefetch" href="/docs/assets/js/5.0f823acb.js"><link rel="prefetch" href="/docs/assets/js/50.5668ae05.js"><link rel="prefetch" href="/docs/assets/js/51.5e053c4e.js"><link rel="prefetch" href="/docs/assets/js/52.2afea2e2.js"><link rel="prefetch" href="/docs/assets/js/53.5accbc9e.js"><link rel="prefetch" href="/docs/assets/js/54.2a5ba01d.js"><link rel="prefetch" href="/docs/assets/js/55.9ef54d8f.js"><link rel="prefetch" href="/docs/assets/js/56.7d591826.js"><link rel="prefetch" href="/docs/assets/js/57.0cc5c0bc.js"><link rel="prefetch" href="/docs/assets/js/58.075dfa5b.js"><link rel="prefetch" href="/docs/assets/js/59.76a7c549.js"><link rel="prefetch" href="/docs/assets/js/6.7d874ae4.js"><link rel="prefetch" href="/docs/assets/js/60.27ce2db2.js"><link rel="prefetch" href="/docs/assets/js/61.d584d6c6.js"><link rel="prefetch" href="/docs/assets/js/62.0e23b57f.js"><link rel="prefetch" href="/docs/assets/js/63.83f9f4d5.js"><link rel="prefetch" href="/docs/assets/js/64.c050940e.js"><link rel="prefetch" href="/docs/assets/js/65.c203e026.js"><link rel="prefetch" href="/docs/assets/js/66.5d857982.js"><link rel="prefetch" href="/docs/assets/js/67.d02be9bb.js"><link rel="prefetch" href="/docs/assets/js/68.140c0bbb.js"><link rel="prefetch" href="/docs/assets/js/69.c3050be0.js"><link rel="prefetch" href="/docs/assets/js/7.0f14e2bf.js"><link rel="prefetch" href="/docs/assets/js/70.f8170f65.js"><link rel="prefetch" href="/docs/assets/js/71.d764e05b.js"><link rel="prefetch" href="/docs/assets/js/72.080a4d9a.js"><link rel="prefetch" href="/docs/assets/js/73.d3705e1e.js"><link rel="prefetch" href="/docs/assets/js/74.f480acab.js"><link rel="prefetch" href="/docs/assets/js/75.c3901bf3.js"><link rel="prefetch" href="/docs/assets/js/76.6eeadd66.js"><link rel="prefetch" href="/docs/assets/js/77.ae703399.js"><link rel="prefetch" href="/docs/assets/js/78.ce563b01.js"><link rel="prefetch" href="/docs/assets/js/79.781c647f.js"><link rel="prefetch" href="/docs/assets/js/8.278ce3cd.js"><link rel="prefetch" href="/docs/assets/js/80.29fe21ec.js"><link rel="prefetch" href="/docs/assets/js/81.71bc432a.js"><link rel="prefetch" href="/docs/assets/js/82.fd662024.js"><link rel="prefetch" href="/docs/assets/js/83.8e53bbe1.js"><link rel="prefetch" href="/docs/assets/js/84.e9112df7.js"><link rel="prefetch" href="/docs/assets/js/85.05930827.js"><link rel="prefetch" href="/docs/assets/js/86.255fe70f.js"><link rel="prefetch" href="/docs/assets/js/87.598484ef.js"><link rel="prefetch" href="/docs/assets/js/88.10d15680.js"><link rel="prefetch" href="/docs/assets/js/89.03b78d5d.js"><link rel="prefetch" href="/docs/assets/js/9.f7738123.js"><link rel="prefetch" href="/docs/assets/js/90.f723a548.js"><link rel="prefetch" href="/docs/assets/js/91.8f3c96e5.js"><link rel="prefetch" href="/docs/assets/js/92.1ad8379a.js"><link rel="prefetch" href="/docs/assets/js/93.64b1b951.js"><link rel="prefetch" href="/docs/assets/js/94.08c0d459.js"><link rel="prefetch" href="/docs/assets/js/95.13aacca2.js"><link rel="prefetch" href="/docs/assets/js/96.c2ac7433.js"><link rel="prefetch" href="/docs/assets/js/97.114acece.js"><link rel="prefetch" href="/docs/assets/js/98.1bea52b5.js"><link rel="prefetch" href="/docs/assets/js/99.62681aac.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.7540e094.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Turms Documentation</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/turms-im/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/turms-im/docs" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>介绍</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/intro/" class="sidebar-link">/intro/</a></li><li><a href="/docs/intro/features.html" class="sidebar-link">特性</a></li><li><a href="/docs/intro/redevelopment.html" class="sidebar-link">关于二次开发</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>业务功能</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/features/" class="sidebar-link">业务功能介绍</a></li><li><a href="/docs/features/simultaneous-login.html" class="sidebar-link">多端登录</a></li><li><a href="/docs/features/user.html" class="sidebar-link">用户相关功能</a></li><li><a href="/docs/features/group.html" class="sidebar-link">群组相关功能</a></li><li><a href="/docs/features/message.html" class="sidebar-link">消息相关功能</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>开发者文档</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/for-developers/quick-start.html" class="sidebar-link">Quick Start</a></li><li><a href="/docs/for-developers/architecture.html" class="sidebar-link">架构设计</a></li><li><a href="/docs/for-developers/config.html" class="sidebar-link">配置参数</a></li><li><a href="/docs/for-developers/admin-api.html" class="sidebar-link">管理员API接口</a></li><li><a href="/docs/for-developers/client-api.html" class="sidebar-link">客户端接口</a></li><li><a href="/docs/for-developers/status-code.html" class="sidebar-link">状态码</a></li><li><a href="/docs/for-developers/status-aware.html" class="sidebar-link">状态感知</a></li><li><a href="/docs/for-developers/custom-plugin.html" class="sidebar-link">自定义插件</a></li><li><a href="/docs/for-developers/schema.html" class="sidebar-link">集合结构设计</a></li><li><a href="/docs/for-developers/data-analytics.html" class="sidebar-link">数据分析</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="业务模型状态感知"><a href="#业务模型状态感知" class="header-anchor">#</a> 业务模型状态感知</h1> <p>为了让用户能感知业务模型状态的变化（增删改），Turms搭配使用了服务端主动通知机制与客户端主动拉取机制（支持版本控制），以在实时性与资源消耗之间取得平衡，并让开发者能够自行调整实时性与资源消耗之间的权重。</p> <h2 id="感知方式"><a href="#感知方式" class="header-anchor">#</a> 感知方式</h2> <h3 id="方式一-服务端主动通知机制"><a href="#方式一-服务端主动通知机制" class="header-anchor">#</a> 方式一：服务端主动通知机制</h3> <p>通知机制指的是：当某个业务模型发生变化时（由于增删改操作），服务端将主动通知相关在线用户该事件的发生。而当客户端收到通知时，Turms客户端会触发NotificationService中的onNotification回调函数。该函数的参数为TurmsRequest对象，表明触发该事件的请求。</p> <p>通知相关行为可以根据：im.turms.server.common.property.env.service.business.NotificationProperties 类进行配置。每一种通知类型都可以单独配置，并且所有通知相关配置均可在集群运行时进行动态更新。</p> <h4 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h4> <p>以im.turms.turms.property.business.Notification#notifyMembersAfterGroupUpdate这个属性为例。该属性用于控制“当群组信息发生变化时，是否通知群组成员”。这里的群组信息指的是：群组名称、群组类型、群组禁言时间等这样具有全局性的群组信息。</p> <p>如果您将该属性值设置为true，则当群组信息发生变化时，群组成员的客户端都将收到触发该变化的通知。否则，群组成员客户端不会收到任何通知。</p> <h4 id="评价"><a href="#评价" class="header-anchor">#</a> 评价</h4> <p>通知机制可以保证通知能实时地传递给相关用户，但其缺点就在于它很容易导致无意义的资源消耗（以具体业务场景为准）。比如用户A已经加入了100个群组，但该用户平时只查看其中3个群组的信息。这种场景下，如果100个群组的所有状态变化都开启了通知机制，则不管是服务端还是客户端都需要浪费大量资源去处理这些无意义的通知（因为该用户从来不看这些通知）。</p> <p>为了解决该类问题，以及满足其他常见需求（如：要求当时离线的用户在上线时也能检测到业务模型是否发生变化；要求在线用户在通知被关闭的情况下也能感知业务模型的变化），Turms还提供了客户端主动拉取机制（支持版本控制）让用户来感知业务模型的变化。</p> <h3 id="方式二-客户端主动拉取机制-支持版本控制"><a href="#方式二-客户端主动拉取机制-支持版本控制" class="header-anchor">#</a> 方式二：客户端主动拉取机制（支持版本控制）</h3> <p>注意：<strong>Turms当前只支持全量更新的场景。对于需要增量更新的业务场景（如：秒级更新的动态群组成员列表），Turms会尽早予以支持。</strong></p> <p>为了弥补上述提到的服务端主动通知机制的不足，Turms还提供了客户端主动拉取机制（支持版本控制）。</p> <h4 id="大概实现"><a href="#大概实现" class="header-anchor">#</a> 大概实现</h4> <p>Turms的每个业务模型都带有一个版本信息，这个版本信息记录了该业务模型最后一次更新的时间。当客户端向服务端请求资源时，可以携带客户端最后一次更新该业务模型的时间（也可以不带），Turms服务端会对这个版本信息与当前业务模型的版本信息进行比对，如果客户端发来的版本信息早于当前业务模型的版本信息，则Turms服务端会返回最新的业务模型数据，否则抛出状态码NO_CONTENT，在客户端处则会收到空数据。</p> <h4 id="常见拉取时机"><a href="#常见拉取时机" class="header-anchor">#</a> 常见拉取时机</h4> <ul><li>当您的应用被切换到前台时</li> <li>会话重新连接上时</li> <li>根据具体业务而定（看下文实例）</li></ul> <h4 id="示例-2"><a href="#示例-2" class="header-anchor">#</a> 示例</h4> <p>继续以上述的案例为例。假设我们希望群组成员之间能够实时感知其他群组成员资料信息的变化。那如果我们采用通知机制，假设每个群除了用户A还有其他100名在线用户，则用户A的资料信息变化，需要向其他10000（100*100）名群组成员发送通知，这在实际运用中是绝对不可取的。</p> <p>在实际运用中，通常会在特定时机，比如用户打开某名用户的个人信息UI页面时，才让客户端主动请求服务端该用户的信息。同时，通过版本对比，减少无意义的资源浪费。</p> <p>这种时刻注意实时性与资源消耗的设计要牢记在心中，以免设计出不切实际的应用场景。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/docs/assets/js/app.0f70b506.js" defer></script><script src="/docs/assets/js/2.5e4175dd.js" defer></script><script src="/docs/assets/js/30.bc7c7100.js" defer></script>
  </body>
</html>
