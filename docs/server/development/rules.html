<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Basic Development Rules | Turms Documentation</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.2.0">
    <link rel="preload stylesheet" href="/docs/assets/style.BHGQ7U4S.css" as="style">
    
    <script type="module" src="/docs/assets/app.5bekgGnH.js"></script>
    <link rel="preload" href="/docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/docs/assets/chunks/framework.ViWktWD6.js">
    <link rel="modulepreload" href="/docs/assets/chunks/theme.PziOlW20.js">
    <link rel="modulepreload" href="/docs/assets/server_development_rules.md.CB4MA8-Z.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar top" data-v-ae24b3ad data-v-ccf7ddec><div class="wrapper" data-v-ccf7ddec><div class="container" data-v-ccf7ddec><div class="title" data-v-ccf7ddec><div class="VPNavBarTitle has-sidebar" data-v-ccf7ddec data-v-ab179fa1><a class="title" href="/docs/" data-v-ab179fa1><!--[--><!--]--><!--[--><img class="VPImage logo" src="https://raw.githubusercontent.com/turms-im/assets/master/logo/pegion.svg" alt data-v-8426fc1a><!--]--><span data-v-ab179fa1>Turms Documentation</span><!--[--><!--]--></a></div></div><div class="content" data-v-ccf7ddec><div class="content-body" data-v-ccf7ddec><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ccf7ddec><!--[--><!----><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><!----><div class="VPFlyout VPNavBarTranslations translations" data-v-ccf7ddec data-v-88af2de4 data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><span class="vpi-languages option-icon" data-v-b6c34ac9></span><!----><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><div class="items" data-v-88af2de4><p class="title" data-v-88af2de4>English</p><!--[--><div class="VPMenuLink" data-v-88af2de4 data-v-43f1e123><a class="VPLink link" href="/docs/zh-CN/server/development/rules.html" data-v-43f1e123><!--[-->简体中文<!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-ccf7ddec data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ccf7ddec data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/turms-im/turms" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ccf7ddec data-v-d0bd9dde data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><div class="group translations" data-v-d0bd9dde><p class="trans-title" data-v-d0bd9dde>English</p><!--[--><div class="VPMenuLink" data-v-d0bd9dde data-v-43f1e123><a class="VPLink link" href="/docs/zh-CN/server/development/rules.html" data-v-43f1e123><!--[-->简体中文<!--]--></a></div><!--]--></div><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/turms-im/turms" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ccf7ddec data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-ccf7ddec><div class="divider-line" data-v-ccf7ddec></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-b8d55f3b><!----><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/index.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Introduction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/community/index.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Community FAQ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible collapsed" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Business Features</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/feature/index.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Business Features</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/feature/simultaneous-login.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Simultaneous Login</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/feature/user.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>User-related Features</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/feature/group.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Group-related Features</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/feature/message.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Message-related Features</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible collapsed" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Design</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/design/architecture.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Architecture Design</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/design/schema.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Collection Schema Design</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/design/status-aware.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Status Awareness</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible has-active" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Server Guide</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><section class="VPSidebarItem level-1" data-v-b8d55f3b data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h3 class="text" data-v-b8d55f3b>Deployment</h3><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/deployment/getting-started.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Build and Start</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/deployment/distribution.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Distribution</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/deployment/config.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Configuration</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 has-active" data-v-b8d55f3b data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h3 class="text" data-v-b8d55f3b>Development</h3><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/development/customization.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>About Custom Development</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/development/rules.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Basic Development Rules</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/development/plugin.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Custom Plugins</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/development/code.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Source Code</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/development/testing.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Testing</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-b8d55f3b data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h3 class="text" data-v-b8d55f3b>Main Modules</h3><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/identity-access-management.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Identity and Access Management</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/cluster.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Cluster Design and Implementation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/system-resource-management.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>System Resource Management</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/observability.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Observability</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/security.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Security</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/xmpp.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>XMPP</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/storage.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Storage Service</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/chatbot.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Chatbot</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/anti-spam.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Content Moderation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/data-analytics.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Data Analysis</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible collapsed" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Client Guide</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/quick-start.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Quick Start</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/requirements.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Version Requirements</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/api.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/session.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Session Lifecycle</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/metrics.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Metrics</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/communication-protocol.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Communication Protocol Used Between Client and Server</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/turms-client-js.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>turms-client-js Shared Context</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/turms-chat-demo.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Turms Chat Demo</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-b8d55f3b><!----><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/turms-admin.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>turms-admin</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible collapsed" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Reference</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/reference/admin-api.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Admin API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/reference/status-code.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Status Code</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-269c27a6><div class="content" data-v-269c27a6><div class="outline-marker" data-v-269c27a6></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-269c27a6>On this page</div><ul class="VPDocOutlineItem root" data-v-269c27a6 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _docs_server_development_rules" data-v-39a288b8><div><h1 id="basic-development-rules" tabindex="-1">Basic Development Rules <a class="header-anchor" href="#basic-development-rules" aria-label="Permalink to &quot;Basic Development Rules&quot;">​</a></h1><h2 id="conservative-design-vs-radical-design" tabindex="-1">Conservative Design vs. Radical Design <a class="header-anchor" href="#conservative-design-vs-radical-design" aria-label="Permalink to &quot;Conservative Design vs. Radical Design&quot;">​</a></h2><p>Java itself is a very conservative language, and its ecology is also very conservative. Its design principle is to &quot;provide a set of safe APIs, and how Java users use these APIs will not cause Java internal errors&quot; (except for Unsafe classes), so various access control mechanisms, internal memory copies and repeated locking are provided. The code writing principle of the Turms server is generally &quot;How to run the program fast, how to write. As long as the Caller dares to pass or use data indiscriminately, we will report an error or ignore it directly.&quot; For example, <code>StringUtil</code> of Turms uses <code>jdk.internal.misc.Unsafe#getReference</code> to obtain the <code>byte[]</code> object inside the <code>String</code> object to avoid memory copying, and the Caller needs to ensure that it does not &quot;do anything wrong&quot;. The <code>String#getBytes()</code> provided by Java itself is to ensure that the user cannot modify the internal <code>byte[]</code>, so the <code>byte[]</code> object is copied and passed to the Caller.</p><p>Therefore, in the practice of strings, for a conventional Spring-based Web application, after an HTTP request is cut from the TCP byte stream, it may need to be repeated in <code>String</code>, <code>StringBuilder</code>, <code>byte[]</code>, <code> HeapByteBuffer</code>, <code>DirectByteBuffer</code> and other data are switched and spliced. Finally, it is very common for a String type object on the business level to be copied 5 to 30 times by third-party libraries and Java internally.</p><p>Taking a specific application as an example, if we use Spring to create a Controller Bean, and define an API function with a return value type of <code>String</code> in it, so as to return the measurement data in Prometheus format through this API. If we do the &quot;most elegant&quot; writing method under this premise, we need to make at least 4 memory copies of this memory object (excluding the part where the system kernel brushes data to the network card; Turms is optimized and only needs to do one memory copy: that is, the heap Memory to off-heap memory; the actual size of this measurement data is about 8K):</p><ol><li>Write the basic data of Java into <code>StringBuilder</code>, at this time heap memory -&gt; heap memory copy</li><li>StringBuilder#toString(), another heap memory copy</li><li>String#getBytes(), at least another heap memory copy</li><li>Write byte[] to the off-heap memory DirectByteBuffer to hand over to the system kernel for writing data operations</li></ol><p>The effective memory usage rate is extremely low, and note that the above is only the simplest API String response function, and the process involved in the actual application is more complicated, so it is very common for a string to be copied 5 to 30 times after a process things. Therefore, we often see that when an HTTP server is built based on the mainstream ecology of its language, the memory used by a conventional Java Web application may be tens or even hundreds of times that of its equivalent C++ HTTP server.</p><p>In addition to various network APIs, log implementations also need to deal frequently with <code>String</code>. In terms of memory, Turms is much more efficient than general-purpose implementations. Turms directly allocates cached off-heap memory through <code>PooledByteBufAllocator.DEFAULT</code>, and directly writes Java basic data into off-heap memory blocks. And throughout the process, we avoid using Java&#39;s own inefficient implementation, thereby avoiding meaningless heap-to-heap memory copies.</p><p>In summary, although Java itself is relatively conservative, Turms is relatively radical, and prioritizes performance rather than &quot;elegant code&quot;, and makes good use of Unsafe classes when necessary. Of course, our &quot;radical&quot; is also limited, such as: 1. Never replace the Java internal class implementation; 2. Try not to write JNI and C language code</p><p>Replenish:</p><ol><li>For the practice of Java syntax sugar level, our attitude is &quot;relatively indifferent&quot;, such as <code>for (X x : Collection&lt;X&gt;)</code> (need to create an iterator object, consume at least dozens of B) and more efficient <code>for (int i = 0; i &lt; length; i++)</code>, both are allowed</li><li>In addition to the conservative tendency, there is also a very paradoxical phenomenon in the Java circle, that is, &quot;selective neglect during optimization&quot;. A <code>String</code> is copied dozens of times. On the other hand, study JVM memory optimization on a budget. Turms faces various optimization items, mainly based on &quot;cost-effectiveness&quot;, prioritizing the parts with high cost-effectiveness, so as to avoid trying to find fish.</li></ol><h2 id="basic-protocol-for-server-side-development" tabindex="-1">Basic protocol for server-side development <a class="header-anchor" href="#basic-protocol-for-server-side-development" aria-label="Permalink to &quot;Basic protocol for server-side development&quot;">​</a></h2><h3 id="prioritization-of-coding-strategies" tabindex="-1">Prioritization of coding strategies <a class="header-anchor" href="#prioritization-of-coding-strategies" aria-label="Permalink to &quot;Prioritization of coding strategies&quot;">​</a></h3><p>General rules: performance (low time and space complexity) &gt; code readability &gt; design patterns</p><ul><li>Performance &gt; Code readability. For example, use <code>long</code> instead of <code>java.util.Date</code> or <code>java.time.Instant</code> to represent time to avoid creating new objects and calculations during time conversion; another example is <code>im.turms.server.common. The </code>nextIncreasingId<code>function and</code>nextLargeGapId<code> function under the infra.cluster.service.idgen.SnowflakeIdGenerator</code> class repeat about 10 lines of code, but we do not extract this common code to avoid opening up a new method stack (regardless of JVM lag Inline operation).</li><li>Performance &gt; Design Mode. Such as the scene: <ul><li>Iterate over the <code>char[]</code> elements in <code>String</code>. If you use the chain of responsibility mode, you need to use different Handler classes to implement different types of processing logic. Although this can make the logic clear, each Handler needs to traverse <code>char[]</code>, so the time complexity of processing It is <code>O(n*m)</code> (n is the length of char[], and m is the number of Handlers). Codes of this complexity are prohibited in the Turms server code. At this time, it is necessary to write the code in an anti-design mode, write the processing logic in one traversal as much as possible, and try not to open a new function to distinguish logic (this is optional), but use comments to divide different processing logic to avoid function stack overhead.</li><li>The efficient design of the Protobuf model has always been praised, but the code implementation of the official Java version of Protobuf is conservative and inefficient. For example, the Protobuf model is Immutable, and only its Builder is Mutable. Therefore, if you want to modify the Protobuf model, you must first <code>toBuilder()</code> into a Builder, and then recreate a new Protobuf model instance. The effective memory usage rate is low (additional supplement : Its string decoding implementation is also very inefficient. For example, in order to be compatible with lower versions of Java, it uses <code>char[]</code> for encoding, but the String of the new version of Java only stores <code>byte[]</code> inside, so an additional type conversion). And our controllable code is to use the Builder without the Builder to avoid meaningless memory consumption.</li></ul></li></ul><p>Exception: As in rare cases, code readability takes precedence over performance. Take the &quot;Prohibition of using reflection during the processing of client requests and admin API requests&quot; mentioned in the article as an example. Despite this rule, if the request needs to create an Entity object for use by the database driver, then we will still create and populate this object through reflection. Because if you don&#39;t use reflection, you need to write hundreds of field serialization and deserialization logics by hand, which is a huge workload and error-prone. The profitability of using reflection is very high, so reflection is allowed.</p><p>There are many more examples of the above, see the Turms server code for details. When adding new code, just make sure that there is hardly any room for time or space optimization in the newly added code. If there is still room for optimization, but the benefits are low and the implementation is complex, allow for later optimization.</p><h4 id="threads-and-locks" tabindex="-1">Threads and locks <a class="header-anchor" href="#threads-and-locks" aria-label="Permalink to &quot;Threads and locks&quot;">​</a></h4><ul><li><p>The use of elastic thread pools is prohibited, creating new threads requires a dedicated code review</p></li><li><p>Try not to use synchronized and Lock operations (including reentrant locks) during the processing of client requests and admin API requests. If a critical section is really needed, priority should be given to refactoring the code flow or replacing it with CAS technology.</p></li></ul><h4 id="memory-and-gc" tabindex="-1">Memory and GC <a class="header-anchor" href="#memory-and-gc" aria-label="Permalink to &quot;Memory and GC&quot;">​</a></h4><ul><li><p>Prohibit copying of ByteBuf</p></li><li><p>For network I/O operations, the use of non-pooled or heap memory is prohibited, only pooled direct memory is allowed</p></li><li><p>Try not to create new objects, try to use the object pool. As is common in design: In order to logically separate the data models of different layers, the DTO and BO models are specially disassembled. For this scenario, Turms will try to use a data model and implement a response that conforms to the DTO model by customizing Jackson&#39;s serialization logic</p><p>Also: this rule will change after Project Valhalla is released, in particular we will be removing most of the existing object pools</p></li><li><p>Try not to create objects with multiple unused fields. For example, Turms reconstructed MongoDB&#39;s <code>FindOptions</code> model with a custom <code>QueryOptions</code> model. One of the reasons is that the <code>FindOptions</code> model is frequently used, but it has dozens of useless fields.</p></li><li><p>During the processing of client requests and admin API requests, the use of Stream is prohibited</p></li><li><p>Regarding the question of &quot;why some functions that seem to be able to use primitive parameters still use wrapper classes&quot;. Wrapper classes are still used because: although some parameters in a function may seem to be able to use primitives, in fact, these primitives will eventually be passed to Java collection class implementations with a high probability (such as <code>Map&lt;Long, Object&gt;</code>). Functions that accept objects (such as <code>Object</code> types, <code>Long</code> types, generics, etc.) or Object fields as classes, etc. Therefore, if a function just uses primitives on its own, after the entire logic is processed, this primitive is likely to be repeatedly converted between the wrapper class and the primitive many times. To sum up, in most cases, the Turms server uniformly uses wrapper classes to avoid such multiple conversions. Only when we can guarantee that the primitive will not be converted into a wrapper class, we will use the primitive uniformly.</p><p>In addition, this is why we are in <a href="https://turms-im.github.io/docs/server/module/system-resource-management#%E5%85%B3%E4%BA%8Evalhalla%E9%A1%B9%E7%9B%AE" target="_blank" rel="noreferrer">About the Valhalla project</a> said that the design concept of &quot;everything is an object&quot; &quot;lingers like a curse&quot;. It is difficult for a primitive not to be converted into a package in complex logic. Classes, meaningless objects waste a lot of memory, which is why we&#39;ve been waiting for the Valhalla project to finalize wrapper classes and support features like the <code>List&lt;int&gt;</code> type.</p></li></ul><h4 id="proxy-and-reflection" tabindex="-1">Proxy and Reflection <a class="header-anchor" href="#proxy-and-reflection" aria-label="Permalink to &quot;Proxy and Reflection&quot;">​</a></h4><ul><li><p>Do not use dynamic proxy technology (such as Java dynamic proxy, CGLib, Spring AOP, etc.), try not to use proxy or use static compilation technology instead (such as Lombok).</p><p>The only exception: In the plug-in mechanism of the Turms server, Java&#39;s dynamic proxy is used to proxy plug-ins written in JavaScript.</p></li><li><p>During the processing of client requests and admin API requests, unless you need to write a lot of complicated code without using reflection, the use of reflection technology is prohibited in other scenarios. For example: Turms uses reflection when serializing and deserializing hundreds of fields of MongoDB&#39;s Entity model.</p></li></ul><p>In addition, if there is a third-party dependency that violates the above principles, the third-party dependency will be refactored according to the cost-effectiveness schedule.</p><h3 id="text-format" tabindex="-1">text format <a class="header-anchor" href="#text-format" aria-label="Permalink to &quot;text format&quot;">​</a></h3><h4 id="tostring-text-format" tabindex="-1">toString() text format <a class="header-anchor" href="#tostring-text-format" aria-label="Permalink to &quot;toString() text format&quot;">​</a></h4><p>The text format implemented by the Java project <code>toString()</code> is varied, and even the internal code of Java itself has many text formats with inconsistent styles. As far as the bracket style is concerned, there are not only the default <code>[key=value]</code> format of Java record, but also the <code>(key=value)</code> format generated by Lombok, and the <code>{key=value}</code> format generated by Google AutoValue.</p><p>In order to achieve a unified text format, the Turms server project uniformly adopts the following format:</p><ul><li><p>For the prefix and suffix of the text, use <code>{</code> and <code>}</code> respectively, instead of <code>[]</code> or <code>()</code>. Because in the text format design of Turms, <code>[]</code> refers to an array, and <code>()</code> refers to a special mark to make important information more eye-catching. For specific rules, see <code>Server operation log and exception text format</code> below.</p></li><li><p>Use the mainstream <code>=</code> instead of <code>:</code> between keys and values.</p></li><li><p>For string values, you need to use <code>&quot;&quot;</code> to wrap the value; for other non-array values, use the <code>toString()</code> form of the value; for array values, use <code>[]</code> to include the value in the array .</p><p>For example: <code>ClassName{key1=value, key2=[value1, value2]}</code></p></li></ul><p>**Note: The Turms server has not yet unified the text format of <code>toString()</code>, but the content described above is the direction of improvement in the future. **</p><h4 id="server-running-log-and-exception-text-format" tabindex="-1">Server running log and exception text format <a class="header-anchor" href="#server-running-log-and-exception-text-format" aria-label="Permalink to &quot;Server running log and exception text format&quot;">​</a></h4><p>Because there are many details in the text format design of logs and exceptions, and the principles of many common practices are in conflict with each other, and there is no unified best practice in the Java field, almost all large and medium-sized open source projects (including Java itself) source code) cannot achieve a unified text format, but a mix of various text formats, and the specific format depends mainly on the current &quot;feeling&quot; of the engineer.</p><p>Therefore, this section specifically explains which text formats the Turms server uses, and why some other common text formats are not used, so as to reduce readers&#39; confusion in practice.</p><h5 id="the-importance-of-a-uniform-format" tabindex="-1">The Importance of a Uniform Format <a class="header-anchor" href="#the-importance-of-a-uniform-format" aria-label="Permalink to &quot;The Importance of a Uniform Format&quot;">​</a></h5><p>For some text formatting rules, readers may not feel the difference between the rules when reading a single log. But when readers need to read dozens, even hundreds, or thousands of different logs, they can understand how much energy saving in reading using a standardized and unified text format.</p><h5 id="specific-rules" tabindex="-1">specific rules <a class="header-anchor" href="#specific-rules" aria-label="Permalink to &quot;specific rules&quot;">​</a></h5><p>simply put:</p><ul><li>Important information in the text should be put in the end of the sentence as much as possible. Vital information is usually a variable.</li><li>When the important information is at the end of the sentence, you need to use <code>:</code> to separate the important information from other texts. For example: use <code>Could not find the class: my.company.Main</code> instead of <code>The class (my.company.Main) could not be found</code>.</li><li>Sentences do not need to omit the articles <code>a</code>, <code>an</code> and <code>the</code>. This point is especially emphasized because most well-known large and medium-sized open source projects tend to omit articles.</li><li>For noun phrases, restrictive appositions are usually used instead of attributive nouns. For example, restrictive appositions: <code>The collection &quot;messasge&quot;</code> or <code>The setting &quot;turms.whatever.min&quot;</code>; attributive nouns: <code>The &quot;messasge&quot; collection</code> and <code>The &quot;turms.whatever.min&quot; setting</code>.</li><li>Function and use of special symbols:</li></ul><table><thead><tr><th>Role</th><th>Symbols used</th><th>In a sentence</th><th>When paired with <code>: </code></th><th>When paired with an array</th><th>Common examples</th></tr></thead><tbody><tr><td>Represents an array value</td><td><code>[,]</code></td><td>Use <code>[value]</code> format. <br>Such as <code>Detected illegal operations [CREATE, DELETE] on the collection &quot;message&quot;</code></td><td>use <code>: [value]</code> format. <br>Such as <code>Detected illegal operations: [CREATE, DELETE]</code></td><td></td><td></td></tr><tr><td>Indicates interval</td><td><code>[..]</code> closed interval, <code>(..)</code> open interval</td><td>such as: <code>[1..2]</code>, ``</td><td></td><td></td><td></td></tr><tr><td>Wrap information that needs to be specially separated for eye-catching</td><td><code>()</code></td><td>Use the <code>(value)</code> format. <br>Such as <code>The path (/turms/1.txt/) is illegal</code></td><td>No need to use <code>()</code>, just use <code>: value</code> format. <br>Such as <code>Could not find any resource from the path: /turms/1.txt</code></td><td>No need to use <code>()</code>, just use <code>[value]</code> format. <br>Such as <code>The paths [/1.txt, /2.txt] are illegal</code></td><td>object, enumeration value, path, domain name, field reference</td></tr><tr><td>Wrap key-value pairs</td><td><code>{}</code></td><td>Use <code>{key=value}</code> format. <br>Example</td><td>use <code>: {key=value}</code> format</td><td>use <code>[{key=value}, {key=value}]</code> format</td><td></td></tr><tr><td>Package name or string value</td><td><code>&quot;&quot;</code></td><td>Use <code>&quot;value&quot;</code> format. <br>Such as <code>The property &quot;turms.whatever.min&quot; must be greater than 0</code>; <code>The setting name &quot;abc123&quot; should not contain any digit</code></td><td>use <code>: &quot;value&quot;</code> format. <br>Such as <code>Unknown property: &quot;turms.whatever.min&quot;</code></td><td>use <code>[&quot;value&quot;, &quot;value&quot;]</code> format. <br>Such as <code>The properties [&quot;turms.whatever.min&quot;, &quot;turms.whatever.max&quot;] are unknown</code></td><td>field name, parameter name, database collection name</td></tr></tbody></table><ul><li><p>Difference between name and reference</p><p>Let’s give a relatively easy-to-understand example first. Take the field name and reference as an example. Suppose there is a field <code>name</code> in a class <code>com.abc.Song</code> (song), then the name of the field is <code>name</code>, When the name is used in a sentence, double quotes <code>&quot;&quot;</code> are required, such as <code>The field &quot;name&quot; contains illegal characters</code>. The reference of the field is <code>com.abc.Song#name</code>, and when the reference is used in a sentence, parentheses <code>()</code> are required, such as <code>The field (com.abc.Song#name) should be accessible</code>.</p><p>But in the actual development process, we will find that many strings themselves can have multiple interpretations. For example, if there is a class whose name is <code>com.my.Main</code>, then this name can be interpreted as either a <code>class name</code> or a <code>class reference</code>. And considering that the class name will not have the serious ambiguity that may be brought about by the above-mentioned <code>name</code>, and the practice of most well-known open source projects of CUHK does not use <code>&quot;&quot;</code> to wrap the class name, so for the class name, when designing Turms, It is uniformly interpreted as a <code>class reference</code> rather than a <code>class name</code>, so this type of reference needs to follow the usage rules of <code>()</code>, not the usage rules of <code>&quot;&quot;</code>.</p></li></ul><p>The next section will explain why Turms is designed this way, and why some other common designs are not used.</p><p><strong>TODO: Update later</strong></p><h2 id="about-the-use-of-dependent-libraries" tabindex="-1">About the use of dependent libraries <a class="header-anchor" href="#about-the-use-of-dependent-libraries" aria-label="Permalink to &quot;About the use of dependent libraries&quot;">​</a></h2><p>Many dependency libraries are keen to abstract and encapsulate the underlying implementation to achieve &quot;internal logic transparency, and users do not need to care about the logic behind it&quot;. Such a design is more practical for some applications that are simple in logic, require fast online, and do not pursue performance. But as a project develops further and further optimized, this uncontrollable abstraction layer will become a stumbling block for troubleshooting, performance optimization, and function customization. Problems caused by the abstraction layer, such as:</p><ul><li><p>Requirement iteration and version update are seriously lagging behind. If our project uses an abstraction layer A dependency, A dependency encapsulates B dependency. If we need to add a new feature or fix a bug to the B dependency, the usual process is: we raise an issue to the B dependency community. If we are lucky, we will get a reply within 2 to 4 days on average. If luck is still good, the other party is willing to change. Assuming that the changes are not significant, the relevant PRs will be merged after 1 week. It may wait 2 weeks, 1 month, or even a few months, and the B dependency finally releases a new version. Then we have to wait for the A dependency to update the B dependency version, which may take another 2 weeks, 1 month, or even a few months. By the time we actually get to use the new features, it may have been a few months. But more often than not, the maintainer of B&#39;s dependency is not willing to modify the relevant code at all.</p></li><li><p>The vast majority of well-known dependent libraries only care about function realization, not performance, and basically have the attitude of &quot;the function can be used, and the performance can make do&quot;. (Turms solves most of the following problems by refactoring dependent code) such as:</p><ul><li><code>mongo-java-driver</code> repeatedly creates a large number of intermediate objects when making API calls. For the default configuration object, no Cache is used.</li><li>Lettuce needs to repeatedly expand the memory when serializing the instruction parameters passed to Redis, and the memory data of the Cache is not cached.</li><li>Log4j2 actually uses <code>getBytes</code> to read the data of the string, and uses <code>StringBuilder</code> to do the splicing of the log (compared to the log implementation of Turms, which directly uses the <code>byte[] value</code> data inside <code>String</code>, and uses the<code> provided by Netty</code> io.netty.buffer.AbstractByteBufAllocator#directBuffer` to splice logs and do log output). (Supplement: If readers are interested in log implementation, you can read <a href="https://turms-im.github.io/docs/server/module/observability#%E8%87%AA%E7%A0%94%E5%AE%9E%E7%8E%B0-%E6%8B%93%E5%B1%95%E7%9F%A5%E8%AF%86" target="_blank" rel="noreferrer">log implementation</a>, understand how Turms implements logs)</li><li>In the official Java implementation of Protobuf, its string decoding implementation is also very inefficient. For example, in order to be compatible with lower versions of Java, it uses <code>char[]</code> for encoding, but the String of the new version of Java only stores <code>byte[ ]</code>, so a meaningless memory copy is required (note: the string itself is the largest data in the client request).</li><li>Spring is a typical representative of inefficient code, such as: <ul><li>When <code>org.springframework.core.codec.CharSequenceEncoder</code> processes <code>UTF-8</code> encoded strings, 1 character corresponds to 3 bytes to open up DirectByteBuffer for output. In other words, for the above-mentioned 8K Prometheus data, only this piece of Spring needs to use 2.4MB, and an extra 1.6MB is used. Of course, Spring is even more efficient, because it also performs string copying when <code>String#getBytes(...)</code>.</li><li><code>spring-boot-actuator:v2.6.6</code> does not support zero copy when exporting huge heap dump files (see <code>org.springframework.boot.actuate.management.HeapDumpWebEndpoint.TemporaryFileSystemResource#isFile</code>)</li><li>Spring&#39;s AOP is often used to proxy Controller layer method calls, which can be used to capture parsed parameters and print logs (WebFilter cannot obtain parsed parameters). But AOP will add 19 stacks to a method and use a lot of reflection. The time required to call from the AOP proxy to the Controller method layer is even longer than the internal business processing time of Turms (additional supplement: AOP is a very bad design, Spring Should be designed for the chain of responsibility adopted by the Controller layer).</li></ul></li></ul></li></ul><p>To sum up, the code quality of many well-known Java dependent libraries is not high, and even the code performance and quality are worrying, and the source code is shocking to read. Instead, readers can refer to how the Turms server is coded to optimize various details to the extreme.</p><ul><li><p>When the dependency library that focuses on abstract implementation is combined with responsive programming, it will bring developers a hell-level experience in troubleshooting problems, especially when bugs are related to memory that needs to be released manually. In the troubleshooting of conventional problems, we can usually quickly troubleshoot the problem through the stack information. But in reactive programming, such a method usually does not work, and we rely more on logical reasoning to troubleshoot problems. That is, familiarize yourself with the upstream and downstream code (including the code in the dependent package), and deduce all the processes that the code may go through.</p><p>If the code has few abstraction layers and the call relationship is flat, the troubleshooting process is actually very simple. Maybe we only need to glance at dozens of lines of code in a class to roughly know the cause of the problem. However, if a large number of &quot;encapsulation, abstraction, users do not need to pay attention to the underlying implementation logic&quot; dependency libraries are used in the process, the hell-level experience will come. Originally, we might only need a function with dozens of lines to implement all the relevant logic. But if we implement related functions based on the abstract library, when we troubleshoot, the code we may want to check may be A abstract class (A1, A2, A3...) class -&gt; B abstract class (B1, B2, B3.. .)-&gt;C abstract class (C1,C2,C3...)-&gt;..., jump between dozens of classes and dozens of methods, and reason.</p><p>The most typical comparison example is: Turms&#39; <code>im.turms.gateway.access.client.websocket.WebSocketServerFactory#getHttpRequestHandler</code> implements a set of WebSocket handshake logic in a function of dozens of lines. But if this set of logic is implemented by Spring, it will mix the classes under different packages and various logics together. When troubleshooting, if it is accompanied by some memory that needs to be released manually, hell level Here comes the troubleshooting experience. What can be solved with dozens of lines of code, a library like Spring requires thousands of lines of code. For example, there are multiple sets of underlying Web implementations inside WebFlux, which is euphemistically called &quot;encapsulation and abstraction, and users do not need to pay attention to the underlying implementation logic.&quot;</p></li><li><p>Some dependent libraries will automatically suppress exceptions in some places, and the upper-layer application code cannot perceive them. When something goes wrong, the underlying library code and the upper-level application code run on different stacks in most cases. Unless the underlying dependency library supports global exception callbacks, the upper-layer application cannot even perceive the occurrence of exceptions. For some Trivial-level errors, it doesn&#39;t matter if the upper-layer application cannot perceive them. But if it is an abnormality that some upper-layer applications are very concerned about (such as the abnormal disconnection of the RPC TCP connection), this will be the fuse that causes the abnormality and disorder of the entire system.</p></li><li><p>Developers of some well-known dependent libraries even lack the most basic security knowledge. For example, the developers of <code>Log4j</code> actually added code to automatically detect whether there is a <code>${jndi}</code> pattern in the string to be printed, and if it exists, call the corresponding JNDI service, and enable this function by default. As a developer who specializes in writing log-dependent libraries, he lacks security common sense and has passed PR review.</p></li></ul><p>On the other hand, self-development can avoid all the above-mentioned problems. While improving the controllability of the code, it also greatly reduces the difficulty of research and development and troubleshooting, and improves code performance and resource utilization.</p><p>In summary, when a Turms project references a class library, it usually does not introduce an abstract encapsulation library (such as Spring), but only an implementation library. Points that require performance optimization or logic optimization in the dependent library will be directly refactored inside the Turms project. Considering the difficulty of self-development and code controllability, we will choose self-development as much as possible in most cases.</p><p>Supplement: Although the Java ecosystem is prosperous, there are actually few high-quality libraries. Therefore, most medium and large-scale Java open source projects that pursue performance usually try to develop various functional modules by themselves instead of using third-party dependent libraries, such as: <a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noreferrer">Elasticsearch</a>, <a href="https://github.com/apache/cassandra" target="_blank" rel="noreferrer">Cassandra</a>, <a href="https://github.com/apache/ignite" target="_blank" rel="noreferrer">Ignite</a> . In addition, in the entire Java ecosystem, the only library we currently trust in the technical level of its developers is: Netty</p><h2 id="exception-capture-and-printing" tabindex="-1">Exception capture and printing <a class="header-anchor" href="#exception-capture-and-printing" aria-label="Permalink to &quot;Exception capture and printing&quot;">​</a></h2><p>Role: Understanding the exception capture and printing principles of the Turms server can help developers quickly locate the exception and find the root cause of the exception.</p><p>In reactive programming, the most criticized exception is that exceptions under this programming paradigm are usually very difficult to locate, and their stack information is basically useless. If the developer randomly prints the exception log in the reactive programming mode, it is very likely that the debugger will not even be able to judge where the exception is thrown from the log, let alone reverse the execution code.</p><p>But in fact, the principle and practice of good exception log printing are relatively simple, and if you follow this principle, it usually takes a few seconds or minutes to locate the exception. The basic principle is that the most downstream code throws an exception without printing. If the midstream code needs to translate the exception, it will continue to be thrown upwards after the translation, without printing; the most upstream exception will be received and ** will be printed. As for what code is considered &quot;the most upstream&quot;, the code that calls <code>subscribe()</code> is considered the &quot;most upstream&quot;. This principle is actually very simple in practice, but the exception capture in reactive programming &quot;looks&quot; more complicated. For example, under the <code>im.turms.service.access.servicerequest.dispatcher.ServiceRequestDispatcher#dispatch0</code> function in the turms-service server, there is an operation of &quot;send notifications to relevant users according to the processing results of the Service layer&quot; , whose code is as follows:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CLIENT_REQUEST_NAME)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tag</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CLIENT_REQUEST_TAG_TYPE, requestType.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">metrics</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">defaultIfEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(RequestHandlerResultFactory.NO_CONTENT)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">doOnEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(signal </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">signal.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isOnNext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            RequestHandlerResult requestResult </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> signal.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (requestResult </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> requestResult.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">code</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ResponseStatusCode.OK) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">            notifyRelatedUsersOfAction</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(requestResult, userId, deviceType)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">contextWrite</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(signal.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getContextView</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subscribe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, t </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (TracingCloseableContext ignored </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">asCloseable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                            LOGGER.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">error</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Failed to notify related users of the action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, t);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                    });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        })</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ...</span></span></code></pre></div><p>As mentioned above, this piece of code performs the notification delivery operation through the <code>notifyRelatedUsersOfAction</code> function. We don&#39;t care about its internal implementation. We only need to pass <code>subscribe(...)</code> at the most upstream to ensure that it can catch the exceptions that may be thrown. and print it.</p><h3 id="there-are-and-only-custom-exception-classes-inherited-from-runtimeexception" tabindex="-1">There are and only custom exception classes inherited from <code>RuntimeException</code> <a class="header-anchor" href="#there-are-and-only-custom-exception-classes-inherited-from-runtimeexception" aria-label="Permalink to &quot;There are and only custom exception classes inherited from `RuntimeException`&quot;">​</a></h3><p>In the Turms server project, there are and only exception classes inherited from <code>RuntimeException</code> can be customized, and exception classes inherited from <code>Exception</code> (<code>Checked Exception</code>) are prohibited from being customized.</p><p>The discussion on whether to use <code>Checked Exception</code> or <code>Unchecked Exception</code> has been divided so far, but now many articles directly criticize <code>Checked Exception</code> as a design failure of Java, and later languages such as Kotlin/Scala/C# don’t even have it at all. The concept of <code>Checked Exception</code>, and now most of the well-known large and medium-sized open source projects generally only customize the subclasses of <code>RuntimeException</code>, but not the subclasses of <code>Checked Exception</code>.</p><p>Common reasons why <code>Checked Exception</code> is bad design include:</p><ul><li><p>As a third-party library/downstream code, <code>Checked Exception</code> has interface signature version compatibility issues.</p></li><li><p>As a large and medium-sized project, when all submodules use <code>Checked Exception</code>, the interface of the upstream code may eventually declare dozens of exceptions. When the exception declaration of the interface is added, deleted, or modified, it will affect the whole body.</p></li><li><p>Inside the Java code, there are exception design conflicts. For example, Lambda in the design of Java Streams does not support throwing <code>Checked Exception</code>. For Lambda in Stream, its implementation must be treated as processing (usually a wrong practice) or converted into <code>Unchecked Exception</code> (losing the use of <code>Checked Exception</code>). Exception<code>meaning), Java even introduced</code>UncheckedIOException`.</p></li><li><p>In practice, people often avoid the purpose that <code>Checked Exception</code> was designed, so it is better not to use <code>Checked Exception</code>, for example:</p><ul><li>Catch all <code>Exception</code> directly</li><li>Translate <code>Checked Exception</code> to <code>RuntimeException</code>. Such as <code>try { ... } catch (Exception e) { throw new RuntimeException(e); }</code></li><li>Because the stack is too deep, in order to avoid polluting the upstream code, it is possible to directly perform meaningless capture downstream, and it is even possible to directly <code>catch (Exception e) { do nothing }</code> by mistake</li></ul></li><li><p>Many developers will misunderstand exception design, and then mistakenly customize exceptions. For example, many developers think that if it is an exception that can be avoided by the upstream code, use the subclass of RuntimeException. If it is an unavoidable exception in the upstream code, use Checked Exception`. A similar view is very blindly optimistic and lacks actual project experience and coding experience, because whether the exception thrown downstream can be handled depends on the logic of the upstream code, not The assumptions of the downstream code.</p><p>For example, when the plug-in module of the Turms server loads the plug-in, the class loader of the plug-in may throw <code>NoClassDefFoundError</code>, if according to the early Java team, <code>An Error is a subclass of Throwable that indicates serious problems that a reasonable application should not try to catch</code>, then the upstream code of the plug-in module should not catch <code>Error</code>, but as a server, Turms cannot make the server abnormal because it loads a problematic class plug-in, so the upstream code is really reasonable The approach is to catch these <code>Error</code>, instead of causing the server to crash directly and fall into an abnormal state.</p></li></ul><p>For the Turms server project, considering that the only scenario where <code>Checked Exception</code> can really play a role is: in individual scenarios, when designing downstream functional modules, it is known that the upstream caller code needs to be based on various events thrown downstream. Exceptions are distinguished by exceptions. In order to ensure that the upstream does not miss processing some exceptions thrown by the downstream, you can consider using <code>Checked Exception</code>. But since this kind of scenario is very rare, it is also very bad practice to design downstream code according to the logic of upstream caller code.</p><p>Therefore, in order to avoid various problems caused by <code>Checked Exception</code>, unify the exception design style, and avoid wasting time on &quot;why are they all modules of a certain type, module A uses a certain type of exception, and module B uses a certain type of exception &quot;For such insignificant disputes, in the Turms server project, there are and only exception classes that inherit from <code>RuntimeException</code>, and it is forbidden to customize exception classes that inherit from <code>Exception</code> (<code>Checked Exception</code>).</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-d4a0bba5><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-d4a0bba5><span class="visually-hidden" id="doc-footer-aria-label" data-v-d4a0bba5>Pager</span><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link prev" href="/docs/server/development/customization.html" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Previous page</span><span class="title" data-v-d4a0bba5>About Custom Development</span><!--]--></a></div><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link next" href="/docs/server/development/plugin.html" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Next page</span><span class="title" data-v-d4a0bba5>Custom Plugins</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"feature_index.md\":\"DIYY6KB5\",\"design_schema.md\":\"B-OsSPf2\",\"feature_simultaneous-login.md\":\"Dv5WDZ3P\",\"index.md\":\"DT6LKxD_\",\"client_communication-protocol.md\":\"19fqc3rc\",\"community_index.md\":\"Q4D8xT4N\",\"client_requirements.md\":\"DBzVoZij\",\"client_session.md\":\"cERMfOfD\",\"client_quick-start.md\":\"Cx9CJs0m\",\"server_module_chatbot.md\":\"Bt9UM6bH\",\"server_development_customization.md\":\"B-dABZRh\",\"server_deployment_getting-started.md\":\"CnIQHSBp\",\"server_development_testing.md\":\"DHuIaSw2\",\"server_module_anti-spam.md\":\"Ct-j2gvT\",\"reference_status-code.md\":\"Bf8rzK-V\",\"design_architecture.md\":\"C5IK87nB\",\"zh-cn_client_requirements.md\":\"CGlXV8Hy\",\"client_turms-client-js.md\":\"B-iSLAom\",\"server_deployment_distribution.md\":\"BtNqIqjJ\",\"reference_admin-api.md\":\"CSEaiK79\",\"feature_group.md\":\"C7OIdEhg\",\"client_api.md\":\"EQdkaTHM\",\"feature_message.md\":\"DPG3J4AR\",\"client_turms-chat-demo.md\":\"Dhb30-B6\",\"server_development_plugin.md\":\"F6ZhUybT\",\"server_development_rules.md\":\"CB4MA8-Z\",\"server_module_cluster.md\":\"DrSh-fmu\",\"zh-cn_client_quick-start.md\":\"CGHeOh7U\",\"zh-cn_server_development_testing.md\":\"BiMqxlx5\",\"zh-cn_server_development_rules.md\":\"DlKaQigf\",\"zh-cn_server_module_anti-spam.md\":\"B2XFpQwP\",\"zh-cn_design_schema.md\":\"B3F9pz_J\",\"zh-cn_design_status-aware.md\":\"BY2aQUuf\",\"zh-cn_feature_group.md\":\"C5OVfQ27\",\"zh-cn_feature_index.md\":\"BX4laEtI\",\"zh-cn_feature_message.md\":\"Dto7crLm\",\"zh-cn_feature_simultaneous-login.md\":\"Yzt39a3I\",\"zh-cn_feature_user.md\":\"DciIhaMe\",\"zh-cn_server_module_chatbot.md\":\"CFanzC5_\",\"zh-cn_reference_admin-api.md\":\"CmA4i8F4\",\"zh-cn_server_module_cluster.md\":\"BgAb3VQO\",\"zh-cn_reference_status-code.md\":\"Dg8KqdUK\",\"zh-cn_server_module_data-analytics.md\":\"D6sYc0XT\",\"zh-cn_server_module_observability.md\":\"BDZgjvG6\",\"zh-cn_server_deployment_config.md\":\"Vucblvpn\",\"server_development_code.md\":\"xWHpI5qz\",\"zh-cn_community_index.md\":\"CzRvXr6R\",\"zh-cn_design_architecture.md\":\"3cELTgJT\",\"zh-cn_server_module_xmpp.md\":\"DRu0ycXL\",\"zh-cn_server_deployment_distribution.md\":\"DT8RbeaJ\",\"feature_user.md\":\"CH--mD11\",\"server_module_xmpp.md\":\"DDfiHQx_\",\"design_status-aware.md\":\"BveBYI9G\",\"server_deployment_config.md\":\"B9K0kint\",\"zh-cn_server_module_storage.md\":\"CxdFKvfK\",\"server_module_data-analytics.md\":\"DOIqHdTR\",\"server_module_storage.md\":\"COQVIARu\",\"server_module_security.md\":\"CBWTWKsk\",\"server_module_system-resource-management.md\":\"F-_CQdCl\",\"server_module_observability.md\":\"CsS2LW7_\",\"turms-admin.md\":\"9LJIDghC\",\"zh-cn_client_metrics.md\":\"BIMuTxkp\",\"zh-cn_server_development_code.md\":\"DhvxCHG7\",\"zh-cn_server_module_identity-access-management.md\":\"C5hUtNHe\",\"zh-cn_client_turms-chat-demo.md\":\"Xm_h8Kdu\",\"zh-cn_client_api.md\":\"D__NwNqA\",\"client_metrics.md\":\"DgvBnv9p\",\"zh-cn_client_communication-protocol.md\":\"CPUhuAV6\",\"zh-cn_server_development_plugin.md\":\"B3Jr7Kwa\",\"zh-cn_client_session.md\":\"Dj26WvD7\",\"zh-cn_server_deployment_getting-started.md\":\"tGsvYK1n\",\"server_module_identity-access-management.md\":\"KTa7q2p7\",\"zh-cn_server_development_customization.md\":\"D0iT941k\",\"zh-cn_turms-admin.md\":\"CMUtegqM\",\"zh-cn_index.md\":\"CZZOsKBw\",\"zh-cn_server_module_system-resource-management.md\":\"BrmFpZkM\",\"zh-cn_client_turms-client-js.md\":\"6xpWt-YU\",\"zh-cn_server_module_security.md\":\"DC-z9kbp\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Turms Documentation\",\"description\":\"A VitePress site\",\"base\":\"/docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"https://raw.githubusercontent.com/turms-im/assets/master/logo/pegion.svg\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/turms-im/turms\"}],\"search\":{\"provider\":\"algolia\",\"options\":{\"appId\":\"WV3XO0QV2E\",\"apiKey\":\"f7a7c652875d1f2cc0f0ec52d8f8f660\",\"indexName\":\"turms-imio\",\"locales\":{\"zh-CN\":{\"placeholder\":\"搜索\",\"translations\":{\"button\":{\"buttonText\":\"搜索\",\"buttonAriaLabel\":\"搜索\"},\"modal\":{\"searchBox\":{\"resetButtonTitle\":\"重置查询\",\"resetButtonAriaLabel\":\"重置查询\",\"cancelButtonText\":\"取消\",\"cancelButtonAriaLabel\":\"取消\"},\"startScreen\":{\"recentSearchesTitle\":\"搜索历史\",\"noRecentSearchesText\":\"没有搜索历史\",\"saveRecentSearchButtonTitle\":\"保存至搜索历史\",\"removeRecentSearchButtonTitle\":\"从搜索历史中移除\",\"favoriteSearchesTitle\":\"收藏\",\"removeFavoriteSearchButtonTitle\":\"从收藏中移除\"},\"errorScreen\":{\"titleText\":\"无法获取搜索结果\",\"helpText\":\"请检查网络连接\"},\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\",\"closeText\":\"关闭\",\"searchByText\":\"搜索提供者\"},\"noResultsScreen\":{\"noResultsText\":\"没有找到相关结果\",\"suggestedQueryText\":\"您可能想搜索\",\"reportMissingResultsLinkText\":\"点击反馈\",\"reportMissingResultsText\":\"没有找到结果？请报告缺失\"}}}}}}}},\"locales\":{\"root\":{\"label\":\"English\",\"lang\":\"en\",\"themeConfig\":{\"sidebar\":[{\"text\":\"Introduction\",\"link\":\"/index.md\"},{\"text\":\"Community FAQ\",\"link\":\"/community/index.md\"},{\"text\":\"Business Features\",\"collapsed\":true,\"items\":[{\"text\":\"Business Features\",\"link\":\"/feature/index.md\"},{\"text\":\"Simultaneous Login\",\"link\":\"/feature/simultaneous-login.md\"},{\"text\":\"User-related Features\",\"link\":\"/feature/user.md\"},{\"text\":\"Group-related Features\",\"link\":\"/feature/group.md\"},{\"text\":\"Message-related Features\",\"link\":\"/feature/message.md\"}]},{\"text\":\"Design\",\"collapsed\":true,\"items\":[{\"text\":\"Architecture Design\",\"link\":\"/design/architecture.md\"},{\"text\":\"Collection Schema Design\",\"link\":\"/design/schema.md\"},{\"text\":\"Status Awareness\",\"link\":\"/design/status-aware.md\"}]},{\"text\":\"Server Guide\",\"collapsed\":true,\"items\":[{\"text\":\"Deployment\",\"items\":[{\"text\":\"Build and Start\",\"link\":\"/server/deployment/getting-started.md\"},{\"text\":\"Distribution\",\"link\":\"/server/deployment/distribution.md\"},{\"text\":\"Configuration\",\"link\":\"/server/deployment/config.md\"}]},{\"text\":\"Development\",\"items\":[{\"text\":\"About Custom Development\",\"link\":\"/server/development/customization.md\"},{\"text\":\"Basic Development Rules\",\"link\":\"/server/development/rules.md\"},{\"text\":\"Custom Plugins\",\"link\":\"/server/development/plugin.md\"},{\"text\":\"Source Code\",\"link\":\"/server/development/code.md\"},{\"text\":\"Testing\",\"link\":\"/server/development/testing.md\"}]},{\"text\":\"Main Modules\",\"items\":[{\"text\":\"Identity and Access Management\",\"link\":\"/server/module/identity-access-management.md\"},{\"text\":\"Cluster Design and Implementation\",\"link\":\"/server/module/cluster.md\"},{\"text\":\"System Resource Management\",\"link\":\"/server/module/system-resource-management.md\"},{\"text\":\"Observability\",\"link\":\"/server/module/observability.md\"},{\"text\":\"Security\",\"link\":\"/server/module/security.md\"},{\"text\":\"XMPP\",\"link\":\"/server/module/xmpp.md\"},{\"text\":\"Storage Service\",\"link\":\"/server/module/storage.md\"},{\"text\":\"Chatbot\",\"link\":\"/server/module/chatbot.md\"},{\"text\":\"Content Moderation\",\"link\":\"/server/module/anti-spam.md\"},{\"text\":\"Data Analysis\",\"link\":\"/server/module/data-analytics.md\"}]}]},{\"text\":\"Client Guide\",\"collapsed\":true,\"items\":[{\"text\":\"Quick Start\",\"link\":\"/client/quick-start.md\"},{\"text\":\"Version Requirements\",\"link\":\"/client/requirements.md\"},{\"text\":\"API\",\"link\":\"/client/api.md\"},{\"text\":\"Session Lifecycle\",\"link\":\"/client/session.md\"},{\"text\":\"Metrics\",\"link\":\"/client/metrics.md\"},{\"text\":\"Communication Protocol Used Between Client and Server\",\"link\":\"/client/communication-protocol.md\"},{\"text\":\"turms-client-js Shared Context\",\"link\":\"/client/turms-client-js.md\"},{\"text\":\"Turms Chat Demo\",\"link\":\"/client/turms-chat-demo.md\"}]},{\"text\":\"turms-admin\",\"link\":\"/turms-admin.md\"},{\"text\":\"Reference\",\"collapsed\":true,\"items\":[{\"text\":\"Admin API\",\"link\":\"/reference/admin-api.md\"},{\"text\":\"Status Code\",\"link\":\"/reference/status-code.md\"}]}]}},\"zh-CN\":{\"label\":\"简体中文\",\"lang\":\"zh-CN\",\"themeConfig\":{\"lastUpdatedText\":\"上次更新\",\"outline\":{\"label\":\"当前页\"},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"sidebar\":[{\"text\":\"介绍\",\"link\":\"/zh-CN/index.md\"},{\"text\":\"社区常见问题\",\"link\":\"/zh-CN/community/index.md\"},{\"text\":\"业务功能\",\"collapsed\":true,\"items\":[{\"text\":\"业务功能介绍\",\"link\":\"/zh-CN/feature/index.md\"},{\"text\":\"多端登录\",\"link\":\"/zh-CN/feature/simultaneous-login.md\"},{\"text\":\"用户相关功能\",\"link\":\"/zh-CN/feature/user.md\"},{\"text\":\"群组相关功能\",\"link\":\"/zh-CN/feature/group.md\"},{\"text\":\"消息相关功能\",\"link\":\"/zh-CN/feature/message.md\"}]},{\"text\":\"设计\",\"collapsed\":true,\"items\":[{\"text\":\"架构设计\",\"link\":\"/zh-CN/design/architecture.md\"},{\"text\":\"集合结构设计\",\"link\":\"/zh-CN/design/schema.md\"},{\"text\":\"状态感知\",\"link\":\"/zh-CN/design/status-aware.md\"}]},{\"text\":\"服务端指南\",\"collapsed\":true,\"items\":[{\"text\":\"部署\",\"items\":[{\"text\":\"搭建与启动\",\"link\":\"/zh-CN/server/deployment/getting-started.md\"},{\"text\":\"发布\",\"link\":\"/zh-CN/server/deployment/distribution.md\"},{\"text\":\"配置参数\",\"link\":\"/zh-CN/server/deployment/config.md\"}]},{\"text\":\"开发\",\"items\":[{\"text\":\"关于定制化开发\",\"link\":\"/zh-CN/server/development/customization.md\"},{\"text\":\"基本开发规约\",\"link\":\"/zh-CN/server/development/rules.md\"},{\"text\":\"自定义插件\",\"link\":\"/zh-CN/server/development/plugin.md\"},{\"text\":\"源码\",\"link\":\"/zh-CN/server/development/code.md\"},{\"text\":\"测试\",\"link\":\"/zh-CN/server/development/testing.md\"}]},{\"text\":\"主要模块\",\"items\":[{\"text\":\"身份与访问管理\",\"link\":\"/zh-CN/server/module/identity-access-management.md\"},{\"text\":\"集群的设计与实现\",\"link\":\"/zh-CN/server/module/cluster.md\"},{\"text\":\"系统资源管理\",\"link\":\"/zh-CN/server/module/system-resource-management.md\"},{\"text\":\"可观测性体系\",\"link\":\"/zh-CN/server/module/observability.md\"},{\"text\":\"安全\",\"link\":\"/zh-CN/server/module/security.md\"},{\"text\":\"XMPP\",\"link\":\"/zh-CN/server/module/xmpp.md\"},{\"text\":\"存储服务\",\"link\":\"/zh-CN/server/module/storage.md\"},{\"text\":\"聊天机器人\",\"link\":\"/zh-CN/server/module/chatbot.md\"},{\"text\":\"敏感词过滤\",\"link\":\"/zh-CN/server/module/anti-spam.md\"},{\"text\":\"数据分析\",\"link\":\"/zh-CN/server/module/data-analytics.md\"}]}]},{\"text\":\"客户端指南\",\"collapsed\":true,\"items\":[{\"text\":\"Quick Start\",\"link\":\"/zh-CN/client/quick-start.md\"},{\"text\":\"版本要求\",\"link\":\"/zh-CN/client/requirements.md\"},{\"text\":\"接口\",\"link\":\"/zh-CN/client/api.md\"},{\"text\":\"会话的生命周期\",\"link\":\"/zh-CN/client/session.md\"},{\"text\":\"度量数据\",\"link\":\"/zh-CN/client/metrics.md\"},{\"text\":\"与服务端通信时使用的数据格式\",\"link\":\"/zh-CN/client/communication-protocol.md\"},{\"text\":\"turms-client-js共享上下文\",\"link\":\"/zh-CN/client/turms-client-js.md\"},{\"text\":\"Turms Chat Demo\",\"link\":\"/zh-CN/client/turms-chat-demo.md\"}]},{\"text\":\"turms-admin\",\"link\":\"/zh-CN/turms-admin.md\"},{\"text\":\"手册\",\"collapsed\":true,\"items\":[{\"text\":\"管理员API接口\",\"link\":\"/zh-CN/reference/admin-api.md\"},{\"text\":\"状态码\",\"link\":\"/zh-CN/reference/status-code.md\"}]}]}}},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>