<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Security | Turms Documentation</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.2.0">
    <link rel="preload stylesheet" href="/docs/assets/style.BHGQ7U4S.css" as="style">
    
    <script type="module" src="/docs/assets/app.5bekgGnH.js"></script>
    <link rel="preload" href="/docs/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/docs/assets/chunks/framework.ViWktWD6.js">
    <link rel="modulepreload" href="/docs/assets/chunks/theme.PziOlW20.js">
    <link rel="modulepreload" href="/docs/assets/server_module_security.md.CBWTWKsk.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar top" data-v-ae24b3ad data-v-ccf7ddec><div class="wrapper" data-v-ccf7ddec><div class="container" data-v-ccf7ddec><div class="title" data-v-ccf7ddec><div class="VPNavBarTitle has-sidebar" data-v-ccf7ddec data-v-ab179fa1><a class="title" href="/docs/" data-v-ab179fa1><!--[--><!--]--><!--[--><img class="VPImage logo" src="https://raw.githubusercontent.com/turms-im/assets/master/logo/pegion.svg" alt data-v-8426fc1a><!--]--><span data-v-ab179fa1>Turms Documentation</span><!--[--><!--]--></a></div></div><div class="content" data-v-ccf7ddec><div class="content-body" data-v-ccf7ddec><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ccf7ddec><!--[--><!----><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><!----><div class="VPFlyout VPNavBarTranslations translations" data-v-ccf7ddec data-v-88af2de4 data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><span class="vpi-languages option-icon" data-v-b6c34ac9></span><!----><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><div class="items" data-v-88af2de4><p class="title" data-v-88af2de4>English</p><!--[--><div class="VPMenuLink" data-v-88af2de4 data-v-43f1e123><a class="VPLink link" href="/docs/zh-CN/server/module/security.html" data-v-43f1e123><!--[-->简体中文<!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-ccf7ddec data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ccf7ddec data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/turms-im/turms" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ccf7ddec data-v-d0bd9dde data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><div class="group translations" data-v-d0bd9dde><p class="trans-title" data-v-d0bd9dde>English</p><!--[--><div class="VPMenuLink" data-v-d0bd9dde data-v-43f1e123><a class="VPLink link" href="/docs/zh-CN/server/module/security.html" data-v-43f1e123><!--[-->简体中文<!--]--></a></div><!--]--></div><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/turms-im/turms" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ccf7ddec data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-ccf7ddec><div class="divider-line" data-v-ccf7ddec></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-b8d55f3b><!----><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/index.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Introduction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/community/index.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Community FAQ</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible collapsed" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Business Features</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/feature/index.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Business Features</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/feature/simultaneous-login.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Simultaneous Login</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/feature/user.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>User-related Features</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/feature/group.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Group-related Features</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/feature/message.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Message-related Features</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible collapsed" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Design</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/design/architecture.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Architecture Design</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/design/schema.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Collection Schema Design</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/design/status-aware.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Status Awareness</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible has-active" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Server Guide</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><section class="VPSidebarItem level-1" data-v-b8d55f3b data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h3 class="text" data-v-b8d55f3b>Deployment</h3><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/deployment/getting-started.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Build and Start</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/deployment/distribution.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Distribution</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/deployment/config.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Configuration</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-b8d55f3b data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h3 class="text" data-v-b8d55f3b>Development</h3><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/development/redevelopment.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>About Secondary Development</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/development/rules.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Basic Development Rules</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/development/plugin.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Custom Plugins</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/development/code.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Source Code</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/development/testing.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Testing</p><!--]--></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1 has-active" data-v-b8d55f3b data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h3 class="text" data-v-b8d55f3b>Main Modules</h3><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/identity-access-management.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Identity and Access Management</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/cluster.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Cluster Design and Implementation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/system-resource-management.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>System Resource Management</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/observability.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Observability</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/security.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Security</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/xmpp.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>XMPP</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/storage.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Storage Service</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/chatbot.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Chatbot</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/anti-spam.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Content Moderation</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/server/module/data-analytics.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Data Analysis</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible collapsed" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Client Guide</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/quick-start.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Quick Start</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/requirements.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Version Requirements</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/api.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/session.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Session Lifecycle</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/metrics.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Metrics</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/communication-protocol.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Communication Protocol Used Between Client and Server</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/turms-client-js.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>turms-client-js Shared Context</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/client/turms-chat-demo.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Turms Chat Demo</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0" data-v-575e6a36 data-v-b8d55f3b><!----><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/turms-admin.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>turms-admin</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 collapsible collapsed" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Reference</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-b8d55f3b><span class="vpi-chevron-right caret-icon" data-v-b8d55f3b></span></div></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/reference/admin-api.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Admin API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/docs/reference/status-code.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>Status Code</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-269c27a6><div class="content" data-v-269c27a6><div class="outline-marker" data-v-269c27a6></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-269c27a6>On this page</div><ul class="VPDocOutlineItem root" data-v-269c27a6 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _docs_server_module_security" data-v-39a288b8><div><h1 id="security" tabindex="-1">Security <a class="header-anchor" href="#security" aria-label="Permalink to &quot;Security&quot;">​</a></h1><h2 id="client-security" tabindex="-1">Client Security <a class="header-anchor" href="#client-security" aria-label="Permalink to &quot;Client Security&quot;">​</a></h2><p>For security reasons, this article does not describe CC attacks for which Turms does not provide a special defense mechanism.</p><h3 id="client-blacklist-mechanism" tabindex="-1">Client blacklist mechanism <a class="header-anchor" href="#client-blacklist-mechanism" aria-label="Permalink to &quot;Client blacklist mechanism&quot;">​</a></h3><h4 id="the-server-s-handling-of-banned-clients" tabindex="-1">The server&#39;s handling of banned clients <a class="header-anchor" href="#the-server-s-handling-of-banned-clients" aria-label="Permalink to &quot;The server&#39;s handling of banned clients&quot;">​</a></h4><p>When turms-gateway detects that a new IP or user ID is blocked, it will first send a shutdown notification of the Turms business layer to the established and blocked session. The notification has the <code>USER_IS_BLOCKED</code> status code, telling the client that it is Banned. After the data is flushed, the Turms server automatically disconnects the underlying TCP connection.</p><p>When turms-gateway checks that the peer IP of the newly established TCP connection has been banned, or detects that the user ID sending the login request has been banned, by default, turms-gateway will directly close the TCP connection with it, and will not A notification of the reason for connection closure will be sent, such as &quot;Your IP/User ID has been blocked for XX time&quot;.</p><p>There are two points to note:</p><ul><li><p>turms-gateway itself cannot refuse to connect with the banned IP before the TCP connection is established. If you want the server to refuse to connect to the banned IP before the TCP handshake, you can use the callback plug-in provided after Turms to notify the cloud service security system to ban the IP, so as to completely realize the IP ban .</p><p>In addition, the reason why we do not call the system service to completely block the IP is because: when the server is forcibly shut down, the blocked IP will not be automatically removed; modifying the underlying network configuration by ourselves may interfere with the cloud service&#39;s own network The management service conflicts, causing the server to be abnormal.</p></li><li><p>When the client connects or logs in, turms-gateway will actively disconnect the connection with the banned IP or user, but it will not send a notification of the reason for the connection closure. The advantages of doing this are: 1. The bandwidth of the cloud service is charged according to the outbound bandwidth, and the inbound bandwidth is not charged, so turms-gateway does not send a response on the business layer, which can slow down the bandwidth cost incurred when being attacked by DDoS; 2. Reduce information exposure and try not to provide effective information to hackers</p></li></ul><h4 id="automatic-ban-mechanism" tabindex="-1">Automatic ban mechanism <a class="header-anchor" href="#automatic-ban-mechanism" aria-label="Permalink to &quot;Automatic ban mechanism&quot;">​</a></h4><p>The timings that currently support automatic detection and banning of clients are:</p><ul><li><p>When the user sends requests frequently and reaches a certain number of times</p></li><li><p>When the WebSocket frame sent by the user does not conform to the specification or is too large, and reaches a certain number of times. The size of the request is based on the Payload Length value in the WebSocket Frame Header</p></li><li><p>When the Turms client request sent by the user cannot be parsed or is too large, and reaches a certain number of times. The size of the request is based on the Payload Length value of the client request Header in the TCP byte stream</p><p>Replenish:</p><ul><li>When the server detects that the data frame or client request is &quot;too large&quot;, it will not continue to parse the subsequent Payload part. If the Payload Length of the client does not match the actual Payload length, it will be judged as an illegal request</li><li>The specific request size limit can be configured through <code>turms.gateway.client-api.max-request-size-bytes</code></li></ul></li></ul><p>In other words, after the TCP connection is established, any behavior of the user may trigger a ban.</p><p>The automatic ban mechanism of Turms adopts a grading system, and provides 3 levels by default. The ban durations of these 3 levels are: 1 minute, 30 minutes, and 60 minutes. Under the default configuration, when the client triggers 5 illegal behaviors, the server will block the IP and user ID of the client with the configuration of level 1. If a certain number of illegal behaviors are triggered within the blocking time, it will enter the next block grade, and so on.</p><p>If you want to modify the default configuration, you can pass <code>turms.security.blocklist.ip.auto-block</code> and <code>turms.security.blocklist.user-id.auto-block</code> prefix, and cooperate with IDEA&#39;s smart prompt Modify the default configuration. Its specific configuration items are declared in the <code>im.turms.server.common.infra.property.env.common.security.AutoBlockItemProperties</code> class.</p><h4 id="ban-related-api" tabindex="-1">Ban related API <a class="header-anchor" href="#ban-related-api" aria-label="Permalink to &quot;Ban related API&quot;">​</a></h4><p>Administrators can use the API: <code>/blocked-clients/ips</code> and <code>/blocked-clients/users</code> to add, delete, modify and query blocked IPs and blocked user IDs respectively. The specific operations follow <a href="https://turms-im.github.io/docs/reference/admin-api#%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1%E5%87%86%E5%88%99" target="_blank" rel="noreferrer">Turms HTTP interface design general rules</a>, so I won’t go into details.</p><h4 id="implementation-principle-of-ban-expand-knowledge" tabindex="-1">Implementation principle of ban (expand knowledge) <a class="header-anchor" href="#implementation-principle-of-ban-expand-knowledge" aria-label="Permalink to &quot;Implementation principle of ban (expand knowledge)&quot;">​</a></h4><p>The principle of synchronizing banned client data is similar to that of common distributed Replicated Map implementations. That is, each server holds a weakly consistent copy of the Map, and one or more Redis servers store a reference copy, and also records the logs of each blocking and unblocking behavior for each server Do incremental sync. When a new server goes online or a server&#39;s local logs data lags behind by 100,000 records, these servers will request full synchronization from Redis, otherwise the server only needs to request incremental logs from Redis at the default interval of 10 seconds to synchronize the local copy .</p><p>In addition, the causal consistency implementation currently adopted by Turms is: the order of blocking and unblocking actions is based on the insertion order of the blocked logs queue in Redis, and each server performs causal synchronization based on the order of logs in the queue to ensure that the client is blocked The eventual consistency of the data.</p><h5 id="why-not-use-bloom-filter" tabindex="-1">Why not use Bloom Filter <a class="header-anchor" href="#why-not-use-bloom-filter" aria-label="Permalink to &quot;Why not use Bloom Filter&quot;">​</a></h5><p>The theoretical solution to realize the blacklist function based on Bloom Filter is widely known, but in fact, Bloom Filter has many pitfalls in this scenario, specifically:</p><ul><li><p>The features and engineering practices supported by Bloom Filter are limited. such as:</p><ul><li>In a distributed environment, how to judge the order of &quot;ban operation&quot; and &quot;unblock operation&quot;, and how to ensure the final consistency</li><li>How to set different ban durations for different banned users (such as five minutes/half an hour)</li><li>How to add additional information to additional banned users, such as the reason for being blocked</li><li>How to synchronize the blacklist list between nodes, how to do incremental synchronization</li><li>How to implement &quot;unblocking operation&quot; and what is the cost</li></ul><p>To sum up, even the most basic functions of the blacklist system cannot be realized by Bloom Filter in a distributed environment. Even if Bloom Filter is barely realized in conjunction with other engineering practices, then the advantages of Bloom Filter itself will not exist.</p></li><li><p>The amount of blocked user data itself is very small, and Bloom Filter cannot give full play to its advantages. And if it is just to judge whether the user has been blocked, according to the 1 million banned user IDs, a total of 12MiB or 61.4MiB of memory is needed (additional supplement: this example also confirms that we are in <a href="https://turms-im.github.io/docs/server/module/system-resource-management#%E5%85%B3%E4%BA%8Evalhalla%E9%A1%B9%E7%9B%AE" target="_blank" rel="noreferrer">About the Valhalla project</a> Mentioned in the article: <code>Java&#39;s waste of memory makes people feel a little &quot;self-defeating&quot;</code>). Because thread-safe collections are usually used in actual programming, and most thread-safe Sets are generally implemented based on Map, so the thread-safe Map is uniformly used below:</p><div class="language-java vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[] args) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> number </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1_000_000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> map1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ConcurrentHashMap.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">newKeySet</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)(number </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.75F</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0F</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> map2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> NonBlockingHashMapLong&lt;&gt;(number);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">long</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> number; i</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">++</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        map1.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">add</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        map2.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">put</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(i, Boolean.TRUE);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GraphLayout.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(map1).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toFootprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    System.out.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">println</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(GraphLayout.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(map2).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">toFootprint</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>The output of its memory usage is as follows (calculated based on <code>org.openjdk.jol.jol-core</code> library):</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>java.util.concurrent.ConcurrentHashMap$KeySetView@593634add footprint:</span></span>
<span class="line"><span>     COUNT       AVG       SUM   DESCRIPTION</span></span>
<span class="line"><span>         1   8388624   8388624   [Ljava.util.concurrent.ConcurrentHashMap$Node;</span></span>
<span class="line"><span>         1        16        16   java.lang.Boolean</span></span>
<span class="line"><span>   1000000        24  24000000   java.lang.Long</span></span>
<span class="line"><span>         1        64        64   java.util.concurrent.ConcurrentHashMap</span></span>
<span class="line"><span>         1        24        24   java.util.concurrent.ConcurrentHashMap$KeySetView</span></span>
<span class="line"><span>   1000000        32  32000000   java.util.concurrent.ConcurrentHashMap$Node</span></span>
<span class="line"><span>   2000004            64388728   (total)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>org.jctools.maps.NonBlockingHashMapLong@51ca57d6d footprint:</span></span>
<span class="line"><span>     COUNT       AVG       SUM   DESCRIPTION</span></span>
<span class="line"><span>         3   2796304   8388912   [J</span></span>
<span class="line"><span>         1   4194320   4194320   [Ljava.lang.Object;</span></span>
<span class="line"><span>         1        16        16   java.lang.Boolean</span></span>
<span class="line"><span>         2        16        32   org.jctools.maps.ConcurrentAutoTable</span></span>
<span class="line"><span>         2        40        80   org.jctools.maps.ConcurrentAutoTable$CAT</span></span>
<span class="line"><span>         1        40        40   org.jctools.maps.NonBlockingHashMapLong</span></span>
<span class="line"><span>         1        64        64   org.jctools.maps.NonBlockingHashMapLong$CHM</span></span>
<span class="line"><span>        11            12583464   (total)</span></span></code></pre></div></li><li><p>There is an error</p></li></ul><h3 id="client-interface-anti-brush-current-limit" tabindex="-1">Client interface anti-brush current limit <a class="header-anchor" href="#client-interface-anti-brush-current-limit" aria-label="Permalink to &quot;Client interface anti-brush current limit&quot;">​</a></h3><p>The current limiting implementation of turms-gateway adopts the mainstream algorithm &quot;token bucket algorithm&quot; (for example, the API Gateway of AWS provides traffic integer implementation using the token bucket algorithm).</p><h4 id="basics" tabindex="-1">Basics <a class="header-anchor" href="#basics" aria-label="Permalink to &quot;Basics&quot;">​</a></h4><p>No matter what the algorithm is, it needs to calculate the &quot;allowed number of requests&quot;. The following is a unified description, and the word &quot;token&quot; is used to refer to the &quot;allowed number of requests&quot;. In addition, the following table is the general implementation of this type of algorithm, and its variants will not affect the essence of the algorithm, so it will not be discussed.</p><table><thead><tr><th></th><th>Fixed time window algorithm</th><th>Sliding time window algorithm</th><th>Token bucket algorithm</th><th>Leaky bucket algorithm</th></tr></thead><tbody><tr><td>Token Cap</td><td>Fixed or Dynamic Token Cap (usually Fixed Cap)</td><td>Fixed or Dynamic Token Cap (usually Fixed Cap)</td><td>Fixed or Dynamic Token Cap (usually Fixed Cap)</td><td>Fixed or Dynamic Token Cap (usually Fixed upper limit)</td></tr><tr><td>Current number of available tokens</td><td>Calculated by a single time interval</td><td>Calculated by multiple time intervals</td><td>Calculated by the current number of tokens in stock</td><td>Calculated by the current number of tokens in stock</td></tr><tr><td>Token issuance interval</td><td>Emphasize coarse-grained interval issuance (such as interval 1 minute)</td><td>Emphasize fine-grained interval issuance (such as interval 15 seconds)</td><td>Emphasize fine-grained interval issuance (such as interval 1 second)</td><td>Emphasize fine-grained interval Release (such as interval 1 second)</td></tr><tr><td>Clear count on token issue</td><td>Yes</td><td>Yes. But generally only the earliest few windows are cleared</td><td>No</td><td>No</td></tr><tr><td>Resource overhead</td><td>No timer required, minimal overhead</td><td>No timer required, minimal overhead</td><td>No timer required, minimal overhead</td><td>Each session needs to maintain an MPSC synchronization queue, and a timer to time the Poll queue, with very high overhead big</td></tr><tr><td>Difficulty of implementation</td><td>Very simple</td><td>Very simple</td><td>Very simple</td><td>Relatively troublesome</td></tr><tr><td>General Comment</td><td>Due to the need to clear the count and the granularity is too large, the client can burst a large number of requests before each token issuance, causing the problem of &quot;double burst traffic&quot;</td><td>avoiding the problem of &quot;double burst traffic&quot; , but because of the &quot;clear count&quot; operation, its control precision is not as good as the token bucket algorithm and the leaky bucket algorithm</td><td>It can not only handle burst requests through stock tokens, but also through fine-grained interval commands Cards are issued to smoothly throttle requests. <br>In fact, the CPU credit mechanism of cloud services is similar to this</td><td>The length is slightly longer, see below</td></tr></tbody></table><p>Both the leaky bucket algorithm and the token bucket algorithm have the ability to handle burst requests and smoothly limit the flow of requests. But a special function of the leaky bucket algorithm is that it can limit the flow of downstream services (the most important one is the database). However, there is also a price for downstream flow limiting. It requires the operation and maintenance personnel to accurately estimate the downstream service throughput, otherwise it may cause the downstream service to be idle while the upstream service is limiting the flow.</p><p>In addition, the use of MPSC queues to cache requests not only reduces throughput, but also increases memory overhead and GC times, resulting in poor user experience and exacerbating the effect of DDoS attacks. (Supplement: By reading the source code of the Turms server, you will find that in the process of processing client requests in Turms, the code is as &quot;light&quot; as possible, so using the MPSC queue for each user session is considered a heavy operation)</p><p>In summary, the Turms server finally uses the <code>token bucket algorithm</code>.</p><p>In particular, compared to the traditional HTTP server, the CPU and memory system resources required to receive and process a regular HTTP request and response may be hundreds of times the system resources required for the interaction between the Turms server and its client (for example: except The network layer protocol header, the average size of a request from the Turms client is about 32B). Therefore, there is no need to take the sudden Turms client requests of a small number of users too seriously. The system resources used to process hundreds of Turms client requests may be similar to processing one HTTP request (of course, there are other forms of CC attacks that will cause a lot of resource consumption).</p><p>other:</p><ul><li>turms-gateway does not support and currently does not plan to support the implementation of global current limiting. The reason is: global current limiting is usually over-designed. Global current limiting is to alleviate DDoS attacks at all times, increase Redis failure points, and reduce the request processing of the entire system Throughput, many times you lose sight of the other, the gain outweighs the gain</li><li>Turms does not currently support assigning different weights to different types of requests. For example, a login request requires 3 tokens, and a message request requires 1 token</li><li>turms-gateway supports the configuration of the runtime zero-downtime update token bucket algorithm</li></ul><h2 id="user-information-security" tabindex="-1">User Information Security <a class="header-anchor" href="#user-information-security" aria-label="Permalink to &quot;User Information Security&quot;">​</a></h2><p>For most domestic groups with a little Internet age, unless they have a strong sense of security, their plaintext passwords are very likely to have been leaked (the specific content can be found out through <code>social engineering database</code>). Combined with the fact that the passwords used by most users are relatively fixed, so no matter how encrypted the server is, the security of the &quot;password&quot; is still relatively low.</p><p>TODO</p><h2 id="admin-security" tabindex="-1">Admin Security <a class="header-anchor" href="#admin-security" aria-label="Permalink to &quot;Admin Security&quot;">​</a></h2><h3 id="administrator-authentication-and-authorization" tabindex="-1">Administrator authentication and authorization <a class="header-anchor" href="#administrator-authentication-and-authorization" aria-label="Permalink to &quot;Administrator authentication and authorization&quot;">​</a></h3><h4 id="authentication" tabindex="-1">Authentication <a class="header-anchor" href="#authentication" aria-label="Permalink to &quot;Authentication&quot;">​</a></h4><p>Authentication: The server is implemented based on the common HTTP Basic authentication to confirm which administrator is the sender of the HTTP request.</p><p>Configuration item: <code>turms.security.password.admin-password-encoding-algorithm</code>, its optional values are: <code>bcrypt</code> (default), <code>salted_sha256</code> and <code>noop</code>.</p><h5 id="supported-key-encryption-algorithms" tabindex="-1">Supported key encryption algorithms <a class="header-anchor" href="#supported-key-encryption-algorithms" aria-label="Permalink to &quot;Supported key encryption algorithms&quot;">​</a></h5><p>*BCrypt. Its <code>cost</code> is a hard-coded <code>10</code> (2^10 rounds), which is used to prevent hackers from easily deciphering the plaintext password through the rainbow table when it is removed from the database.</p><p>For the specific algorithm implementation, please refer to the source code implementation of <code>Bouncy Castle</code> of Fork under the <code>turms-server-common</code> subproject: <code>org.bouncycastle.crypto.generators.BCrypt#generate</code></p><ul><li><p>Salted SHA-256</p></li><li><p>NOOP (plaintext storage)</p></li></ul><p>Special mention: The <code>password</code> field in the <code>admin</code> collection is not stored in <code>string</code> (such as the common Base64 encoded string), but the original <code>byte[]</code> byte data.</p><h4 id="authorization" tabindex="-1">Authorization <a class="header-anchor" href="#authorization" aria-label="Permalink to &quot;Authorization&quot;">​</a></h4><p>Authorization: The server confirms what authority the sender of the HTTP request has to do</p><p>Because Turms&#39;s own permission management requirements are very simple, its design and implementation are also relatively simple. For example, there are no concepts such as user groups, group roles, and role inheritance, and there is no many-to-many relationship between users and roles. Specifically, Turms uses RBAC (Role-Based Access Control) design scheme.</p><h5 id="turms-rbac-model" tabindex="-1">Turms&#39; RBAC Model <a class="header-anchor" href="#turms-rbac-model" aria-label="Permalink to &quot;Turms&#39; RBAC Model&quot;">​</a></h5><p>Turms&#39; RBAC model consists of three subjects: <code>Admin</code>, <code>Role</code> and <code>Permission</code>. A user can have only one role, and a role can have multiple permissions. in:</p><ul><li>Each role also has a field <code>rank</code>, only relatively high-rank administrators can add, delete and modify relatively low-rank administrator account information, such as passwords.</li><li>Permissions are used to describe what operations a role can perform on what resources, such as adding, deleting, modifying and querying user resources</li></ul><h5 id="special-character-root" tabindex="-1">Special Character - Root <a class="header-anchor" href="#special-character-root" aria-label="Permalink to &quot;Special Character - Root&quot;">​</a></h5><p><code>Root</code> is a built-in administrator role in Turms, which has all administrator privileges and cannot be modified or deleted.</p><h5 id="special-root-account-turms" tabindex="-1">Special root account - turms <a class="header-anchor" href="#special-root-account-turms" aria-label="Permalink to &quot;Special root account - turms&quot;">​</a></h5><p>The root account <code>turms</code> user has the <code>Root</code> root role authority, and its account name does not support modification (but can be changed by modifying the hard-coded <code>im.turms.server.common.domain.admin.constant.AdminConst#ROOT_ADMIN_ACCOUNT</code> value) Modify the root account name), its initial password is <code>turms</code> by default, but users can use the configuration item <code>turms.security.password.initial-root-password</code> when the <code>admin</code> collection has not been created and the turms-service is started Defined initial password.</p><h2 id="log-desensitization" tabindex="-1">Log desensitization <a class="header-anchor" href="#log-desensitization" aria-label="Permalink to &quot;Log desensitization&quot;">​</a></h2><p>TODO</p></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-d4a0bba5><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-d4a0bba5><span class="visually-hidden" id="doc-footer-aria-label" data-v-d4a0bba5>Pager</span><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link prev" href="/docs/server/module/observability.html" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Previous page</span><span class="title" data-v-d4a0bba5>Observability</span><!--]--></a></div><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link next" href="/docs/server/module/xmpp.html" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Next page</span><span class="title" data-v-d4a0bba5>XMPP</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"zh-cn_design_schema.md\":\"_4ZJZ_nW\",\"zh-cn_design_architecture.md\":\"ISY6gZq-\",\"design_architecture.md\":\"C5IK87nB\",\"feature_simultaneous-login.md\":\"Dv5WDZ3P\",\"feature_user.md\":\"CH--mD11\",\"reference_admin-api.md\":\"CSEaiK79\",\"client_metrics.md\":\"DgvBnv9p\",\"client_session.md\":\"cERMfOfD\",\"community_index.md\":\"BDiy7zSc\",\"client_turms-chat-demo.md\":\"DHNv3FfS\",\"client_requirements.md\":\"DBzVoZij\",\"client_turms-client-js.md\":\"B-iSLAom\",\"index.md\":\"C5NYzOJd\",\"server_module_chatbot.md\":\"Bt9UM6bH\",\"server_deployment_distribution.md\":\"BtNqIqjJ\",\"server_module_security.md\":\"CBWTWKsk\",\"zh-cn_server_development_rules.md\":\"DlKaQigf\",\"server_module_data-analytics.md\":\"DOIqHdTR\",\"zh-cn_server_development_testing.md\":\"Ccj3PX8j\",\"zh-cn_client_session.md\":\"Dj26WvD7\",\"zh-cn_client_quick-start.md\":\"CGHeOh7U\",\"server_development_plugin.md\":\"F6ZhUybT\",\"server_deployment_getting-started.md\":\"CnIQHSBp\",\"zh-cn_server_module_chatbot.md\":\"CFanzC5_\",\"zh-cn_server_module_cluster.md\":\"BgAb3VQO\",\"zh-cn_server_module_data-analytics.md\":\"D6sYc0XT\",\"zh-cn_server_module_storage.md\":\"CxdFKvfK\",\"server_module_anti-spam.md\":\"Ct-j2gvT\",\"server_development_redevelopment.md\":\"ZOTX-QI7\",\"server_module_cluster.md\":\"DrSh-fmu\",\"zh-cn_server_module_security.md\":\"DC-z9kbp\",\"zh-cn_client_turms-client-js.md\":\"6xpWt-YU\",\"zh-cn_server_module_observability.md\":\"BDZgjvG6\",\"zh-cn_feature_group.md\":\"C5OVfQ27\",\"server_module_xmpp.md\":\"DDfiHQx_\",\"zh-cn_design_status-aware.md\":\"DZSSltLb\",\"zh-cn_server_module_anti-spam.md\":\"B2XFpQwP\",\"zh-cn_server_deployment_getting-started.md\":\"tGsvYK1n\",\"feature_group.md\":\"C7OIdEhg\",\"zh-cn_server_development_plugin.md\":\"B3Jr7Kwa\",\"feature_index.md\":\"DIYY6KB5\",\"design_schema.md\":\"B-OsSPf2\",\"zh-cn_server_module_system-resource-management.md\":\"BrmFpZkM\",\"zh-cn_server_module_xmpp.md\":\"DRu0ycXL\",\"client_quick-start.md\":\"Cx9CJs0m\",\"server_development_testing.md\":\"Bv6zFIhE\",\"zh-cn_client_metrics.md\":\"BIMuTxkp\",\"server_module_storage.md\":\"COQVIARu\",\"zh-cn_client_requirements.md\":\"CGlXV8Hy\",\"reference_status-code.md\":\"Bf8rzK-V\",\"turms-admin.md\":\"9LJIDghC\",\"zh-cn_turms-admin.md\":\"CMUtegqM\",\"server_module_identity-access-management.md\":\"KTa7q2p7\",\"zh-cn_client_turms-chat-demo.md\":\"CVgBfyVl\",\"zh-cn_feature_message.md\":\"Dto7crLm\",\"zh-cn_feature_simultaneous-login.md\":\"Yzt39a3I\",\"zh-cn_client_api.md\":\"CZcwGhyl\",\"zh-cn_server_module_identity-access-management.md\":\"C5hUtNHe\",\"server_development_rules.md\":\"CB4MA8-Z\",\"zh-cn_community_index.md\":\"BV_rFjnT\",\"zh-cn_server_development_redevelopment.md\":\"CkzEBzCU\",\"zh-cn_feature_index.md\":\"BX4laEtI\",\"zh-cn_server_deployment_distribution.md\":\"DT8RbeaJ\",\"zh-cn_index.md\":\"DPc5b3ha\",\"zh-cn_reference_status-code.md\":\"Dg8KqdUK\",\"zh-cn_feature_user.md\":\"DciIhaMe\",\"design_status-aware.md\":\"3bmGc5hr\",\"client_communication-protocol.md\":\"19fqc3rc\",\"server_module_system-resource-management.md\":\"F-_CQdCl\",\"zh-cn_client_communication-protocol.md\":\"CPUhuAV6\",\"server_deployment_config.md\":\"CZS7tjQz\",\"feature_message.md\":\"DPG3J4AR\",\"client_api.md\":\"CnOyGvHs\",\"zh-cn_server_deployment_config.md\":\"Dc1SAz_L\",\"zh-cn_reference_admin-api.md\":\"CmA4i8F4\",\"zh-cn_server_development_code.md\":\"DhvxCHG7\",\"server_module_observability.md\":\"CsS2LW7_\",\"server_development_code.md\":\"xWHpI5qz\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Turms Documentation\",\"description\":\"A VitePress site\",\"base\":\"/docs/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"https://raw.githubusercontent.com/turms-im/assets/master/logo/pegion.svg\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/turms-im/turms\"}],\"search\":{\"provider\":\"algolia\",\"options\":{\"appId\":\"WV3XO0QV2E\",\"apiKey\":\"f7a7c652875d1f2cc0f0ec52d8f8f660\",\"indexName\":\"turms-imio\",\"locales\":{\"zh-CN\":{\"placeholder\":\"搜索\",\"translations\":{\"button\":{\"buttonText\":\"搜索\",\"buttonAriaLabel\":\"搜索\"},\"modal\":{\"searchBox\":{\"resetButtonTitle\":\"重置查询\",\"resetButtonAriaLabel\":\"重置查询\",\"cancelButtonText\":\"取消\",\"cancelButtonAriaLabel\":\"取消\"},\"startScreen\":{\"recentSearchesTitle\":\"搜索历史\",\"noRecentSearchesText\":\"没有搜索历史\",\"saveRecentSearchButtonTitle\":\"保存至搜索历史\",\"removeRecentSearchButtonTitle\":\"从搜索历史中移除\",\"favoriteSearchesTitle\":\"收藏\",\"removeFavoriteSearchButtonTitle\":\"从收藏中移除\"},\"errorScreen\":{\"titleText\":\"无法获取搜索结果\",\"helpText\":\"请检查网络连接\"},\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\",\"closeText\":\"关闭\",\"searchByText\":\"搜索提供者\"},\"noResultsScreen\":{\"noResultsText\":\"没有找到相关结果\",\"suggestedQueryText\":\"您可能想搜索\",\"reportMissingResultsLinkText\":\"点击反馈\",\"reportMissingResultsText\":\"没有找到结果？请报告缺失\"}}}}}}}},\"locales\":{\"root\":{\"label\":\"English\",\"lang\":\"en\",\"themeConfig\":{\"sidebar\":[{\"text\":\"Introduction\",\"link\":\"/index.md\"},{\"text\":\"Community FAQ\",\"link\":\"/community/index.md\"},{\"text\":\"Business Features\",\"collapsed\":true,\"items\":[{\"text\":\"Business Features\",\"link\":\"/feature/index.md\"},{\"text\":\"Simultaneous Login\",\"link\":\"/feature/simultaneous-login.md\"},{\"text\":\"User-related Features\",\"link\":\"/feature/user.md\"},{\"text\":\"Group-related Features\",\"link\":\"/feature/group.md\"},{\"text\":\"Message-related Features\",\"link\":\"/feature/message.md\"}]},{\"text\":\"Design\",\"collapsed\":true,\"items\":[{\"text\":\"Architecture Design\",\"link\":\"/design/architecture.md\"},{\"text\":\"Collection Schema Design\",\"link\":\"/design/schema.md\"},{\"text\":\"Status Awareness\",\"link\":\"/design/status-aware.md\"}]},{\"text\":\"Server Guide\",\"collapsed\":true,\"items\":[{\"text\":\"Deployment\",\"items\":[{\"text\":\"Build and Start\",\"link\":\"/server/deployment/getting-started.md\"},{\"text\":\"Distribution\",\"link\":\"/server/deployment/distribution.md\"},{\"text\":\"Configuration\",\"link\":\"/server/deployment/config.md\"}]},{\"text\":\"Development\",\"items\":[{\"text\":\"About Secondary Development\",\"link\":\"/server/development/redevelopment.md\"},{\"text\":\"Basic Development Rules\",\"link\":\"/server/development/rules.md\"},{\"text\":\"Custom Plugins\",\"link\":\"/server/development/plugin.md\"},{\"text\":\"Source Code\",\"link\":\"/server/development/code.md\"},{\"text\":\"Testing\",\"link\":\"/server/development/testing.md\"}]},{\"text\":\"Main Modules\",\"items\":[{\"text\":\"Identity and Access Management\",\"link\":\"/server/module/identity-access-management.md\"},{\"text\":\"Cluster Design and Implementation\",\"link\":\"/server/module/cluster.md\"},{\"text\":\"System Resource Management\",\"link\":\"/server/module/system-resource-management.md\"},{\"text\":\"Observability\",\"link\":\"/server/module/observability.md\"},{\"text\":\"Security\",\"link\":\"/server/module/security.md\"},{\"text\":\"XMPP\",\"link\":\"/server/module/xmpp.md\"},{\"text\":\"Storage Service\",\"link\":\"/server/module/storage.md\"},{\"text\":\"Chatbot\",\"link\":\"/server/module/chatbot.md\"},{\"text\":\"Content Moderation\",\"link\":\"/server/module/anti-spam.md\"},{\"text\":\"Data Analysis\",\"link\":\"/server/module/data-analytics.md\"}]}]},{\"text\":\"Client Guide\",\"collapsed\":true,\"items\":[{\"text\":\"Quick Start\",\"link\":\"/client/quick-start.md\"},{\"text\":\"Version Requirements\",\"link\":\"/client/requirements.md\"},{\"text\":\"API\",\"link\":\"/client/api.md\"},{\"text\":\"Session Lifecycle\",\"link\":\"/client/session.md\"},{\"text\":\"Metrics\",\"link\":\"/client/metrics.md\"},{\"text\":\"Communication Protocol Used Between Client and Server\",\"link\":\"/client/communication-protocol.md\"},{\"text\":\"turms-client-js Shared Context\",\"link\":\"/client/turms-client-js.md\"},{\"text\":\"Turms Chat Demo\",\"link\":\"/client/turms-chat-demo.md\"}]},{\"text\":\"turms-admin\",\"link\":\"/turms-admin.md\"},{\"text\":\"Reference\",\"collapsed\":true,\"items\":[{\"text\":\"Admin API\",\"link\":\"/reference/admin-api.md\"},{\"text\":\"Status Code\",\"link\":\"/reference/status-code.md\"}]}]}},\"zh-CN\":{\"label\":\"简体中文\",\"lang\":\"zh-CN\",\"themeConfig\":{\"lastUpdatedText\":\"上次更新\",\"outline\":{\"label\":\"当前页\"},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"sidebar\":[{\"text\":\"介绍\",\"link\":\"/zh-CN/index.md\"},{\"text\":\"社区常见问题\",\"link\":\"/zh-CN/community/index.md\"},{\"text\":\"业务功能\",\"collapsed\":true,\"items\":[{\"text\":\"业务功能介绍\",\"link\":\"/zh-CN/feature/index.md\"},{\"text\":\"多端登录\",\"link\":\"/zh-CN/feature/simultaneous-login.md\"},{\"text\":\"用户相关功能\",\"link\":\"/zh-CN/feature/user.md\"},{\"text\":\"群组相关功能\",\"link\":\"/zh-CN/feature/group.md\"},{\"text\":\"消息相关功能\",\"link\":\"/zh-CN/feature/message.md\"}]},{\"text\":\"设计\",\"collapsed\":true,\"items\":[{\"text\":\"架构设计\",\"link\":\"/zh-CN/design/architecture.md\"},{\"text\":\"集合结构设计\",\"link\":\"/zh-CN/design/schema.md\"},{\"text\":\"状态感知\",\"link\":\"/zh-CN/design/status-aware.md\"}]},{\"text\":\"服务端指南\",\"collapsed\":true,\"items\":[{\"text\":\"部署\",\"items\":[{\"text\":\"搭建与启动\",\"link\":\"/zh-CN/server/deployment/getting-started.md\"},{\"text\":\"发布\",\"link\":\"/zh-CN/server/deployment/distribution.md\"},{\"text\":\"配置参数\",\"link\":\"/zh-CN/server/deployment/config.md\"}]},{\"text\":\"开发\",\"items\":[{\"text\":\"关于二次开发\",\"link\":\"/zh-CN/server/development/redevelopment.md\"},{\"text\":\"基本开发规约\",\"link\":\"/zh-CN/server/development/rules.md\"},{\"text\":\"自定义插件\",\"link\":\"/zh-CN/server/development/plugin.md\"},{\"text\":\"源码\",\"link\":\"/zh-CN/server/development/code.md\"},{\"text\":\"测试\",\"link\":\"/zh-CN/server/development/testing.md\"}]},{\"text\":\"主要模块\",\"items\":[{\"text\":\"身份与访问管理\",\"link\":\"/zh-CN/server/module/identity-access-management.md\"},{\"text\":\"集群的设计与实现\",\"link\":\"/zh-CN/server/module/cluster.md\"},{\"text\":\"系统资源管理\",\"link\":\"/zh-CN/server/module/system-resource-management.md\"},{\"text\":\"可观测性体系\",\"link\":\"/zh-CN/server/module/observability.md\"},{\"text\":\"安全\",\"link\":\"/zh-CN/server/module/security.md\"},{\"text\":\"XMPP\",\"link\":\"/zh-CN/server/module/xmpp.md\"},{\"text\":\"存储服务\",\"link\":\"/zh-CN/server/module/storage.md\"},{\"text\":\"聊天机器人\",\"link\":\"/zh-CN/server/module/chatbot.md\"},{\"text\":\"敏感词过滤\",\"link\":\"/zh-CN/server/module/anti-spam.md\"},{\"text\":\"数据分析\",\"link\":\"/zh-CN/server/module/data-analytics.md\"}]}]},{\"text\":\"客户端指南\",\"collapsed\":true,\"items\":[{\"text\":\"Quick Start\",\"link\":\"/zh-CN/client/quick-start.md\"},{\"text\":\"版本要求\",\"link\":\"/zh-CN/client/requirements.md\"},{\"text\":\"接口\",\"link\":\"/zh-CN/client/api.md\"},{\"text\":\"会话的生命周期\",\"link\":\"/zh-CN/client/session.md\"},{\"text\":\"度量数据\",\"link\":\"/zh-CN/client/metrics.md\"},{\"text\":\"与服务端通信时使用的数据格式\",\"link\":\"/zh-CN/client/communication-protocol.md\"},{\"text\":\"turms-client-js共享上下文\",\"link\":\"/zh-CN/client/turms-client-js.md\"},{\"text\":\"Turms Chat Demo\",\"link\":\"/zh-CN/client/turms-chat-demo.md\"}]},{\"text\":\"turms-admin\",\"link\":\"/zh-CN/turms-admin.md\"},{\"text\":\"手册\",\"collapsed\":true,\"items\":[{\"text\":\"管理员API接口\",\"link\":\"/zh-CN/reference/admin-api.md\"},{\"text\":\"状态码\",\"link\":\"/zh-CN/reference/status-code.md\"}]}]}}},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>