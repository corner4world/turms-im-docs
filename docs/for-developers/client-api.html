<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>接口 | Turms Documentation</title><meta name="description" content="">
    <link rel="modulepreload" href="/docs/assets/app.4eead61a.js"><link rel="modulepreload" href="/docs/assets/client-api.html.633b0231.js"><link rel="modulepreload" href="/docs/assets/client-api.html.6a952d9a.js"><link rel="prefetch" href="/docs/assets/index.html.2d6dc5f4.js"><link rel="prefetch" href="/docs/assets/index.html.58669d11.js"><link rel="prefetch" href="/docs/assets/index.html.a9dbf42f.js"><link rel="prefetch" href="/docs/assets/group.html.feece72a.js"><link rel="prefetch" href="/docs/assets/message.html.34db036a.js"><link rel="prefetch" href="/docs/assets/simultaneous-login.html.f4f920d8.js"><link rel="prefetch" href="/docs/assets/user.html.01eea1ff.js"><link rel="prefetch" href="/docs/assets/admin-api.html.5067ffd3.js"><link rel="prefetch" href="/docs/assets/anti-spam.html.3d3fb276.js"><link rel="prefetch" href="/docs/assets/architecture.html.13ccd14f.js"><link rel="prefetch" href="/docs/assets/client-identity-access-management.html.7f00d3e0.js"><link rel="prefetch" href="/docs/assets/client-metrics.html.19b1fc30.js"><link rel="prefetch" href="/docs/assets/client-quick-start.html.8f1baa8d.js"><link rel="prefetch" href="/docs/assets/client-requirements.html.45bef8d6.js"><link rel="prefetch" href="/docs/assets/client-server-protocol.html.793e4901.js"><link rel="prefetch" href="/docs/assets/client-session.html.fe290192.js"><link rel="prefetch" href="/docs/assets/client-turms-client-js.html.392e014e.js"><link rel="prefetch" href="/docs/assets/cluster.html.96899bec.js"><link rel="prefetch" href="/docs/assets/code.html.4db5f44d.js"><link rel="prefetch" href="/docs/assets/config.html.57b4d4b2.js"><link rel="prefetch" href="/docs/assets/data-analytics.html.afc0478f.js"><link rel="prefetch" href="/docs/assets/distribution.html.e84ce6f0.js"><link rel="prefetch" href="/docs/assets/getting-started.html.cdf4d9f4.js"><link rel="prefetch" href="/docs/assets/observability.html.83e84a53.js"><link rel="prefetch" href="/docs/assets/plugin.html.71d11b82.js"><link rel="prefetch" href="/docs/assets/redevelopment.html.3c82baa3.js"><link rel="prefetch" href="/docs/assets/rules.html.d18b7ac7.js"><link rel="prefetch" href="/docs/assets/schema.html.c43cb2e9.js"><link rel="prefetch" href="/docs/assets/security.html.2ee9def6.js"><link rel="prefetch" href="/docs/assets/status-aware.html.bd05409b.js"><link rel="prefetch" href="/docs/assets/status-code.html.d04fee6a.js"><link rel="prefetch" href="/docs/assets/system-resource-management.html.77c2617c.js"><link rel="prefetch" href="/docs/assets/testing.html.1cbd24b0.js"><link rel="prefetch" href="/docs/assets/turms-admin.html.7038ac52.js"><link rel="prefetch" href="/docs/assets/404.html.c038a05a.js"><link rel="prefetch" href="/docs/assets/index.html.5b9a77eb.js"><link rel="prefetch" href="/docs/assets/index.html.f2a503af.js"><link rel="prefetch" href="/docs/assets/index.html.33849149.js"><link rel="prefetch" href="/docs/assets/group.html.9d83f73c.js"><link rel="prefetch" href="/docs/assets/message.html.4148f080.js"><link rel="prefetch" href="/docs/assets/simultaneous-login.html.8b903d84.js"><link rel="prefetch" href="/docs/assets/user.html.4382c029.js"><link rel="prefetch" href="/docs/assets/admin-api.html.881ff804.js"><link rel="prefetch" href="/docs/assets/anti-spam.html.31a3d16e.js"><link rel="prefetch" href="/docs/assets/architecture.html.3fab6556.js"><link rel="prefetch" href="/docs/assets/client-identity-access-management.html.caecac61.js"><link rel="prefetch" href="/docs/assets/client-metrics.html.2cc6d41b.js"><link rel="prefetch" href="/docs/assets/client-quick-start.html.6a6329f4.js"><link rel="prefetch" href="/docs/assets/client-requirements.html.e2d520c8.js"><link rel="prefetch" href="/docs/assets/client-server-protocol.html.786ee4a4.js"><link rel="prefetch" href="/docs/assets/client-session.html.6af6b607.js"><link rel="prefetch" href="/docs/assets/client-turms-client-js.html.9508cca4.js"><link rel="prefetch" href="/docs/assets/cluster.html.d29d151e.js"><link rel="prefetch" href="/docs/assets/code.html.9867efc8.js"><link rel="prefetch" href="/docs/assets/config.html.d4d479ec.js"><link rel="prefetch" href="/docs/assets/data-analytics.html.f9df8c30.js"><link rel="prefetch" href="/docs/assets/distribution.html.1b0521b5.js"><link rel="prefetch" href="/docs/assets/getting-started.html.950d98ed.js"><link rel="prefetch" href="/docs/assets/observability.html.d3fe250e.js"><link rel="prefetch" href="/docs/assets/plugin.html.c3dbbd35.js"><link rel="prefetch" href="/docs/assets/redevelopment.html.14d4ce31.js"><link rel="prefetch" href="/docs/assets/rules.html.874a3081.js"><link rel="prefetch" href="/docs/assets/schema.html.4ecd8e18.js"><link rel="prefetch" href="/docs/assets/security.html.ee2afb83.js"><link rel="prefetch" href="/docs/assets/status-aware.html.c03ea1a9.js"><link rel="prefetch" href="/docs/assets/status-code.html.13d799c1.js"><link rel="prefetch" href="/docs/assets/system-resource-management.html.c776d857.js"><link rel="prefetch" href="/docs/assets/testing.html.5e5fbaed.js"><link rel="prefetch" href="/docs/assets/turms-admin.html.923b8903.js"><link rel="prefetch" href="/docs/assets/404.html.4a1c4a7c.js"><link rel="prefetch" href="/docs/assets/mermaid.esm.min.e3b5d21d.js">
    <link rel="stylesheet" href="/docs/assets/style.25523ee4.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/docs/" class=""><img class="logo" src="https://raw.githubusercontent.com/turms-im/assets/master/logo/pegion.svg" alt="Turms Documentation"><span class="site-name can-hide">Turms Documentation</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/turms-im/turms" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/turms-im/turms" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/docs/README.md" class="sidebar-item sidebar-heading" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a href="/docs/community/README.md" class="sidebar-item sidebar-heading" aria-label="社区常见问题"><!--[--><!--]--> 社区常见问题 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">业务功能 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/docs/features/" class="sidebar-item" aria-label="业务功能介绍"><!--[--><!--]--> 业务功能介绍 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/simultaneous-login.html" class="sidebar-item" aria-label="多端登录"><!--[--><!--]--> 多端登录 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/user.html" class="sidebar-item" aria-label="用户相关功能"><!--[--><!--]--> 用户相关功能 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/group.html" class="sidebar-item" aria-label="群组相关功能"><!--[--><!--]--> 群组相关功能 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/message.html" class="sidebar-item" aria-label="消息相关功能"><!--[--><!--]--> 消息相关功能 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">服务端指南 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item">部署 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/getting-started.html" class="sidebar-item" aria-label="搭建与启动"><!--[--><!--]--> 搭建与启动 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/distribution.html" class="sidebar-item" aria-label="发布"><!--[--><!--]--> 发布 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/config.html" class="sidebar-item" aria-label="配置参数"><!--[--><!--]--> 配置参数 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">设计 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/architecture.html" class="sidebar-item" aria-label="架构设计"><!--[--><!--]--> 架构设计 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/schema.html" class="sidebar-item" aria-label="集合结构设计"><!--[--><!--]--> 集合结构设计 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/status-aware.html" class="sidebar-item" aria-label="状态感知"><!--[--><!--]--> 状态感知 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">开发 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/redevelopment.html" class="sidebar-item" aria-label="关于二次开发"><!--[--><!--]--> 关于二次开发 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/rules.html" class="sidebar-item" aria-label="开发基本规约"><!--[--><!--]--> 开发基本规约 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/plugin.html" class="sidebar-item" aria-label="自定义插件"><!--[--><!--]--> 自定义插件 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/code.html" class="sidebar-item" aria-label="源码"><!--[--><!--]--> 源码 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/testing.html" class="sidebar-item" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">主要模块 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/cluster.html" class="sidebar-item" aria-label="集群的设计与实现"><!--[--><!--]--> 集群的设计与实现 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/system-resource-management.html" class="sidebar-item" aria-label="系统资源管理"><!--[--><!--]--> 系统资源管理 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/observability.html" class="sidebar-item" aria-label="可观测性体系"><!--[--><!--]--> 可观测性体系 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/security.html" class="sidebar-item" aria-label="安全"><!--[--><!--]--> 安全 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/anti-spam.html" class="sidebar-item" aria-label="敏感词过滤"><!--[--><!--]--> 敏感词过滤 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/data-analytics.html" class="sidebar-item" aria-label="数据分析"><!--[--><!--]--> 数据分析 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">客户端指南 <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/client-quick-start.html" class="sidebar-item" aria-label="Quick Start"><!--[--><!--]--> Quick Start <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-requirements.html" class="sidebar-item" aria-label="版本要求"><!--[--><!--]--> 版本要求 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/for-developers/client-api.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="接口"><!--[--><!--]--> 接口 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/docs/for-developers/client-api.html#客户端的对外逻辑结构" class="router-link-active router-link-exact-active sidebar-item" aria-label="客户端的对外逻辑结构"><!--[--><!--]--> 客户端的对外逻辑结构 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/docs/for-developers/client-api.html#service类的返回值" class="router-link-active router-link-exact-active sidebar-item" aria-label="Service类的返回值"><!--[--><!--]--> Service类的返回值 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/for-developers/client-api.html#主要接口差异-拓展知识" class="router-link-active router-link-exact-active sidebar-item" aria-label="主要接口差异（拓展知识）"><!--[--><!--]--> 主要接口差异（拓展知识） <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/docs/for-developers/client-api.html#接口的理解方法-重点" class="router-link-active router-link-exact-active sidebar-item" aria-label="接口的理解方法（重点）"><!--[--><!--]--> 接口的理解方法（重点） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/for-developers/client-api.html#具体示例" class="router-link-active router-link-exact-active sidebar-item" aria-label="具体示例"><!--[--><!--]--> 具体示例 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/docs/for-developers/client-api.html#体验示例前的服务端准备工作" class="router-link-active router-link-exact-active sidebar-item" aria-label="体验示例前的服务端准备工作"><!--[--><!--]--> 体验示例前的服务端准备工作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/for-developers/client-api.html#代码示例" class="router-link-active router-link-exact-active sidebar-item" aria-label="代码示例"><!--[--><!--]--> 代码示例 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/docs/for-developers/client-session.html" class="sidebar-item" aria-label="会话的生命周期"><!--[--><!--]--> 会话的生命周期 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-metrics.html" class="sidebar-item" aria-label="度量数据"><!--[--><!--]--> 度量数据 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-identity-access-management.html" class="sidebar-item" aria-label="身份与访问管理"><!--[--><!--]--> 身份与访问管理 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-server-protocol.html" class="sidebar-item" aria-label="与服务端通信时使用的数据格式"><!--[--><!--]--> 与服务端通信时使用的数据格式 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-turms-client-js.html" class="sidebar-item" aria-label="turms-client-js共享上下文"><!--[--><!--]--> turms-client-js共享上下文 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/docs/for-developers/turms-admin.html" class="sidebar-item sidebar-heading" aria-label="turms-admin"><!--[--><!--]--> turms-admin <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">手册 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/admin-api.html" class="sidebar-item" aria-label="管理员API接口"><!--[--><!--]--> 管理员API接口 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/status-code.html" class="sidebar-item" aria-label="状态码"><!--[--><!--]--> 状态码 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="接口" tabindex="-1"><a class="header-anchor" href="#接口" aria-hidden="true">#</a> 接口</h1><p>Turms客户端目前支持JavaScript、Kotlin、Swift与Dart这四种语言，对外暴露一致的接口，并且表现为一致的行为。各语言版本之间的部分接口参数可能出现不完全一致的情况，这主要体现在：1. 接口采用更贴近当前语言特性及习惯的参数与语法；2. turms-client-js独有的参数与接口。</p><p>由于Turms各语言客户端行为具有高度的一致性，因此如果您基于上述任意一种语言进行业务开发，您可以在代码逻辑不做改变的情况下，轻松将已写好的业务代码翻译为另外两种语言（具体可参考在本文结尾处的示例）。</p><h2 id="客户端的对外逻辑结构" tabindex="-1"><a class="header-anchor" href="#客户端的对外逻辑结构" aria-hidden="true">#</a> 客户端的对外逻辑结构</h2><ul><li>TurmsClient：Turms客户端唯一直接对外暴露的类，一个TurmsClient实例代表着一个客户端与服务端之间的会话连接。以下变量是TurmsClient对外的成员变量。 <ul><li><p>driver：TurmsClient的运行驱动。负责连接的开起关闭、底层数据的发送接收与心跳控制等基础性操作。以下介绍到的Service层类都基于driver运作。</p></li><li><p>userService：用户相关服务。负责如用户登陆、添加好友、添加关系人分组、发送/处理好友请求、查询附近的用户等操作。</p></li><li><p>groupService：群组相关服务。负责如创建群组、变更群主、修改群成员角色、修改群信息等操作。</p></li><li><p>messageService：消息相关服务。负责如发送消息、修改已发送消息、查询各类消息与其状态、撤回消息等操作。</p></li><li><p>notificationService：通知相关服务。负责接受与响应业务层面上的通知（即：其他用户向该用户发送好友请求、群组成员上下线等通知）。 提醒：消息（message）不算做业务层面上的“通知”（notification），因此notificationService不会处理用户消息，用户消息仅由messageService进行处理。而driver中TurmsNotification的“通知”概念指的是网络层面上的Turms服务端给Turms客户端的通知，因此notificationService也不会处理底层的TurmsNotification数据。</p><p>补充：关于通知功能的开启与关闭，您可以在turms服务端<code>im.turms.server.common.infra.property.env.service.business.NotificationProperties</code>处，实时地进行修改。</p></li><li><p>storageService：存储相关服务（可选拓展）。负责用户头像、群组头像与消息附件的上传与下载操作。补充：该服务为turms的拓展服务，因此若您希望使用该功能，您需要将turms-plugin-minio或您自行实现的存储插件集成到turms服务端当中。</p></li></ul></li></ul><h3 id="service类的返回值" tabindex="-1"><a class="header-anchor" href="#service类的返回值" aria-hidden="true">#</a> Service类的返回值</h3><p>与Turms服务端交互的所有Turms客户端接口都<strong>基于异步模型编写</strong>。turms-client-js使用Promise模型，turms-client-kotlin使用Coroutines模型，而turms-client-swift使用Promise模型（由PromiseKit提供）。</p><p>各种Service类可以对Turms所提供的业务模型进行增删改查操作。您需要了解其返回值种类，以开发您自己的业务代码。</p><h4 id="对于状态码为10xx的响应-拓展知识" tabindex="-1"><a class="header-anchor" href="#对于状态码为10xx的响应-拓展知识" aria-hidden="true">#</a> 对于状态码为10xx的响应（拓展知识）</h4><ul><li><p>对于增加业务模型的函数，如果该函数的返回值被声明为一个异步模型（如：Promise&lt;Response&lt;string&gt;&gt;），则返回的泛型（如前文的string类型）的值必定不为空，否则会抛出一个状态码为<code>INVALID_RESPONSE</code>的错误<code>ResponseError</code>或<code>ResponseException</code>，表明本应该存在的数据点丢失。若出现该错误，则意味着Turms的服务端或客户端自身存在行为不一致的Bug。</p></li><li><p>对于删除与更新业务模型的函数，它们均返回被异步模型包裹的Void类型（如：Promise&lt;Response&lt;Void&gt;&gt;）。</p></li><li><p>对于查找业务模型的函数：</p><p>如果该类函数返回被异步模型包裹的List类型，则当服务端返回空数据时，该查找操作函数会返回一个空List，而非null或undefined。</p><p>如果被包裹的类型不是List类型，则当服务端返回空数据时，该查找操作函数会返回一个undefined（JavaScript）或null（Kotlin）或nil（Swift）。特例：answerGroupQuestions方法可以算做查询方法，但其返回数据永不为空。</p></li></ul><h4 id="对于状态非10xx的响应-拓展知识" tabindex="-1"><a class="header-anchor" href="#对于状态非10xx的响应-拓展知识" aria-hidden="true">#</a> 对于状态非10xx的响应（拓展知识）</h4><p>对于Service类而言，这类响应均被认作是“错误”状态响应。通过异步模型抛出<code>ResponseException</code>，并在该错误模型中包括了具体状态码与错误原因。</p><h3 id="主要接口差异-拓展知识" tabindex="-1"><a class="header-anchor" href="#主要接口差异-拓展知识" aria-hidden="true">#</a> 主要接口差异（拓展知识）</h3><p>通常情况下，您并不需要关心各客户端接口之间的差异，但如果您的团队需要由一名开发者基于多个Turms客户端进行上层的开发工作，或者您需要对照您项目的上层客户端代码实现的异同，您可以了解一下客户端间主要接口的不同。</p><p>在早期Turms客户端实现中，各客户端之间的接口参数与数据模型是尽量保持统一的参数配置与含义，如时间表达相关的参数。但这种强行统一的写法不符合目标语言习惯。同时考虑到在大部分情况下，各客户端的上层业务代码通常有专人负责，而非全由一名开发者负责，统一含义意义不大，并且这些差异也符合目标语言习惯，故不进行强制统一。</p><p>客户端主要接口的差异如下表：</p><table><thead><tr><th></th><th>JavaScript客户端</th><th>Kotlin客户端</th><th>Swift客户端</th><th>Dart客户端</th><th>实例</th></tr></thead><tbody><tr><td>时间表达单位</td><td>一律为毫秒</td><td>一律为毫秒</td><td>采用TimeInterval（即秒）</td><td>一律为毫秒</td><td>connectTimeout</td></tr><tr><td>响应异常模型</td><td>ResponseError（继承自Error）</td><td>ResponseException（继承自RuntimeException）</td><td>ResponseError（继承自Error）</td><td>ResponseException（继承自Exception）</td><td></td></tr><tr><td>异步模型</td><td>Promise模型</td><td>Coroutines模型</td><td>由PromiseKit提供的Promise模型</td><td>Future模型</td><td></td></tr></tbody></table><p>补充：对于对外暴露的回调函数实现，Turms的Swift客户端没有采用Swift常见的delegate代理模式，而是和其他语言客户端一样通过函数传递逃逸闭包。</p><h2 id="接口的理解方法-重点" tabindex="-1"><a class="header-anchor" href="#接口的理解方法-重点" aria-hidden="true">#</a> 接口的理解方法（重点）</h2><p>Turms所有客户端的接口都非常容易理解与使用。开发者甚至不需要看Turms客户端有什么接口，只需要凭借基本的IM业务知识就能反推Turms会有什么接口。</p><p>一般开发者只需要记住：</p><ul><li>通过<code>new TurmsClient(...)</code>创建Turms客户端实例</li><li>在上文<code>客户端的对外逻辑结构</code>提到的：Turms客户端分为五个服务：userService（用户相关服务）、groupService（群组相关服务）、messageService（消息相关服务）、notificationService（通知相关服务）、storageService（存储相关服务、可选拓展）。</li></ul><p>之后我们就能凭借业务知识反推Turms客户端会有什么接口了，比如：</p><ul><li>用户首先要能登陆，于是先想到其对应的服务<code>userService</code>用户相关服务。既然是<code>登陆</code>所以找找有没有<code>login</code>接口，于是自然地就找到了<code>client.userService.login(...)</code>接口。</li><li>登陆后，用户需要能够发消息，那就先想到<code>messageService</code>消息相关服务，再看看有没有类似<code>sendMessage</code>的接口，于是找到了接口<code>client.messageService.sendMessage(...)</code>接口。</li><li>既然能发消息，那有什么接口能监听收到的消息呢？既然跟消息有关，那依旧想到的是<code>messageService</code>，于是想到接口可能是<code>onMessage</code>、<code>subscribeMessage</code>或<code>addMessageListener</code>，代码里找一找，找到了<code>client.messageService.addMessageListener(...)</code>。</li><li>既然能监听收到的消息，那怎么监听接收到的通知呢？既然跟通知有关，那想到的就是<code>notificationService</code>通知相关类服务，并且既然监听收到的消息的接口叫<code>addMessageListener</code>，那监听通知的接口就应该是<code>addNotificationListener</code>了，于是找到了<code>client.notification.addNotificationListener</code>。</li></ul><p>综上，一般开发者只需凭借基本的业务知识就能反推Turms客户端提供的接口，甚至不需要读Turms客户端的源码。</p><p>而对于高级开发者，Turms客户端也开放了<code>driver</code>对象，让开发者自行实现一些相对底层的操作。另外，如在<code>会话的生命周期</code>提到的，Turms客户端是故意设计的清晰易懂，故意不提供诸如自动重连、自动路由跳转等操作，因为一方面开发者可以很容易地自行实现该类逻辑，另一方面，这类“隐藏”的内部逻辑会使得上层开发者难以把控底层驱动行为，在一些时候反而会成为绊脚石。</p><h2 id="具体示例" tabindex="-1"><a class="header-anchor" href="#具体示例" aria-hidden="true">#</a> 具体示例</h2><p>以下示例包括turms-client-js/kotlin/swift三个版本，并且其作用等价。具体包括了以下业务操作：初始化客户端、登录、监听会话连接断开（下线）、监听通知、监听新消息、查询附近的用户、发送消息、创建群组操作。</p><h3 id="体验示例前的服务端准备工作" tabindex="-1"><a class="header-anchor" href="#体验示例前的服务端准备工作" aria-hidden="true">#</a> 体验示例前的服务端准备工作</h3><ul><li>方案一：无需在本地搭建Turms服务端，用户直接在本地通过客户端API连接Playground上的turms-gateway服务端（WebSocket端口：http://playground.turms.im:10510；TCP端口：http://playground.turms.im:11510）。但注意及时将本地客户端升级到最新版本，以避免出现因为服务端侧的接口更新，导致数据不一致的问题。</li><li>方案二：在application.yaml配置文件中更新以下配置： <ol><li>将<code>turms.gateway.session.enable-authentication</code>设置为false（取消用户登录认证）</li><li>将<code>turms.service.message.allow-sending-messages-to-stranger</code>也设置为true（允许没有用户关系的用户互相发送消息）</li></ol></li><li>方案三：使用自带<code>dev</code>profile配置。因为Turms提供的<code>dev</code>profile已做了上述配置。默认情况下，Turms发布包中的application.yaml的profile字段为空，即默认的profile不是<code>dev</code>，需要您手动配置为<code>dev</code>。</li></ul><h3 id="代码示例" tabindex="-1"><a class="header-anchor" href="#代码示例" aria-hidden="true">#</a> 代码示例</h3><!----></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/turms-im/turms/edit/main/for-developers/client-api.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/docs/for-developers/client-requirements.html" class="" aria-label="版本要求"><!--[--><!--]--> 版本要求 <!--[--><!--]--></a></span><span class="next"><a href="/docs/for-developers/client-session.html" class="" aria-label="会话的生命周期"><!--[--><!--]--> 会话的生命周期 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/docs/assets/app.4eead61a.js" defer></script>
  </body>
</html>
