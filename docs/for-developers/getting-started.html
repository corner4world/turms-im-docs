<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.26">
    <title>搭建与启动 | Turms Documentation</title><meta name="description" content="">
    <link rel="preload" href="/docs/assets/js/runtime~app.69cbd2f4.js" as="script"><link rel="preload" href="/docs/assets/css/styles.31116931.css" as="style"><link rel="preload" href="/docs/assets/js/567.def98e2e.js" as="script"><link rel="preload" href="/docs/assets/js/app.ca345f9b.js" as="script">
    <link rel="stylesheet" href="/docs/assets/css/styles.31116931.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/docs/" class=""><img class="logo" src="https://raw.githubusercontent.com/turms-im/assets/master/logo/pegion.svg" alt="Turms Documentation"><span class="site-name can-hide">Turms Documentation</span></a></span><div class="navbar-links-wrapper" style=""><!--[--><!--]--><nav class="navbar-links can-hide"><!--[--><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/turms-im/turms" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-links"><!--[--><div class="navbar-links-item"><a class="nav-link external" href="https://github.com/turms-im/turms" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-links"><!--[--><!--[--><p class="sidebar-heading sidebar-item">介绍</p><ul class=""><li><!--[--><a href="/docs/intro/" class="nav-link sidebar-item" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/intro/features.html" class="nav-link sidebar-item" aria-label="特性"><!--[--><!--]--> 特性 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/intro/redevelopment.html" class="nav-link sidebar-item" aria-label="关于二次开发"><!--[--><!--]--> 关于二次开发 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item">业务功能</p><ul class=""><li><!--[--><a href="/docs/features/" class="nav-link sidebar-item" aria-label="业务功能介绍"><!--[--><!--]--> 业务功能介绍 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/features/simultaneous-login.html" class="nav-link sidebar-item" aria-label="多端登录"><!--[--><!--]--> 多端登录 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/features/user.html" class="nav-link sidebar-item" aria-label="用户相关功能"><!--[--><!--]--> 用户相关功能 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/features/group.html" class="nav-link sidebar-item" aria-label="群组相关功能"><!--[--><!--]--> 群组相关功能 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/features/message.html" class="nav-link sidebar-item" aria-label="消息相关功能"><!--[--><!--]--> 消息相关功能 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--[--><p class="sidebar-heading sidebar-item active">开发者文档</p><ul class=""><li><!--[--><a aria-current="page" href="/docs/for-developers/getting-started.html" class="router-link-active router-link-exact-active nav-link router-link-active sidebar-item active" aria-label="搭建与启动"><!--[--><!--]--> 搭建与启动 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/docs/for-developers/getting-started.html#自动搭建与启动" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="自动搭建与启动"><!--[--><!--]--> 自动搭建与启动 <!--[--><!--]--></a><ul class="sidebar-sub-items"><li><!--[--><a aria-current="page" href="/docs/for-developers/getting-started.html#单机环境" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="单机环境"><!--[--><!--]--> 单机环境 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a aria-current="page" href="/docs/for-developers/getting-started.html#基于云服务的集群环境" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="基于云服务的集群环境"><!--[--><!--]--> 基于云服务的集群环境 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a aria-current="page" href="/docs/for-developers/getting-started.html#手动搭建与启动" class="router-link-active router-link-exact-active nav-link sidebar-item" aria-label="手动搭建与启动"><!--[--><!--]--> 手动搭建与启动 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--></li><li><!--[--><a href="/docs/for-developers/distribution.html" class="nav-link sidebar-item" aria-label="发布"><!--[--><!--]--> 发布 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/config.html" class="nav-link sidebar-item" aria-label="配置参数"><!--[--><!--]--> 配置参数 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/admin-api.html" class="nav-link sidebar-item" aria-label="管理员API接口"><!--[--><!--]--> 管理员API接口 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/client-api.html" class="nav-link sidebar-item" aria-label="客户端接口"><!--[--><!--]--> 客户端接口 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/status-code.html" class="nav-link sidebar-item" aria-label="状态码"><!--[--><!--]--> 状态码 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/cluster.html" class="nav-link sidebar-item" aria-label="集群的设计与实现"><!--[--><!--]--> 集群的设计与实现 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/system-resource-management.html" class="nav-link sidebar-item" aria-label="系统资源管理"><!--[--><!--]--> 系统资源管理 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/custom-plugin.html" class="nav-link sidebar-item" aria-label="自定义插件"><!--[--><!--]--> 自定义插件 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/architecture.html" class="nav-link sidebar-item" aria-label="架构设计"><!--[--><!--]--> 架构设计 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/schema.html" class="nav-link sidebar-item" aria-label="集合结构设计"><!--[--><!--]--> 集合结构设计 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/observability.html" class="nav-link sidebar-item" aria-label="可观测性体系"><!--[--><!--]--> 可观测性体系 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/security.html" class="nav-link sidebar-item" aria-label="安全"><!--[--><!--]--> 安全 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/anti-spam.html" class="nav-link sidebar-item" aria-label="敏感词过滤"><!--[--><!--]--> 敏感词过滤 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/status-aware.html" class="nav-link sidebar-item" aria-label="状态感知"><!--[--><!--]--> 状态感知 <!--[--><!--]--></a><!----><!--]--></li><li><!--[--><a href="/docs/for-developers/data-analytics.html" class="nav-link sidebar-item" aria-label="数据分析"><!--[--><!--]--> 数据分析 <!--[--><!--]--></a><!----><!--]--></li></ul><!--]--><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="搭建与启动" tabindex="-1"><a class="header-anchor" href="#搭建与启动" aria-hidden="true">#</a> 搭建与启动</h1><h2 id="自动搭建与启动" tabindex="-1"><a class="header-anchor" href="#自动搭建与启动" aria-hidden="true">#</a> 自动搭建与启动</h2><h3 id="单机环境" tabindex="-1"><a class="header-anchor" href="#单机环境" aria-hidden="true">#</a> 单机环境</h3><p>适用场景：搭建流程方便快捷，但无法满足容灾、弹性扩展、零宕机升级与负载均衡等需求，主要用于搭建Demo用于展示，与服务对SLA无要求的用户。</p><h4 id="基于docker-compose" tabindex="-1"><a class="header-anchor" href="#基于docker-compose" aria-hidden="true">#</a> 基于docker-compose</h4><p>通过以下命令，可以全自动地搭建一套完整的Turms最小集群（包含turms-gateway、turms-service与turms-admin）及其依赖服务端（MongoDB分片集群与Redis）</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> clone --depth <span class="token number">1</span> https://github.com/turms-im/turms.git
<span class="token builtin class-name">cd</span> turms
docker plugin <span class="token function">install</span> grafana/loki-docker-driver:latest --alias loki --grant-all-permissions
<span class="token comment"># Or &quot;ENV=dev,demo docker-compose -f docker-compose.standalone.yml --profile monitoring up --force-recreate -d&quot; to run with sidecar services in dev profile</span>
docker-compose -f docker-compose.standalone.yml up --force-recreate
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>等集群完成搭建后，可以通过 http://localhost:6510 访问turms-admin后台管理系统，并输入账号密码（默认均为<code>turms</code>）。如果登录成功，则说明Turms集群搭建成功。</p><p>注意：AWS提供了高性价比的<code>t4g</code>系列EC2实例，但由于t4g系列实例使用了ARM处理器，因此很多应用都无法运行在该类EC2实例上，如<code>bitnami</code>所提供的镜像就均无法运行在该类实例上。~~如果您想要在ARM处理器上运行<code>docker-compose.standalone.yml</code>，您需要先执行下方指令，在本地编译并安装Loki插件，然后才能运行<code>docker-compose.standalone.yml</code>~~由于<code>Loki</code>自身有个Critical级别的Bug（https://github.com/grafana/loki/issues/2361），即当日志无法送达Loki服务端时，直接Freeze我们的服务，因此我们暂时移除了Loki服务，您目前不需要执行下述命令，也可直接运行<code>docker-compose.standalone.yml</code>：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Install Go</span>
<span class="token function">sudo</span> add-apt-repository ppa:longsleep/golang-backports
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> golang-go

<span class="token comment"># Install Loki</span>
<span class="token function">sudo</span> docker plugin <span class="token function">install</span> grafana/loki-docker-driver:latest --alias loki --grant-all-permissions

<span class="token comment"># Build and Enable Loki</span>
<span class="token function">git</span> clone https://github.com/grafana/loki.git
<span class="token builtin class-name">cd</span> loki
<span class="token function">git</span> checkout <span class="token string">&quot;tags/v2.4.1&quot;</span> -b setup
<span class="token function">sudo</span> <span class="token assign-left variable">GOOS</span><span class="token operator">=</span>linux <span class="token assign-left variable">GOARCH</span><span class="token operator">=</span>arm <span class="token assign-left variable">GOARM</span><span class="token operator">=</span><span class="token number">7</span> go build ./clients/cmd/docker-driver
<span class="token comment"># Replace &quot;&lt;ALPHA_NUMERIC_FOLDER&gt;&quot; with the real path on your machine</span>
<span class="token function">sudo</span> <span class="token function">mv</span> docker-driver /var/lib/docker/plugins/<span class="token operator">&lt;</span>ALPHA_NUMERIC_FOLDER<span class="token operator">&gt;</span>/rootfs/bin
<span class="token function">sudo</span> docker plugin <span class="token builtin class-name">enable</span> loki
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>补充：</p><ul><li>配合<code>--profile monitoring</code>（<code>docker-compose -f docker-compose.standalone.yml --profile monitoring up --force-recreate</code>），还可以额外自动搭建Prometheus与Grafana服务端。</li><li>Turms服务端默认使用生产环境配置，不会向控制台打印日志，只会打印日志文件，因此您通过<code>docker logs &lt;TURMS_CONTAINER_ID&gt;</code>是无法查看到Turms服务端的运行日志的。为了方便排查问题，您可以在本地开发测试时，把环境变量设置为<code>ENV=dev</code>，然后再次启动<code>docker-compose.standalone.yml</code>。在dev环境下，Turms会向控制台打印日志，并自动生成测试用的Fake数据，与模拟真实客户端TCP连接与请求</li><li>如果您通过上述指令，无法启动<code>docker-compose.standalone.yml</code>。则确保服务器的<code>docker-compose</code>版本为<code>1.29.x</code>，<code>docker</code>版本为<code>19.x.x</code>或<code>20.x.x</code></li><li>Turms的Playground环境与网站每次都是通过<code>ENV=dev,demo docker-compose -f docker-compose.standalone.yml --profile monitoring up --force-recreate -d</code>这一条命令自动搭建的</li></ul><h4 id="基于terraform与docker-compose" tabindex="-1"><a class="header-anchor" href="#基于terraform与docker-compose" aria-hidden="true">#</a> 基于Terraform与docker-compose</h4><p>（由于Turms目前并没有提供封装好的镜像，因此仍需要使用docker-compose进行环境搭建）</p><p>该方案是在上述docker-compose方案的基础上，引入了Turms自定义的Terraform模块，以帮助用户自动开通并配置VPC、交换机、安全组与单机ECS抢占式实例。在这台ECS上，Terraform会通过user-data系统初始化脚本，来安装docker-compose与Turms等服务，并最终启动Turms单机集群。</p><p>具体操作命令如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> clone --depth <span class="token number">1</span> https://github.com/turms-im/turms.git
<span class="token builtin class-name">cd</span> turms/terraform/alicloud/playground
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ALICLOUD_ACCESS_KEY</span><span class="token operator">=</span><span class="token operator">&lt;</span>your_access_key<span class="token operator">&gt;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ALICLOUD_SECRET_KEY</span><span class="token operator">=</span><span class="token operator">&lt;</span>your_secret_key<span class="token operator">&gt;</span>
terraform init
terraform apply
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在<code>terraform apply</code>命令执行完毕后，等待约3~15分钟（阿里云ECS拉取ghcr镜像很慢），然后再访问<code>http://公网IP:6510</code>（公网IP可以通过查看控制台输出的<code>public_ip</code>或查看云服务的ECS控制台获得），如果可以成功访问turms-admin后台管理系统，则表明搭建成功。</p><p>注意：该方案需要购买与使用云服务，而其开销取决于ECS的运行时长。默认配置下，约一小时0.1元（抢占实例的价格随时有可能波动，因此具体价格请查阅云服务的价目表）</p><h3 id="基于云服务的集群环境" tabindex="-1"><a class="header-anchor" href="#基于云服务的集群环境" aria-hidden="true">#</a> 基于云服务的集群环境</h3><p>适用场景：有容灾、弹性扩展、跨地域部署与负载均衡等需求。该方案提供的各种能力直接与搭建成本挂钩，因此您通常需要修改默认提供的Terraform module配置，以保证配置既能满足您的需求，同时搭建与运维成本最低。</p><p>具体操作命令如下：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> clone --depth <span class="token number">1</span> https://github.com/turms-im/turms.git
<span class="token builtin class-name">cd</span> turms/terraform/alicloud/cluster
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ALICLOUD_ACCESS_KEY</span><span class="token operator">=</span><span class="token operator">&lt;</span>your_access_key<span class="token operator">&gt;</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ALICLOUD_SECRET_KEY</span><span class="token operator">=</span><span class="token operator">&lt;</span>your_secret_key<span class="token operator">&gt;</span>
terraform init
terraform apply
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>该Terraform模块会进行按照互联网应用的常规同城容灾级的部署方案，进行云服务的部署。具体而言包括：</p><ol><li>在一个地域内搭建一个<code>VPC</code>，该VPC下开通2台<code>交换机</code>，代表两个<code>可用区</code></li><li>在上述两个可用区内默认部署一套<code>MongoDB分片集群服务</code>，实现同城容灾</li><li>在一个可用区内默认部署一套<code>Redis服务</code></li><li>为接收发送给Turms ECS的外网流量，开通<code>SLB服务</code></li><li>为实现Turms ECS的外网访问，开通<code>NAT服务</code></li><li>为turms-gateway、turms-service与turms-admin服务端分别搭建各自的<code>安全组</code></li><li>为turms-gateway服务端，开通无公网带宽的<code>ECS实例</code>（默认数量为1）。通过user-data实现turms-gateway服务初始化与执行，并与上述SLB、NAT、安全组、MongoDB、Redis服务绑定</li><li>为turms-service服务端，开通无公网带宽的<code>ECS实例</code>（默认数量为1）。通过user-data实现turms-service服务初始化与执行，并与上述SLB、NAT、安全组、MongoDB、Redis服务绑定</li><li>为turms-admin服务端，开通无公网带宽的<code>ECS实例</code>（默认数量为1）。通过user-data实现turms-admin服务初始化与执行，并与上述安全组服务绑定</li></ol><p>自此整套Turms基础集群搭建完成（未来还会提供诸如日志分析服务等）。若希望了解更多实现细节，请查阅<code>turms/terraform/alicloud/cluster</code>目录下的具体Terraform模块配置</p><h2 id="手动搭建与启动" tabindex="-1"><a class="header-anchor" href="#手动搭建与启动" aria-hidden="true">#</a> 手动搭建与启动</h2><p>适用场景：通用，无特别限制场景。但一般只适用于小规模手动部署。</p><p>若您网络畅通，第一次完成以下全部操作大概需要花费10~30分钟。当您熟练之后，可在1~3分钟完成一整套集群的部署工作。</p><ol><li><p>MongoDB集群搭建（用于业务数据存储、服务发现、配置管理）</p><ul><li><p>下载并安装<a href="https://www.mongodb.com/download-center/community" target="_blank" rel="noopener noreferrer">MongoDB<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>（要求最低版本号为：4.0。推荐版本为最新稳定版）。以RHEL/CentOS为例（具体可参考：https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat）：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> /etc/yum.repos.d/mongodb-org-4.4.repo</span>
[mongodb-org-4.4]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/<span class="token variable">$releasever</span>/mongodb-org/4.4/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-4.4.asc
EOF</span>
yum <span class="token function">install</span> -y mongodb-org
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li><li><p>搭建MongoDB服务端集群（以mlaunch为例。关于mlaunch提供的更多指令，请查阅：http://blog.rueckstiess.com/mtools/mlaunch.html）。</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>pip3 <span class="token function">install</span> mtools<span class="token punctuation">[</span>mlaunch<span class="token punctuation">]</span>
mlaunch init --replicaset --sharded <span class="token number">1</span> --nodes <span class="token number">1</span> --config <span class="token number">1</span> --hostname localhost --port <span class="token number">27017</span> --mongos <span class="token number">1</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注意：</p><ul><li>如果在Windows环境执行<code>pip3 install mtools[mlaunch]</code>命令时，遇到类似<code>error: Microsoft Visual C++ 14.0 or greater is required. Get it with &quot;Microsoft C++ Build Tools&quot;</code>的错误，则您需要先在https://visualstudio.microsoft.com/downloads页面下，下载<code>Visual Studio Installer</code>，并通过它安装<code>MSVC build tools</code>，然后再执行<code>pip3 install mtools[mlaunch]</code>指令。</li><li>请确保MongoDB服务端运行正常，否则Turms服务端启动时会抛出<code>MongoSocketOpenException</code>异常。</li></ul></li></ul></li><li><p>下载、安装并启动Redis服务端（用于实现用户状态管理以及“附近的用户”）。以RHEL/CentOS为例：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>yum <span class="token function">install</span> epel-release
yum update
yum <span class="token function">install</span> redis
systemctl start redis
systemctl <span class="token builtin class-name">enable</span> redis
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>对于Windows平台，可在 <a href="https://github.com/tporadowski/redis/releases" target="_blank" rel="noopener noreferrer">tporadowski/redis<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a> 下载Windows版本供本地开发测试用。</p></li><li><p>Turms集群搭建</p><p>方案一：拉取Turms服务端Docker镜像，并运行：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># Pull and run images</span>
docker run -p <span class="token number">6510</span>:6510 ghcr.io/turms-im/turms-admin
docker run -p <span class="token number">7510</span>:7510 -p <span class="token number">8510</span>:8510 ghcr.io/turms-im/turms-service
docker run --ulimit <span class="token assign-left variable">nofile</span><span class="token operator">=</span><span class="token number">102400</span>:102400 -p <span class="token number">7510</span>:7510 -p <span class="token number">9510</span>:9510 -p <span class="token number">10510</span>:10510 -p <span class="token number">11510</span>:11510 -p <span class="token number">12510</span>:12510 ghcr.io/turms-im/turms-gateway
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>另外，您可以通过volume挂载的方式来使用自定义的<code>application.yaml</code>与<code>jvm.options</code>。如配置<code>-v /your-custom-config-dir:/opt/turms/turms/config</code>。</p><p>方案二：<s>下载并解压<a href="https://github.com/turms-im/turms/releases" target="_blank" rel="noopener noreferrer">Turms服务端<span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span></a>压缩包</s>（由于v.0.10.0尚未发布在release页面中，因此该方案暂不可用），根据下述步骤运行：</p><ul><li><p>（如果您将MongoDB与Redis都安装默认配置安装在本地，可跳过此步骤）根据您的需求配置config/jvm.options、config/application.yaml（您可以在此处配置Turms自定义的配置参数，并且您也可以在此处配置多个MongoDB或mongos的服务端地址。具体可参考：https://docs.mongodb.com/manual/reference/connection-string）。</p></li><li><p>（推荐使用Ansible）在所有需要运行Turms服务端的系统上，运行bin/turms脚本（默认以Thin包形式执行，若需以Fat包形式执行，请在执行脚本时加上<code>-f</code>参数，如：<code>sh run.sh -f</code>。之后再运行turms-gateway服务端。turms-gateway与turms-service服务端会通过MongoDB（作为服务注册中心）来自动寻找其他服务端节点，由此Turms集群开始运作。</p></li></ul><p>方案三：克隆Turms仓库源码，直接通过IDE运行turms-gateway与turms-service服务端。（参考命令：<code>git clone --depth 1 https://github.com/turms-im/turms.git</code>）</p></li></ol><p><strong>提醒</strong></p><ul><li>turms-service服务端在启动时，会自动检测数据库中是否已存在一个角色为<code>ROOT</code>，且账号为<code>turms</code>的超级管理员账号。如果不存在，则turms-service服务端会自动创建一个角色为<code>ROOT</code>、名称与密码均为<code>turms</code>的管理员账号。在生产环境中，请务必记得要修改默认密码。</li><li>上述操作主要用于您初次体验Turms集群使用，若您需将Turms部署在生产环境当中，请务必查阅Wiki手册，了解各种配置参数的意义，以最小的资源消耗，来定制属于您自己的业务需求与业务组合。</li></ul><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="nav-link external meta-item-label" href="https://github.com/turms-im/turms/edit/main/for-developers/getting-started.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><!--[--><span class="sr-only">open in new window</span><!--]--></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><span class="meta-item-info">1/3/2022, 4:19:43 AM</span></div><!----></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/docs/for-developers/distribution.html" class="nav-link" aria-label="发布"><!--[--><!--]--> 发布 <!--[--><!--]--></a> → </span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script src="/docs/assets/js/runtime~app.69cbd2f4.js" defer></script><script src="/docs/assets/js/567.def98e2e.js" defer></script><script src="/docs/assets/js/app.ca345f9b.js" defer></script>
  </body>
</html>
