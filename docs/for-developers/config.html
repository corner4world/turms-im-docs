<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>配置参数 | Turms Documentation</title><meta name="description" content="">
    <link rel="modulepreload" href="/docs/assets/app.2d17c3fa.js"><link rel="modulepreload" href="/docs/assets/config.html.ea94dfe9.js"><link rel="modulepreload" href="/docs/assets/config.html.3ceb62dd.js"><link rel="prefetch" href="/docs/assets/index.html.eff772f1.js"><link rel="prefetch" href="/docs/assets/index.html.7fe21920.js"><link rel="prefetch" href="/docs/assets/index.html.aa1dcd45.js"><link rel="prefetch" href="/docs/assets/group.html.9b648c7f.js"><link rel="prefetch" href="/docs/assets/message.html.8dc0050d.js"><link rel="prefetch" href="/docs/assets/simultaneous-login.html.927f142f.js"><link rel="prefetch" href="/docs/assets/user.html.af9e4f39.js"><link rel="prefetch" href="/docs/assets/admin-api.html.2fa78bb9.js"><link rel="prefetch" href="/docs/assets/anti-spam.html.45803589.js"><link rel="prefetch" href="/docs/assets/architecture.html.dbbb1ef2.js"><link rel="prefetch" href="/docs/assets/chatbot.html.f835c7e7.js"><link rel="prefetch" href="/docs/assets/client-api.html.d0e93dd5.js"><link rel="prefetch" href="/docs/assets/client-identity-access-management.html.16436929.js"><link rel="prefetch" href="/docs/assets/client-metrics.html.be2f9156.js"><link rel="prefetch" href="/docs/assets/client-quick-start.html.d1e77d25.js"><link rel="prefetch" href="/docs/assets/client-requirements.html.453e7169.js"><link rel="prefetch" href="/docs/assets/client-server-protocol.html.00dee417.js"><link rel="prefetch" href="/docs/assets/client-session.html.cb376e9a.js"><link rel="prefetch" href="/docs/assets/client-turms-client-js.html.1d6dbd30.js"><link rel="prefetch" href="/docs/assets/cluster.html.5d2ce6ae.js"><link rel="prefetch" href="/docs/assets/code.html.f467d647.js"><link rel="prefetch" href="/docs/assets/data-analytics.html.f97c00a7.js"><link rel="prefetch" href="/docs/assets/distribution.html.6fc53c11.js"><link rel="prefetch" href="/docs/assets/getting-started.html.8daca426.js"><link rel="prefetch" href="/docs/assets/observability.html.6875589e.js"><link rel="prefetch" href="/docs/assets/plugin.html.deadd71a.js"><link rel="prefetch" href="/docs/assets/redevelopment.html.842a4a6b.js"><link rel="prefetch" href="/docs/assets/rules.html.7c53dfb3.js"><link rel="prefetch" href="/docs/assets/schema.html.c85c727a.js"><link rel="prefetch" href="/docs/assets/security.html.8b3514cf.js"><link rel="prefetch" href="/docs/assets/status-aware.html.ccee6ca3.js"><link rel="prefetch" href="/docs/assets/status-code.html.b1f8dede.js"><link rel="prefetch" href="/docs/assets/storage.html.3147dfbe.js"><link rel="prefetch" href="/docs/assets/system-resource-management.html.e4d4a4ff.js"><link rel="prefetch" href="/docs/assets/testing.html.b49054d3.js"><link rel="prefetch" href="/docs/assets/turms-admin.html.ccdab702.js"><link rel="prefetch" href="/docs/assets/404.html.c038a05a.js"><link rel="prefetch" href="/docs/assets/index.html.fdfa6a8b.js"><link rel="prefetch" href="/docs/assets/index.html.e4ce1f64.js"><link rel="prefetch" href="/docs/assets/index.html.a4f615cb.js"><link rel="prefetch" href="/docs/assets/group.html.c4bb1f23.js"><link rel="prefetch" href="/docs/assets/message.html.88924852.js"><link rel="prefetch" href="/docs/assets/simultaneous-login.html.9a0b9e33.js"><link rel="prefetch" href="/docs/assets/user.html.7aa821ec.js"><link rel="prefetch" href="/docs/assets/admin-api.html.49c81c24.js"><link rel="prefetch" href="/docs/assets/anti-spam.html.a5f4cae2.js"><link rel="prefetch" href="/docs/assets/architecture.html.0d83e8e5.js"><link rel="prefetch" href="/docs/assets/chatbot.html.aa63da19.js"><link rel="prefetch" href="/docs/assets/client-api.html.a6f5a9a5.js"><link rel="prefetch" href="/docs/assets/client-identity-access-management.html.65e73dff.js"><link rel="prefetch" href="/docs/assets/client-metrics.html.cc5e07a1.js"><link rel="prefetch" href="/docs/assets/client-quick-start.html.a56dad31.js"><link rel="prefetch" href="/docs/assets/client-requirements.html.56d0792a.js"><link rel="prefetch" href="/docs/assets/client-server-protocol.html.a05f4525.js"><link rel="prefetch" href="/docs/assets/client-session.html.59f1d6ef.js"><link rel="prefetch" href="/docs/assets/client-turms-client-js.html.204218ba.js"><link rel="prefetch" href="/docs/assets/cluster.html.3d0ee725.js"><link rel="prefetch" href="/docs/assets/code.html.07836004.js"><link rel="prefetch" href="/docs/assets/data-analytics.html.dfe90f3c.js"><link rel="prefetch" href="/docs/assets/distribution.html.c1a78d53.js"><link rel="prefetch" href="/docs/assets/getting-started.html.f3da431e.js"><link rel="prefetch" href="/docs/assets/observability.html.42a1f7ca.js"><link rel="prefetch" href="/docs/assets/plugin.html.47481957.js"><link rel="prefetch" href="/docs/assets/redevelopment.html.591e755b.js"><link rel="prefetch" href="/docs/assets/rules.html.64e830a5.js"><link rel="prefetch" href="/docs/assets/schema.html.246df3f4.js"><link rel="prefetch" href="/docs/assets/security.html.6a4f7b77.js"><link rel="prefetch" href="/docs/assets/status-aware.html.41b469d5.js"><link rel="prefetch" href="/docs/assets/status-code.html.46ef571b.js"><link rel="prefetch" href="/docs/assets/storage.html.befa53d9.js"><link rel="prefetch" href="/docs/assets/system-resource-management.html.977d61a0.js"><link rel="prefetch" href="/docs/assets/testing.html.18b7a570.js"><link rel="prefetch" href="/docs/assets/turms-admin.html.35ca14ed.js"><link rel="prefetch" href="/docs/assets/404.html.91e01783.js"><link rel="prefetch" href="/docs/assets/mermaid.esm.min.e3b5d21d.js">
    <link rel="stylesheet" href="/docs/assets/style.25523ee4.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/docs/" class=""><img class="logo" src="https://raw.githubusercontent.com/turms-im/assets/master/logo/pegion.svg" alt="Turms Documentation"><span class="site-name can-hide">Turms Documentation</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/turms-im/turms" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/turms-im/turms" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/docs/README.md" class="sidebar-item sidebar-heading" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a href="/docs/community/README.md" class="sidebar-item sidebar-heading" aria-label="社区常见问题"><!--[--><!--]--> 社区常见问题 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">业务功能 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/docs/features/" class="sidebar-item" aria-label="业务功能介绍"><!--[--><!--]--> 业务功能介绍 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/simultaneous-login.html" class="sidebar-item" aria-label="多端登录"><!--[--><!--]--> 多端登录 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/user.html" class="sidebar-item" aria-label="用户相关功能"><!--[--><!--]--> 用户相关功能 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/group.html" class="sidebar-item" aria-label="群组相关功能"><!--[--><!--]--> 群组相关功能 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/message.html" class="sidebar-item" aria-label="消息相关功能"><!--[--><!--]--> 消息相关功能 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">服务端指南 <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item active">部署 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/getting-started.html" class="sidebar-item" aria-label="搭建与启动"><!--[--><!--]--> 搭建与启动 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/distribution.html" class="sidebar-item" aria-label="发布"><!--[--><!--]--> 发布 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/for-developers/config.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="配置参数"><!--[--><!--]--> 配置参数 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/docs/for-developers/config.html#重要性" class="router-link-active router-link-exact-active sidebar-item" aria-label="重要性"><!--[--><!--]--> 重要性 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/for-developers/config.html#本地配置与全局配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="本地配置与全局配置"><!--[--><!--]--> 本地配置与全局配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/for-developers/config.html#配置分类" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置分类"><!--[--><!--]--> 配置分类 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/docs/for-developers/config.html#jvm配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="JVM配置"><!--[--><!--]--> JVM配置 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/for-developers/config.html#turms服务端配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="Turms服务端配置"><!--[--><!--]--> Turms服务端配置 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/docs/for-developers/config.html#补充" class="router-link-active router-link-exact-active sidebar-item" aria-label="补充"><!--[--><!--]--> 补充 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/docs/for-developers/config.html#服务端默认端口号" class="router-link-active router-link-exact-active sidebar-item" aria-label="服务端默认端口号"><!--[--><!--]--> 服务端默认端口号 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">设计 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/architecture.html" class="sidebar-item" aria-label="架构设计"><!--[--><!--]--> 架构设计 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/schema.html" class="sidebar-item" aria-label="集合结构设计"><!--[--><!--]--> 集合结构设计 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/status-aware.html" class="sidebar-item" aria-label="状态感知"><!--[--><!--]--> 状态感知 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">开发 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/redevelopment.html" class="sidebar-item" aria-label="关于二次开发"><!--[--><!--]--> 关于二次开发 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/rules.html" class="sidebar-item" aria-label="开发基本规约"><!--[--><!--]--> 开发基本规约 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/plugin.html" class="sidebar-item" aria-label="自定义插件"><!--[--><!--]--> 自定义插件 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/code.html" class="sidebar-item" aria-label="源码"><!--[--><!--]--> 源码 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/testing.html" class="sidebar-item" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">主要模块 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/cluster.html" class="sidebar-item" aria-label="集群的设计与实现"><!--[--><!--]--> 集群的设计与实现 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/system-resource-management.html" class="sidebar-item" aria-label="系统资源管理"><!--[--><!--]--> 系统资源管理 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/observability.html" class="sidebar-item" aria-label="可观测性体系"><!--[--><!--]--> 可观测性体系 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/security.html" class="sidebar-item" aria-label="安全"><!--[--><!--]--> 安全 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/storage.html" class="sidebar-item" aria-label="存储服务"><!--[--><!--]--> 存储服务 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/chatbot.html" class="sidebar-item" aria-label="聊天机器人"><!--[--><!--]--> 聊天机器人 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/anti-spam.html" class="sidebar-item" aria-label="敏感词过滤"><!--[--><!--]--> 敏感词过滤 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/data-analytics.html" class="sidebar-item" aria-label="数据分析"><!--[--><!--]--> 数据分析 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">客户端指南 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/client-quick-start.html" class="sidebar-item" aria-label="Quick Start"><!--[--><!--]--> Quick Start <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-requirements.html" class="sidebar-item" aria-label="版本要求"><!--[--><!--]--> 版本要求 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-api.html" class="sidebar-item" aria-label="接口"><!--[--><!--]--> 接口 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-session.html" class="sidebar-item" aria-label="会话的生命周期"><!--[--><!--]--> 会话的生命周期 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-metrics.html" class="sidebar-item" aria-label="度量数据"><!--[--><!--]--> 度量数据 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-identity-access-management.html" class="sidebar-item" aria-label="身份与访问管理"><!--[--><!--]--> 身份与访问管理 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-server-protocol.html" class="sidebar-item" aria-label="与服务端通信时使用的数据格式"><!--[--><!--]--> 与服务端通信时使用的数据格式 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-turms-client-js.html" class="sidebar-item" aria-label="turms-client-js共享上下文"><!--[--><!--]--> turms-client-js共享上下文 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/docs/for-developers/turms-admin.html" class="sidebar-item sidebar-heading" aria-label="turms-admin"><!--[--><!--]--> turms-admin <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">手册 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/admin-api.html" class="sidebar-item" aria-label="管理员API接口"><!--[--><!--]--> 管理员API接口 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/status-code.html" class="sidebar-item" aria-label="状态码"><!--[--><!--]--> 状态码 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="配置参数" tabindex="-1"><a class="header-anchor" href="#配置参数" aria-hidden="true">#</a> 配置参数</h1><h2 id="重要性" tabindex="-1"><a class="header-anchor" href="#重要性" aria-hidden="true">#</a> 重要性</h2><p>即时通讯的业务场景繁多，因此不同业务对硬件资源有着<strong>天差地别</strong>的要求（比如：需要数据库的架构与不需要数据库的架构）。 为了有效利用服务器资源，请务必细心了解Turms服务端所提供的配置参数。</p><ul><li><p>场景一：100%的消息可达率 vs 主动抛弃消息</p><ul><li>在社交应用中，一般都会要求消息有100%的可达率。反之，对于在直播聊天室应用中，服务端甚至会专门根据消息优先级与服务端负载，来主动地抛弃用户消息或是把消息只发送给聊天室中的部分用户。</li><li>对于前者，Turms使用Redis来拉取会话级别的递增<code>sequence ID</code>来实现消息的100%必达。对于后者，Turms会根据内存中的消息与服务端负载信息来主动抛弃消息。二者对于消息可达率有着完全不同但又都合理的需求，因此二者的实现对于硬件配置也有着截然不同的要求。</li></ul></li><li><p>场景二：读扩散消息存储 vs 零消息存储</p><ul><li><p>A应用是一款主要面向商务客户的即时通讯应用。这款应用有一个需求：当一名用户在商务群里发送了一条消息，该用户能够得知群组中其他<strong>每一名用户</strong>是否已读该消息，就算该用户发完消息就下线了，当其再次上线时，仍能查询其他人对该消息的已读状态。</p><p>因此，如果一个商务群有100名用户，当其中一名用户发出一条消息时，Turms需要存储1条Message与1条Conversation（Turms采用读扩散消息模型，另外请注意：该条Conversation记录会携带99个群成员的最后已读时间）。</p></li><li><p>B应用是一款直播弹幕聊天应用，它对消息的处理非常随意。当一名用户在一个直播频道发出一条消息后，该用户不仅无需得知其他用户的已读状态，甚至连消息本身都不要求存储（即无离线消息需求）。</p><p>因此，如果一个直播频道有100名，当其中一名用户发出一条消息时，Turms需要存储0条Message与0条Conversation记录。</p></li><li><p>对比A应用需要消息存储功能，而B应用不用。因此在B应用的架构设计中甚至都不要用到存储消息的表（当然，实际应用中一般还是会存储用户消息来做用户行为分析）。因此二者对硬件需求也截然不同。</p></li></ul></li></ul><h2 id="本地配置与全局配置" tabindex="-1"><a class="header-anchor" href="#本地配置与全局配置" aria-hidden="true">#</a> 本地配置与全局配置</h2><p>Turms服务端具有本地配置与全局配置两大类配置，其中：</p><table><thead><tr><th></th><th>本地配置</th><th>全局配置</th></tr></thead><tbody><tr><td>应用域</td><td>仅对当前节点生效</td><td>对集群中所有节点生效</td></tr><tr><td>存储位置</td><td>存储在本地的<code>application-[profile].yaml</code>文件中</td><td>存储在MongoDB数据库中<code>turms-config/shared-cluster-properties</code>集合中</td></tr><tr><td>可变</td><td>对于标有<code>MutableProperty</code>注释的属性，用户都能通过供管理员专用的API接口在Turms集群运行时进行零停机实时更新</td><td>同左</td></tr></tbody></table><h2 id="配置分类" tabindex="-1"><a class="header-anchor" href="#配置分类" aria-hidden="true">#</a> 配置分类</h2><p>配置分为两大类，一类是JVM的配置，一类是Turms服务端的配置。</p><h3 id="jvm配置" tabindex="-1"><a class="header-anchor" href="#jvm配置" aria-hidden="true">#</a> JVM配置</h3><p>turms-gateway的JVM默认配置文件为：<code>turms-gateway/dist/config/jvm.options</code></p><p>turms-service的JVM默认配置文件为：<code>turms-service/dist/config/jvm.options</code>。</p><p>用户一般使用默认的JVM配置即可，不需要自行修改JVM配置。</p><p>如果用户想修改JVM配置，可以通过以下两种方式：</p><ol><li><p>修改环境变量<code>TURMS_GATEWAY_JVM_CONF</code>（对于turms-gateway）或<code>TURMS_SERVICE_JVM_CONF</code>（对于turms-service），并指向自定义的JVM配置文件，以使用完全自定义的JVM配置。下文以修改turms-gateway的JVM配置为例，具体修改方法：</p><ol><li><p>如果通过<code>run.sh</code>脚本启动，则可以使用类似<code>export TURMS_GATEWAY_JVM_CONF=&lt;your-jvm-options-file-path&gt; &amp;&amp; sh run.sh -f</code>来设置环境变量并启动。</p></li><li><p>如果通过Docker镜像启动，则可以使用类似：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> turms-gateway <span class="token parameter variable">--ulimit</span> <span class="token assign-left variable">nofile</span><span class="token operator">=</span><span class="token number">1048576</span> <span class="token punctuation">\</span>
  --memory-swappiness<span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">7510</span>:7510 <span class="token parameter variable">-p</span> <span class="token number">9510</span>:9510 <span class="token parameter variable">-p</span> <span class="token number">10510</span>:10510 <span class="token parameter variable">-p</span> <span class="token number">11510</span>:11510 <span class="token parameter variable">-p</span> <span class="token number">12510</span>:12510 <span class="token punctuation">\</span>
  --health-cmd<span class="token operator">=</span><span class="token string">&quot;curl -I --silent $<span class="token variable">${HOST}</span>:9510/health || exit 1&quot;</span> <span class="token punctuation">\</span>
  --health-interval<span class="token operator">=</span>5s <span class="token punctuation">\</span>
  --health-timeout<span class="token operator">=</span>5s <span class="token punctuation">\</span>
  --health-retries<span class="token operator">=</span><span class="token number">3</span> <span class="token punctuation">\</span>
  --health-start-period<span class="token operator">=</span>60s <span class="token punctuation">\</span>
  <span class="token parameter variable">-e</span> <span class="token assign-left variable">TURMS_GATEWAY_JVM_CONF</span><span class="token operator">=</span><span class="token operator">&lt;</span>your-jvm-options-file-path<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
  ghcr.io/turms-im/turms-gateway
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：上述的<code>TURMS_GATEWAY_JVM_CONF</code>路径指向的是镜像内部的路径，而非宿主机的路径。如果想使用宿主机里的配置文件，则需要使用Docker的挂载机制，如：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> turms-gateway <span class="token parameter variable">--ulimit</span> <span class="token assign-left variable">nofile</span><span class="token operator">=</span><span class="token number">1048576</span> <span class="token punctuation">\</span>
  --memory-swappiness<span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">-p</span> <span class="token number">7510</span>:7510 <span class="token parameter variable">-p</span> <span class="token number">9510</span>:9510 <span class="token parameter variable">-p</span> <span class="token number">10510</span>:10510 <span class="token parameter variable">-p</span> <span class="token number">11510</span>:11510 <span class="token parameter variable">-p</span> <span class="token number">12510</span>:12510 <span class="token punctuation">\</span>
  --health-cmd<span class="token operator">=</span><span class="token string">&quot;curl -I --silent $<span class="token variable">${HOST}</span>:9510/health || exit 1&quot;</span> <span class="token punctuation">\</span>
  --health-interval<span class="token operator">=</span>5s <span class="token punctuation">\</span>
  --health-timeout<span class="token operator">=</span>5s <span class="token punctuation">\</span>
  --health-retries<span class="token operator">=</span><span class="token number">3</span> <span class="token punctuation">\</span>
  --health-start-period<span class="token operator">=</span>60s <span class="token punctuation">\</span>
  <span class="token parameter variable">-v</span> <span class="token operator">&lt;</span>your-jvm-options-file-path<span class="token operator">&gt;</span>:/opt/turms/turms-gateway/config/jvm.options:ro <span class="token punctuation">\</span>
  ghcr.io/turms-im/turms-gateway
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>如果通过Docker Compose，则可以使用类似：</p><!----><p>注意：上述的<code>TURMS_GATEWAY_JVM_CONF</code>路径指向的是镜像内部的路径，而非宿主机的路径。如果想使用宿主机里的配置文件，则需要修改<code>docker-compose.standalone.yml</code>配置文件，以使用Docker的挂载机制，如：</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">turms-gateway</span><span class="token punctuation">:</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> &lt;your<span class="token punctuation">-</span>jvm<span class="token punctuation">-</span>options<span class="token punctuation">-</span>file<span class="token punctuation">-</span>path<span class="token punctuation">&gt;</span><span class="token punctuation">:</span>/opt/turms/turms<span class="token punctuation">-</span>gateway/config/jvm.options<span class="token punctuation">:</span>ro
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol></li><li><p>修改环境变量<code>TURMS_GATEWAY_JVM_OPTS</code>（对于turms-gateway）或<code>TURMS_SERVICE_JVM_OPTS</code>（对于turms-service），以在JVM配置文件的基础上，附加自定义的JVM配置，并覆盖已声明的JVM配置。具体修改方法同上，故不赘述。</p><p>注意：该变量的格式为：<code>-D&lt;name&gt;=&lt;value&gt; -D&lt;name&gt;=&lt;value&gt;</code>，如：<code>-Dspring.profiles.active=DEV -Dturms.cluster.discovery.address.advertise-host=myturms</code>。</p></li></ol><h3 id="turms服务端配置" tabindex="-1"><a class="header-anchor" href="#turms服务端配置" aria-hidden="true">#</a> Turms服务端配置</h3><p>Turms配置分为三大类：Turms Service配置、Turms Gateway配置，以及Common通用配置。Turms Service配置对应turms服务端独有的配置，Turms Gateway配置对应turms-gateway服务端独有的配置，而Common通用配置可以被turms和turms-gateway服务端共用。</p><h4 id="配置方法" tabindex="-1"><a class="header-anchor" href="#配置方法" aria-hidden="true">#</a> 配置方法</h4><ol><li>前文提到的<code>TURMS_GATEWAY_JVM_CONF</code>或<code>TURMS_SERVICE_JVM_CONF</code>，与<code>TURMS_GATEWAY_JVM_OPTS</code>或<code>TURMS_SERVICE_JVM_OPTS</code>也都可以被用来配置Turms服务端的参数。</li><li>修改<code>application.yaml</code>下的配置文件。具体方法： <ol><li>直接修改仓库内服务端下的<code>application.yaml</code>文件。因为如果修改了配置源文件，那用户就不能使用Turms官方提供的Docker镜像了，并且还需要自行打包成JAR包并制作镜像，因此这种方式一般只用于本地开发测试用，不用于线上环境。</li><li>使用前文提到的Docker挂载的方式，将自定义的服务端配置文件挂载到<code>/opt/turms/turms-gateway/config/application.yaml</code>路径上。</li></ol></li></ol><h4 id="配置集-profiles" tabindex="-1"><a class="header-anchor" href="#配置集-profiles" aria-hidden="true">#</a> 配置集（Profiles）</h4><p>如果开发者需要对同一个Turms服务端配置与切换使用不同的配置，则可以使用配置集。</p><p>默认情况下，Turms服务端源码中硬编码的配置与<code>application.yaml</code>文件中指定的配置就是默认生产环境的配置。如果开发者想要切换使用其他配置集，则可以通过修改<code>application.yaml</code>文件中的<code>spring.profiles.active</code>配置来使用其他配置集。</p><p>比如常见的用例：在本地开发调试时，想将生产环境配置，切换成默认的开发环境配置，则开发者可以将<code>application.yaml</code>文件中的<code>spring.profiles.active</code>值修改为<code>dev</code>，这样Turms服务端就会采用<code>application.yaml</code>与<code>application-dev.yaml</code>（默认开发环境配置）两个文件中指定的配置，且<code>application-dev.yaml</code>文件中的配置优先级更高，将覆盖默认配置。</p><h4 id="配置参数介绍" tabindex="-1"><a class="header-anchor" href="#配置参数介绍" aria-hidden="true">#</a> 配置参数介绍</h4><p>由于所有的配置项高达上百个，直接看代码比看文档更加直观，因此推荐您直接查阅<code>im.turms.server.common.infra.property</code>目录下各配置类，下文仅对大的分类做简要介绍。</p><p>提醒：您在本地编译<code>turms/turms-gateway</code>服务端项目后，编译器会生成<code>target/classes/META-INF/spring-configuration-metadata.json</code>文件。IntelliJ IDEA 能够自动检测到该文件，并在您输入Turms相关配置的时提供配置提示与补全功能，如下图所示：</p><p><img src="https://raw.githubusercontent.com/turms-im/assets/master/turms/configuration-code-completion.png" alt=""></p><h5 id="tumrs-service配置" tabindex="-1"><a class="header-anchor" href="#tumrs-service配置" aria-hidden="true">#</a> Tumrs Service配置</h5><table><thead><tr><th>类别</th><th>类</th><th>字段名</th><th>描述</th><th>补充</th></tr></thead><tbody><tr><td>管理员API</td><td>AdminApiProperties</td><td>adminApi</td><td>管理员API接口相关配置</td><td></td></tr><tr><td>客户端API</td><td>ClientApiProperties</td><td>clientApi</td><td>客户端API接口相关配置</td><td></td></tr><tr><td>Fake数据</td><td>FakeProperties</td><td>fake</td><td>Fake数据相关配置</td><td></td></tr><tr><td>数据源</td><td>MongoProperties</td><td>mongo</td><td>MongoDB数据库相关配置</td><td>Turms完全复用MongoDB的URI配置。参考文档：<br>https://docs.mongodb.com/manual/reference/connection-string/</td></tr><tr><td></td><td>TurmsRedisProperties</td><td>redis</td><td>Redis数据库相关配置</td><td></td></tr><tr><td>统计</td><td>StatisticsProperties</td><td>statistics</td><td>统计相关配置</td><td></td></tr><tr><td>通知</td><td>NotificationProperties</td><td>notification</td><td>通知相关配置</td><td></td></tr><tr><td>文件存储</td><td>StorageProperties</td><td>storage</td><td>存储相关配置</td><td></td></tr><tr><td>业务行为</td><td>UserProperties</td><td>user</td><td>用户相关配置</td><td></td></tr><tr><td></td><td>GroupProperties</td><td>group</td><td>群组相关配置</td><td></td></tr><tr><td></td><td>ConversationProperties</td><td>conversation</td><td>消息会话服务相关配置</td><td></td></tr><tr><td></td><td>MessageProperties</td><td>message</td><td>消息服务相关配置</td><td></td></tr></tbody></table><h5 id="turms-gateway配置" tabindex="-1"><a class="header-anchor" href="#turms-gateway配置" aria-hidden="true">#</a> Turms Gateway配置</h5><table><thead><tr><th>类别</th><th>类</th><th>字段名</th><th>描述</th></tr></thead><tbody><tr><td>管理员API</td><td>AdminApiProperties</td><td>adminApi</td><td>管理员API接口相关配置</td></tr><tr><td>客户端API</td><td>ClientApiProperties</td><td>clientApi</td><td>面向客户端的HTTP接入层相关配置（即ReasonController的相关配置）</td></tr><tr><td></td><td>NotificationLoggingProperties</td><td>notificationLogging</td><td>通知日志相关配置</td></tr><tr><td>服务接口</td><td>UdpProperties</td><td>udp</td><td>UDP服务端相关配置</td></tr><tr><td></td><td>TcpProperties</td><td>tcp</td><td>TCP服务端相关配置</td></tr><tr><td></td><td>WebSocketProperties</td><td>websocket</td><td>WebSocket服务端相关配置</td></tr><tr><td></td><td>DiscoveryProperties</td><td>serviceDiscovery</td><td>服务发现相关配置</td></tr><tr><td>Fake数据</td><td>FakeProperties</td><td>fake</td><td>Fake数据相关配置</td></tr><tr><td>数据源</td><td>MongoProperties</td><td>mongo</td><td>MongoDB数据库相关配置</td></tr><tr><td></td><td>TurmsRedisProperties</td><td>redis</td><td>Redis数据库相关配置</td></tr><tr><td>业务行为</td><td>SimultaneousLoginProperties</td><td>simultaneousLogin</td><td>多端登录相关配置</td></tr><tr><td></td><td>SessionProperties</td><td>session</td><td>会话相关配置</td></tr></tbody></table><h5 id="common通用配置" tabindex="-1"><a class="header-anchor" href="#common通用配置" aria-hidden="true">#</a> Common通用配置</h5><table><thead><tr><th>类</th><th>字段名</th><th>描述</th></tr></thead><tbody><tr><td>ClusterProperties</td><td>cluster</td><td>集群相关配置。包括配置当前运行节点信息、服务发现注册信息、配置中心信息、RPC参数</td></tr><tr><td>HealthCheckProperties</td><td>healthCheck</td><td>监控节点健康状态</td></tr><tr><td>IpProperties</td><td>ip</td><td>公网IP探测相关配置</td></tr><tr><td>LocationProperties</td><td>location</td><td>用户坐标相关配置</td></tr><tr><td>LoggingProperties</td><td>logging</td><td>基础日志配置</td></tr><tr><td>PluginProperties</td><td>plugin</td><td>插件相关配置</td></tr><tr><td>SecurityProperties</td><td>security</td><td>用户与管理员密码加密相关配置</td></tr><tr><td>UserStatusProperties</td><td>userStatus</td><td>用户会话（连接）状态相关配置</td></tr></tbody></table><h2 id="补充" tabindex="-1"><a class="header-anchor" href="#补充" aria-hidden="true">#</a> 补充</h2><h3 id="服务端默认端口号" tabindex="-1"><a class="header-anchor" href="#服务端默认端口号" aria-hidden="true">#</a> 服务端默认端口号</h3><table><thead><tr><th>服务端</th><th>端口</th><th>作用</th></tr></thead><tbody><tr><td>turms-admin</td><td>6510（HTTP）</td><td>提供后台管理员系统的Web页面</td></tr><tr><td>turms-service/turms-gateway</td><td>7510（TCP）</td><td>供turms-service与turms-gateway服务端的RPC使用</td></tr><tr><td>turms-service</td><td>8510（HTTP）</td><td>提供admin API与metrics API</td></tr><tr><td>turms-gateway</td><td>9510（HTTP）</td><td>提供metrics API</td></tr><tr><td>turms-gateway</td><td>10510（WebSocket）</td><td>与客户端交互</td></tr><tr><td>turms-gateway</td><td>11510（TCP）</td><td>与客户端交互（Swift客户端暂不支持）</td></tr><tr><td>turms-gateway</td><td>12510（UDP）</td><td>与客户端交互（客户端均暂不支持）。<br>注意：UDP服务端为实验性功能，并不在第一版发布计划中</td></tr></tbody></table></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/turms-im/turms/edit/main/for-developers/config.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/docs/for-developers/distribution.html" class="" aria-label="发布"><!--[--><!--]--> 发布 <!--[--><!--]--></a></span><!----></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/docs/assets/app.2d17c3fa.js" defer></script>
  </body>
</html>
