<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>存储服务 | Turms Documentation</title><meta name="description" content="">
    <link rel="modulepreload" href="/docs/assets/app.8901c5ed.js"><link rel="modulepreload" href="/docs/assets/storage.html.c5a7de64.js"><link rel="modulepreload" href="/docs/assets/storage.html.708aa77e.js"><link rel="prefetch" href="/docs/assets/index.html.f84e6a83.js"><link rel="prefetch" href="/docs/assets/index.html.898c556a.js"><link rel="prefetch" href="/docs/assets/index.html.8b08304d.js"><link rel="prefetch" href="/docs/assets/group.html.a286c86f.js"><link rel="prefetch" href="/docs/assets/message.html.808b858a.js"><link rel="prefetch" href="/docs/assets/simultaneous-login.html.4ba65866.js"><link rel="prefetch" href="/docs/assets/user.html.b6239916.js"><link rel="prefetch" href="/docs/assets/admin-api.html.e224b78c.js"><link rel="prefetch" href="/docs/assets/anti-spam.html.e8af3c74.js"><link rel="prefetch" href="/docs/assets/architecture.html.f83dc209.js"><link rel="prefetch" href="/docs/assets/client-api.html.cbfad670.js"><link rel="prefetch" href="/docs/assets/client-identity-access-management.html.55072558.js"><link rel="prefetch" href="/docs/assets/client-metrics.html.ce326f5f.js"><link rel="prefetch" href="/docs/assets/client-quick-start.html.ea684fed.js"><link rel="prefetch" href="/docs/assets/client-requirements.html.599ce4e0.js"><link rel="prefetch" href="/docs/assets/client-server-protocol.html.5e3cfba9.js"><link rel="prefetch" href="/docs/assets/client-session.html.cc913fc9.js"><link rel="prefetch" href="/docs/assets/client-turms-client-js.html.2b65f921.js"><link rel="prefetch" href="/docs/assets/cluster.html.1a9b534a.js"><link rel="prefetch" href="/docs/assets/code.html.4379315e.js"><link rel="prefetch" href="/docs/assets/config.html.f4f79ba2.js"><link rel="prefetch" href="/docs/assets/data-analytics.html.12429a54.js"><link rel="prefetch" href="/docs/assets/distribution.html.4db5ff57.js"><link rel="prefetch" href="/docs/assets/getting-started.html.855d4d19.js"><link rel="prefetch" href="/docs/assets/observability.html.ef1dcede.js"><link rel="prefetch" href="/docs/assets/plugin.html.51677da9.js"><link rel="prefetch" href="/docs/assets/redevelopment.html.3c71305d.js"><link rel="prefetch" href="/docs/assets/rules.html.05320870.js"><link rel="prefetch" href="/docs/assets/schema.html.01ea0c3b.js"><link rel="prefetch" href="/docs/assets/security.html.57a33696.js"><link rel="prefetch" href="/docs/assets/status-aware.html.1f2d42cd.js"><link rel="prefetch" href="/docs/assets/status-code.html.6529545b.js"><link rel="prefetch" href="/docs/assets/system-resource-management.html.0c1cdd39.js"><link rel="prefetch" href="/docs/assets/testing.html.204f4e83.js"><link rel="prefetch" href="/docs/assets/turms-admin.html.385a9413.js"><link rel="prefetch" href="/docs/assets/404.html.c038a05a.js"><link rel="prefetch" href="/docs/assets/index.html.b1ef2954.js"><link rel="prefetch" href="/docs/assets/index.html.425415e7.js"><link rel="prefetch" href="/docs/assets/index.html.413b9916.js"><link rel="prefetch" href="/docs/assets/group.html.6c694a04.js"><link rel="prefetch" href="/docs/assets/message.html.2de10c64.js"><link rel="prefetch" href="/docs/assets/simultaneous-login.html.58f79ea8.js"><link rel="prefetch" href="/docs/assets/user.html.aded2d7b.js"><link rel="prefetch" href="/docs/assets/admin-api.html.98258f9a.js"><link rel="prefetch" href="/docs/assets/anti-spam.html.c3436c90.js"><link rel="prefetch" href="/docs/assets/architecture.html.83726ac1.js"><link rel="prefetch" href="/docs/assets/client-api.html.88844616.js"><link rel="prefetch" href="/docs/assets/client-identity-access-management.html.828e5a85.js"><link rel="prefetch" href="/docs/assets/client-metrics.html.a2b21c6d.js"><link rel="prefetch" href="/docs/assets/client-quick-start.html.48c188c5.js"><link rel="prefetch" href="/docs/assets/client-requirements.html.40755fe9.js"><link rel="prefetch" href="/docs/assets/client-server-protocol.html.8e410341.js"><link rel="prefetch" href="/docs/assets/client-session.html.49c0b13b.js"><link rel="prefetch" href="/docs/assets/client-turms-client-js.html.ba06a2b4.js"><link rel="prefetch" href="/docs/assets/cluster.html.8c578188.js"><link rel="prefetch" href="/docs/assets/code.html.dd5a6037.js"><link rel="prefetch" href="/docs/assets/config.html.fdaea063.js"><link rel="prefetch" href="/docs/assets/data-analytics.html.ab5db9fe.js"><link rel="prefetch" href="/docs/assets/distribution.html.c2addd9f.js"><link rel="prefetch" href="/docs/assets/getting-started.html.7e93da7f.js"><link rel="prefetch" href="/docs/assets/observability.html.4e6306c3.js"><link rel="prefetch" href="/docs/assets/plugin.html.5f04b0e0.js"><link rel="prefetch" href="/docs/assets/redevelopment.html.918a7e03.js"><link rel="prefetch" href="/docs/assets/rules.html.30caf8db.js"><link rel="prefetch" href="/docs/assets/schema.html.1a87e7b8.js"><link rel="prefetch" href="/docs/assets/security.html.d0b4064f.js"><link rel="prefetch" href="/docs/assets/status-aware.html.3e8e3d7e.js"><link rel="prefetch" href="/docs/assets/status-code.html.6f332381.js"><link rel="prefetch" href="/docs/assets/system-resource-management.html.c68f7456.js"><link rel="prefetch" href="/docs/assets/testing.html.db916d27.js"><link rel="prefetch" href="/docs/assets/turms-admin.html.1557eabc.js"><link rel="prefetch" href="/docs/assets/404.html.c1adb9bc.js"><link rel="prefetch" href="/docs/assets/mermaid.esm.min.e3b5d21d.js">
    <link rel="stylesheet" href="/docs/assets/style.25523ee4.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/docs/" class=""><img class="logo" src="https://raw.githubusercontent.com/turms-im/assets/master/logo/pegion.svg" alt="Turms Documentation"><span class="site-name can-hide">Turms Documentation</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/turms-im/turms" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a class="external-link" href="https://github.com/turms-im/turms" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/docs/README.md" class="sidebar-item sidebar-heading" aria-label="介绍"><!--[--><!--]--> 介绍 <!--[--><!--]--></a><!----></li><li><a href="/docs/community/README.md" class="sidebar-item sidebar-heading" aria-label="社区常见问题"><!--[--><!--]--> 社区常见问题 <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">业务功能 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/docs/features/" class="sidebar-item" aria-label="业务功能介绍"><!--[--><!--]--> 业务功能介绍 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/simultaneous-login.html" class="sidebar-item" aria-label="多端登录"><!--[--><!--]--> 多端登录 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/user.html" class="sidebar-item" aria-label="用户相关功能"><!--[--><!--]--> 用户相关功能 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/group.html" class="sidebar-item" aria-label="群组相关功能"><!--[--><!--]--> 群组相关功能 <!--[--><!--]--></a><!----></li><li><a href="/docs/features/message.html" class="sidebar-item" aria-label="消息相关功能"><!--[--><!--]--> 消息相关功能 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">服务端指南 <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item">部署 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/getting-started.html" class="sidebar-item" aria-label="搭建与启动"><!--[--><!--]--> 搭建与启动 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/distribution.html" class="sidebar-item" aria-label="发布"><!--[--><!--]--> 发布 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/config.html" class="sidebar-item" aria-label="配置参数"><!--[--><!--]--> 配置参数 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">设计 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/architecture.html" class="sidebar-item" aria-label="架构设计"><!--[--><!--]--> 架构设计 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/schema.html" class="sidebar-item" aria-label="集合结构设计"><!--[--><!--]--> 集合结构设计 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/status-aware.html" class="sidebar-item" aria-label="状态感知"><!--[--><!--]--> 状态感知 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item">开发 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/redevelopment.html" class="sidebar-item" aria-label="关于二次开发"><!--[--><!--]--> 关于二次开发 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/rules.html" class="sidebar-item" aria-label="开发基本规约"><!--[--><!--]--> 开发基本规约 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/plugin.html" class="sidebar-item" aria-label="自定义插件"><!--[--><!--]--> 自定义插件 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/code.html" class="sidebar-item" aria-label="源码"><!--[--><!--]--> 源码 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/testing.html" class="sidebar-item" aria-label="测试"><!--[--><!--]--> 测试 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item active">主要模块 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/cluster.html" class="sidebar-item" aria-label="集群的设计与实现"><!--[--><!--]--> 集群的设计与实现 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/system-resource-management.html" class="sidebar-item" aria-label="系统资源管理"><!--[--><!--]--> 系统资源管理 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/observability.html" class="sidebar-item" aria-label="可观测性体系"><!--[--><!--]--> 可观测性体系 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/security.html" class="sidebar-item" aria-label="安全"><!--[--><!--]--> 安全 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/for-developers/storage.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="存储服务"><!--[--><!--]--> 存储服务 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/docs/for-developers/storage.html#插件接口与配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="插件接口与配置"><!--[--><!--]--> 插件接口与配置 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/docs/for-developers/storage.html#接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="接口"><!--[--><!--]--> 接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/docs/for-developers/storage.html#通用配置" class="router-link-active router-link-exact-active sidebar-item" aria-label="通用配置"><!--[--><!--]--> 通用配置 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/docs/for-developers/storage.html#官方插件实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="官方插件实现"><!--[--><!--]--> 官方插件实现 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/docs/for-developers/storage.html#turms-plugin-minio" class="router-link-active router-link-exact-active sidebar-item" aria-label="turms-plugin-minio"><!--[--><!--]--> turms-plugin-minio <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/docs/for-developers/anti-spam.html" class="sidebar-item" aria-label="敏感词过滤"><!--[--><!--]--> 敏感词过滤 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/data-analytics.html" class="sidebar-item" aria-label="数据分析"><!--[--><!--]--> 数据分析 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">客户端指南 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/client-quick-start.html" class="sidebar-item" aria-label="Quick Start"><!--[--><!--]--> Quick Start <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-requirements.html" class="sidebar-item" aria-label="版本要求"><!--[--><!--]--> 版本要求 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-api.html" class="sidebar-item" aria-label="接口"><!--[--><!--]--> 接口 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-session.html" class="sidebar-item" aria-label="会话的生命周期"><!--[--><!--]--> 会话的生命周期 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-metrics.html" class="sidebar-item" aria-label="度量数据"><!--[--><!--]--> 度量数据 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-identity-access-management.html" class="sidebar-item" aria-label="身份与访问管理"><!--[--><!--]--> 身份与访问管理 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-server-protocol.html" class="sidebar-item" aria-label="与服务端通信时使用的数据格式"><!--[--><!--]--> 与服务端通信时使用的数据格式 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/client-turms-client-js.html" class="sidebar-item" aria-label="turms-client-js共享上下文"><!--[--><!--]--> turms-client-js共享上下文 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/docs/for-developers/turms-admin.html" class="sidebar-item sidebar-heading" aria-label="turms-admin"><!--[--><!--]--> turms-admin <!--[--><!--]--></a><!----></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">手册 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/docs/for-developers/admin-api.html" class="sidebar-item" aria-label="管理员API接口"><!--[--><!--]--> 管理员API接口 <!--[--><!--]--></a><!----></li><li><a href="/docs/for-developers/status-code.html" class="sidebar-item" aria-label="状态码"><!--[--><!--]--> 状态码 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="存储服务" tabindex="-1"><a class="header-anchor" href="#存储服务" aria-hidden="true">#</a> 存储服务</h1><p>Turms自身并不直接提供存储服务，而是在服务端侧开放了存储服务中常见的接口，以供开发者自行实现，而Turms客户端也提供了相对应的存储服务<code>turmsClient.storageService</code>的API，以供开发者自行调用。</p><p>注意：</p><ul><li>开发者完全可以不用Turms客户端与服务端提供的任何接口，而是自己实现一套应用客户端与您自己服务端的交互存储逻辑。Turms只是自己维护了一套常见存储服务的实现，这样大部分开发者就不用自己从零开发了。即便开发者不打算用Turms的存储实现，由于各存储服务实现都是大同小异的，开发者也可以参考Turms的存储实现流程来实现自己的存储逻辑，以节省自研的时间。</li><li>Turms客户端存储服务提供的功能是Turms服务端官方存储服务插件功能的超集，即：Turms客户端存储服务被设计成既可以与Turms服务端官方存储服务插件进行交互，也可以被拓展与其他第三方插件进行交互。</li></ul><h2 id="插件接口与配置" tabindex="-1"><a class="header-anchor" href="#插件接口与配置" aria-hidden="true">#</a> 插件接口与配置</h2><p>存储资源目前一共分为三个类型，分别是：<code>User Profile Picture</code>（用户资料图片）、<code>Group Profile Picture</code>（群组资料图片）与<code>Message Attachment</code>（消息附件）。而每个资源都有其对应的增（改）删查三个函数接口，以供开发者实现。</p><h3 id="接口" tabindex="-1"><a class="header-anchor" href="#接口" aria-hidden="true">#</a> 接口</h3><p>插件接口：<code>im.turms.service.infra.plugin.extension.StorageServiceProvider</code></p><p>接口函数介绍：</p><table><thead><tr><th>资源类型</th><th>函数名</th><th>预期作用</th><th>参数</th><th>返回值</th></tr></thead><tbody><tr><td>用户资料图片</td><td>deleteUserProfilePicture</td><td>删除用户资料图片</td><td><code>requesterId</code>请求发送者ID；<br><code>resourceKeyStr</code>表明资源的字符串ID。该值由客户端指定，无格式要求。在Turms客户端默认实现下，其值为空；<br><code>resourceKeyNum</code>表明资源的整型ID。该值由客户端指定，无格式要求。在Turms客户端默认实现下，其值为空。</td><td>空</td></tr><tr><td></td><td>queryUserProfilePictureUploadInfo</td><td>查询用户资料图片上传信息</td><td>同上</td><td>返回值格式为<code>Map&lt;String, String&gt;</code>，插件实现者可以自定义任意返回值</td></tr><tr><td></td><td>queryUserProfilePictureDownloadInfo</td><td>查询用户资料图片下载信息</td><td><code>requesterId</code>请求发送者ID；<br><code>resourceKeyStr</code>表明资源的字符串ID。该值由客户端指定，无格式要求。在Turms客户端默认实现下，其值为空；<br><code>resourceKeyNum</code>表明资源的整型ID。该值由客户端指定，无格式要求。在Turms客户端默认实现下，其值为客户端函数调用者提供的用户ID。</td><td>返回值格式为<code>Map&lt;String, String&gt;</code>，插件实现者可以自定义任意返回值</td></tr><tr><td>群组资料图片</td><td>deleteGroupProfilePicture</td><td>删除群组资料图片</td><td><code>requesterId</code>请求发送者ID；<br><code>resourceKeyStr</code>表明资源的字符串ID。该值由客户端指定，无格式要求。在Turms客户端默认实现下，其值为空；<br><code>resourceKeyNum</code>表明资源的整型ID。该值由客户端指定，无格式要求。在Turms客户端默认实现下，其值为客户端函数调用者提供的群组ID。</td><td>空</td></tr><tr><td></td><td>queryGroupProfilePictureUploadInfo</td><td>查询群组资料图片上传信息</td><td>同上</td><td>返回值格式为<code>Map&lt;String, String&gt;</code>，插件实现者可以自定义任意返回值</td></tr><tr><td></td><td>queryGroupProfilePictureDownloadInfo</td><td>查询群组资料图片下载信息</td><td>同上</td><td>返回值格式为<code>Map&lt;String, String&gt;</code>，插件实现者可以自定义任意返回值</td></tr><tr><td>消息附件</td><td>deleteMessageAttachment</td><td>删除消息附件</td><td><code>requesterId</code>请求发送者ID；<br><code>resourceKeyStr</code>表明资源的字符串ID。该值由客户端指定，无格式要求。在Turms客户端默认实现下，其值为客户端函数调用者提供的消息附件名；<br><code>resourceKeyNum</code>表明资源的整型ID。该值由客户端指定，无格式要求。在Turms客户端默认实现下，其值为客户端函数调用者提供的消息ID。</td><td>空</td></tr><tr><td></td><td>queryMessageAttachmentUploadInfo</td><td>查询消息附件上传信息</td><td>同上</td><td>返回值格式为<code>Map&lt;String, String&gt;</code>，插件实现者可以自定义任意返回值</td></tr><tr><td></td><td>queryMessageAttachmentDownloadInfo</td><td>查询消息附件下载信息</td><td>同上</td><td>返回值格式为<code>Map&lt;String, String&gt;</code>，插件实现者可以自定义任意返回值</td></tr></tbody></table><h3 id="通用配置" tabindex="-1"><a class="header-anchor" href="#通用配置" aria-hidden="true">#</a> 通用配置</h3><table><thead><tr><th>配置项</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>turms.service.storage.user-profile-picture.expire-after-days</td><td>0</td><td>自创建时间开始，资源的有效时长（天）。0值代表不会过期</td></tr><tr><td>turms.service.storage.user-profile-picture.allowed-referrers</td><td>空</td><td>只允许指定的Referrers访问资源</td></tr><tr><td>turms.service.storage.user-profile-picture.allowed-content-type</td><td><code>*/*</code></td><td>允许上传的资源<code>Content-Type</code>。<code>*/*</code>值代表无限制</td></tr><tr><td>turms.service.storage.user-profile-picture.min-size-bytes</td><td>0</td><td>允许上传的资源最小值。0值代表无限制</td></tr><tr><td>turms.service.storage.user-profile-picture.max-size-bytes</td><td>1MB</td><td>允许上传的资源最大值。0值代表无限制</td></tr><tr><td>turms.service.storage.user-profile-picture.download-url-expire-after-seconds</td><td>300</td><td>资源下载URL的有效时长（秒）</td></tr><tr><td>turms.service.storage.user-profile-picture.upload-url-expire-after-seconds</td><td>300</td><td>资源上传URL的有效时长（秒）</td></tr><tr><td>turms.service.storage.group-profile-picture....</td><td></td><td>同turms.service.storage.user-profile-picture</td></tr><tr><td>turms.service.storage.message-attachment....</td><td></td><td>同turms.service.storage.user-profile-picture</td></tr></tbody></table><h2 id="官方插件实现" tabindex="-1"><a class="header-anchor" href="#官方插件实现" aria-hidden="true">#</a> 官方插件实现</h2><h3 id="turms-plugin-minio" tabindex="-1"><a class="header-anchor" href="#turms-plugin-minio" aria-hidden="true">#</a> turms-plugin-minio</h3><h4 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h4><ul><li><a href="https://min.io/download" target="_blank" rel="noopener noreferrer">MinIO服务端的下载与安装<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://turms-im.github.io/docs/for-developers/plugin.html#%E6%8F%92%E4%BB%B6%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F" target="_blank" rel="noopener noreferrer">插件的加载方式<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>当插件在服务端<code>Start</code>之后，客户端即可调用<code>turmsClient.storageService</code>下对应的API，对存储资源进行增删改查操作。</p><p>注意：当调用<code>queryMessageAttachment</code>接口时，参数<code>fetchDownloadInfo</code>必须为<code>true</code>；当调用<code>queryMessageAttachmentDownloadInfo</code>接口时，参数<code>fetch</code>必须为<code>true</code>。</p><h4 id="配置" tabindex="-1"><a class="header-anchor" href="#配置" aria-hidden="true">#</a> 配置</h4><table><thead><tr><th>配置项</th><th>默认值</th><th>说明</th></tr></thead><tbody><tr><td>turms-plugin.minio.enabled</td><td>true</td><td>是否启动插件</td></tr><tr><td>turms-plugin.minio.endpoint</td><td>&quot;http://localhost:9000&quot;</td><td>MinIO服务端的地址</td></tr><tr><td>turms-plugin.minio.region</td><td>&quot;&quot;</td><td>MinIO服务端的区域</td></tr><tr><td>turms-plugin.minio.access-key</td><td>minioadmin</td><td>MinIO服务端的Access Key</td></tr><tr><td>turms-plugin.minio.secret-key</td><td>minioadmin</td><td>MinIO服务端的Secret Key</td></tr><tr><td>turms-plugin.minio.retry.enabled</td><td>true</td><td>初始化Buckets失败时，是否重试</td></tr><tr><td>turms-plugin.minio.retry.initial-interval-millis</td><td>30_000</td><td>初始化Buckets失败时，首次重试间隔</td></tr><tr><td>turms-plugin.minio.retry.interval-millis</td><td>30_000</td><td>初始化Buckets失败时，重试间隔</td></tr><tr><td>turms-plugin.minio.retry.max-attempts</td><td>3</td><td>初始化Buckets失败时，最多重试次数</td></tr><tr><td>turms-plugin.minio.resource-key.mac.enabled</td><td>false</td><td>是否对资源的Object Key进行MAC算法加密，以生成不规律的URL。<br>最终资源URL为：<code>&lt;bucket&gt;/&lt;base62(mac(object key))&gt;</code>。如<code>message-attachment/123456789</code> =&gt; <code>message-attachment/1aEllpuvXRV09grkIEtD4R</code><br>注意：如果开启MAC算法，则客户端在调用<code>queryXXXDownloadInfo</code>系列接口时，要将参数<code>fetch</code>设置为<code>true</code>；在调用<code>queryXXX</code>系列接口时，要将参数<code>fetchDownloadInfo</code>设置为<code>true</code></td></tr><tr><td>turms-plugin.minio.resource-key.mac.base64-key</td><td>&quot;AHR1cm1zLWltL3R1cm1zgA==&quot;</td><td>Base64编码的MAC算法密钥</td></tr><tr><td>turms-plugin.minio.resource-key.base62.enabled</td><td>false</td><td>是否对资源的Object Key进行Base62算法编码，以缩短Object Key的URL长度。<br>最终资源URL为：<code>&lt;bucket&gt;/&lt;base62(object key)&gt;</code>，或<code>&lt;bucket&gt;/&lt;base62(mac(object key))&gt;</code>。如<code>message-attachment/123456789</code> =&gt; <code>message-attachment/8M0kX</code>或<code>message-attachment/1aEllpuvXRV09grkIEtD4R</code><br>注意：1. 当<code>turms-plugin.minio.resource-key.mac.enabled</code>为<code>true</code>时，Base62算法会始终被应用。<br>2. 如果开启Base62算法，则客户端在调用<code>queryXXXDownloadInfo</code>系列接口时，要将参数<code>fetch</code>设置为<code>true</code>；在调用<code>queryXXX</code>系列接口时，要将参数<code>fetchDownloadInfo</code>设置为<code>true</code></td></tr><tr><td>turms-plugin.minio.resource-key.base62.charset</td><td>...</td><td>Base62算法的字符集</td></tr></tbody></table></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/turms-im/turms/edit/main/for-developers/storage.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/docs/for-developers/security.html" class="" aria-label="安全"><!--[--><!--]--> 安全 <!--[--><!--]--></a></span><span class="next"><a href="/docs/for-developers/anti-spam.html" class="" aria-label="敏感词过滤"><!--[--><!--]--> 敏感词过滤 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/docs/assets/app.8901c5ed.js" defer></script>
  </body>
</html>
