<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>搭建与启动 | Turms Documentation</title>
    <meta name="description" content="A VitePress site">
    <link rel="preload stylesheet" href="/docs/assets/style.cbe3a868.css" as="style">
    <script type="module" src="/docs/assets/app.68b164e3.js"></script>
    <link rel="preload" href="/docs/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
  <link rel="modulepreload" href="/docs/assets/chunks/framework.b6850781.js">
  <link rel="modulepreload" href="/docs/assets/chunks/theme.c876e8ff.js">
  <link rel="modulepreload" href="/docs/assets/chunks/mermaid.core.3e3eefb1.js">
  <link rel="modulepreload" href="/docs/assets/zh-CN_server_deployment_getting-started.md.bca91df8.lean.js">
  <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-b2cf3e0b><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8616af1></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8616af1> Skip to content </a><!--]--><!----><header class="VPNav" data-v-b2cf3e0b data-v-7e5bc4a5><div class="VPNavBar has-sidebar" data-v-7e5bc4a5 data-v-94c81dcc><div class="container" data-v-94c81dcc><div class="title" data-v-94c81dcc><div class="VPNavBarTitle has-sidebar" data-v-94c81dcc data-v-f4ef19a3><a class="title" href="/docs/zh-CN/" data-v-f4ef19a3><!--[--><!--]--><!--[--><img class="VPImage logo" src="https://raw.githubusercontent.com/turms-im/assets/master/logo/pegion.svg" alt data-v-6db2186b><!--]--><!--[-->Turms Documentation<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-94c81dcc><div class="curtain" data-v-94c81dcc></div><div class="content-body" data-v-94c81dcc><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-94c81dcc><!--[--><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><!----><div class="VPFlyout VPNavBarTranslations translations" data-v-94c81dcc data-v-74abcbb9 data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-764effdf><span class="text" data-v-764effdf><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="option-icon" data-v-764effdf><path d="M0 0h24v24H0z" fill="none"></path><path d=" M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z " class="css-c4d79v"></path></svg>  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-764effdf><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><!----><!--[--><!--[--><div class="items" data-v-74abcbb9><p class="title" data-v-74abcbb9>简体中文</p><!--[--><div class="VPMenuLink" data-v-74abcbb9 data-v-d2c93bab><a class="VPLink link" href="/docs/server/deployment/getting-started.html" data-v-d2c93bab data-v-8f4dc553><!--[-->English<!--]--><!----></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-94c81dcc data-v-f6a63727><label title="toggle dark mode" data-v-f6a63727 data-v-a9c8afb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a9c8afb8 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a9c8afb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a9c8afb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-94c81dcc data-v-0394ad82 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/turms-im/turms" aria-label="github" target="_blank" rel="noopener" data-v-f6988cfb data-v-c530cc0a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-94c81dcc data-v-40855f84 data-v-764effdf><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-764effdf><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-764effdf><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-764effdf><div class="VPMenu" data-v-764effdf data-v-e7ea1737><!----><!--[--><!--[--><div class="group translations" data-v-40855f84><p class="trans-title" data-v-40855f84>简体中文</p><!--[--><div class="VPMenuLink" data-v-40855f84 data-v-d2c93bab><a class="VPLink link" href="/docs/server/deployment/getting-started.html" data-v-d2c93bab data-v-8f4dc553><!--[-->English<!--]--><!----></a></div><!--]--></div><div class="group" data-v-40855f84><div class="item appearance" data-v-40855f84><p class="label" data-v-40855f84>Appearance</p><div class="appearance-action" data-v-40855f84><label title="toggle dark mode" data-v-40855f84 data-v-a9c8afb8><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-checked="false" data-v-a9c8afb8 data-v-f3c41672><span class="check" data-v-f3c41672><span class="icon" data-v-f3c41672><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-a9c8afb8><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-a9c8afb8><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></label></div></div></div><div class="group" data-v-40855f84><div class="item social-links" data-v-40855f84><div class="VPSocialLinks social-links-list" data-v-40855f84 data-v-f6988cfb><!--[--><a class="VPSocialLink" href="https://github.com/turms-im/turms" aria-label="github" target="_blank" rel="noopener" data-v-f6988cfb data-v-c530cc0a><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-94c81dcc data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav" data-v-b2cf3e0b data-v-f5a2ca58><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-f5a2ca58><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-f5a2ca58><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-f5a2ca58>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-f5a2ca58 data-v-079b16a8><button data-v-079b16a8>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-b2cf3e0b data-v-af16598e><div class="curtain" data-v-af16598e></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-af16598e><span class="visually-hidden" id="sidebar-aria-label" data-v-af16598e> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-af16598e><section class="VPSidebarItem level-0" data-v-af16598e data-v-c4656e6d><!----><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/index.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>介绍</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/community/index.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>社区常见问题</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible collapsed" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>业务功能</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/feature/index.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>业务功能介绍</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/feature/simultaneous-login.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>多端登录</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/feature/user.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>用户相关功能</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/feature/group.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>群组相关功能</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/feature/message.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>消息相关功能</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible collapsed" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>设计</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/design/architecture.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>架构设计</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/design/schema.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>集合结构设计</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/design/status-aware.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>状态感知</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible has-active" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>服务端指南</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><section class="VPSidebarItem level-1 has-active" data-v-c4656e6d data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h3 class="text" data-v-c4656e6d>部署</h3><!----></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-2 is-link is-active has-active" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/deployment/getting-started.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>搭建与启动</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/deployment/distribution.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>发布</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/deployment/config.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>配置参数</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-c4656e6d data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h3 class="text" data-v-c4656e6d>开发</h3><!----></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/development/redevelopment.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>关于二次开发</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/development/rules.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>基本开发规约</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/development/plugin.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>自定义插件</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/development/code.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>源码</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/development/testing.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>测试</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section><section class="VPSidebarItem level-1" data-v-c4656e6d data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h3 class="text" data-v-c4656e6d>主要模块</h3><!----></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/module/identity-access-management.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>身份与访问管理</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/module/cluster.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>集群的设计与实现</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/module/system-resource-management.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>系统资源管理</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/module/observability.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>可观测性体系</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/module/security.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>安全</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/module/xmpp.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>XMPP</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/module/storage.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>存储服务</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/module/chatbot.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>聊天机器人</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/module/anti-spam.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>敏感词过滤</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-2 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/server/module/data-analytics.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>数据分析</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible collapsed" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>客户端指南</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/client/quick-start.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>Quick Start</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/client/requirements.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>版本要求</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/client/api.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>接口</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/client/session.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>会话的生命周期</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/client/metrics.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>度量数据</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/client/communication-protocol.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>与服务端通信时使用的数据格式</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/client/turms-client-js.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>turms-client-js共享上下文</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0" data-v-af16598e data-v-c4656e6d><!----><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/turms-admin.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>turms-admin</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-af16598e><section class="VPSidebarItem level-0 collapsible collapsed" data-v-af16598e data-v-c4656e6d><div class="item" role="button" tabindex="0" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><h2 class="text" data-v-c4656e6d>手册</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-c4656e6d><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="caret-icon" data-v-c4656e6d><path d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z"></path></svg></div></div><div class="items" data-v-c4656e6d><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/reference/admin-api.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>管理员API接口</p><!--]--><!----></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c4656e6d data-v-c4656e6d><div class="item" data-v-c4656e6d><div class="indicator" data-v-c4656e6d></div><a class="VPLink link link" href="/docs/zh-CN/reference/status-code.html" data-v-c4656e6d data-v-8f4dc553><!--[--><p class="text" data-v-c4656e6d>状态码</p><!--]--><!----></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-b2cf3e0b data-v-a494bd1d><div class="VPDoc has-sidebar has-aside" data-v-a494bd1d data-v-c4b0d3cf><!--[--><!--]--><div class="container" data-v-c4b0d3cf><div class="aside" data-v-c4b0d3cf><div class="aside-curtain" data-v-c4b0d3cf></div><div class="aside-container" data-v-c4b0d3cf><div class="aside-content" data-v-c4b0d3cf><div class="VPDocAside" data-v-c4b0d3cf data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-3f215769 data-v-ff0f39c8><div class="content" data-v-ff0f39c8><div class="outline-marker" data-v-ff0f39c8></div><div class="outline-title" data-v-ff0f39c8>当前页</div><nav aria-labelledby="doc-outline-aria-label" data-v-ff0f39c8><span class="visually-hidden" id="doc-outline-aria-label" data-v-ff0f39c8> Table of Contents for current page </span><ul class="root" data-v-ff0f39c8 data-v-8f12e865><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-c4b0d3cf><div class="content-container" data-v-c4b0d3cf><!--[--><!--]--><!----><main class="main" data-v-c4b0d3cf><div style="position:relative;" class="vp-doc _docs_zh-CN_server_deployment_getting-started" data-v-c4b0d3cf><div><h1 id="搭建与启动" tabindex="-1">搭建与启动 <a class="header-anchor" href="#搭建与启动" aria-label="Permalink to &quot;搭建与启动&quot;">​</a></h1><h2 id="自动搭建与启动" tabindex="-1">自动搭建与启动 <a class="header-anchor" href="#自动搭建与启动" aria-label="Permalink to &quot;自动搭建与启动&quot;">​</a></h2><h3 id="单机环境" tabindex="-1">单机环境 <a class="header-anchor" href="#单机环境" aria-label="Permalink to &quot;单机环境&quot;">​</a></h3><p>适用场景：搭建流程方便快捷，但无法满足容灾、弹性扩展、零宕机升级与负载均衡等需求，主要用于搭建Demo用于展示，与服务对SLA无要求的用户。</p><h4 id="基于docker-compose" tabindex="-1">基于Docker Compose <a class="header-anchor" href="#基于docker-compose" aria-label="Permalink to &quot;基于Docker Compose&quot;">​</a></h4><p>通过以下命令，可以全自动地搭建一套完整的Turms最小集群（包含turms-gateway、turms-service与turms-admin）及其依赖服务端（MongoDB分片集群与Redis）</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--depth</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/turms-im/turms.git</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">turms</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">grafana/loki-docker-driver:latest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--alias</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">loki</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--grant-all-permissions</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Or &quot;ENV=dev,demo docker compose -f docker-compose.standalone.yml --profile monitoring up --force-recreate -d&quot; to run with sidecar services in dev profile</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-compose.standalone.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--force-recreate</span></span></code></pre></div><p>等集群完成搭建后，可以通过<a href="http://localhost:6510" target="_blank" rel="noreferrer">http://localhost:6510</a>访问turms-admin后台管理系统，并输入账号密码（默认均为<code>turms</code>）。如果登录成功，则说明Turms集群搭建成功。</p><p>注意：AWS提供了高性价比的<code>t4g</code>系列EC2实例，但由于t4g系列实例使用了ARM处理器，因此很多应用都无法运行在该类EC2实例上，如<code>bitnami</code>所提供的镜像就均无法运行在该类实例上。<s>如果您想要在ARM处理器上运行<code>docker-compose.standalone.yml</code>，您需要先执行下方指令，在本地编译并安装Loki插件，然后才能运行<code>docker-compose.standalone.yml</code></s> 由于<code>Loki</code>自身有个Critical级别的Bug（<a href="https://github.com/grafana/loki/issues/2361%EF%BC%89%EF%BC%8C%E5%8D%B3%E5%BD%93%E6%97%A5%E5%BF%97%E6%97%A0%E6%B3%95%E9%80%81%E8%BE%BELoki%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%97%B6%EF%BC%8C%E7%9B%B4%E6%8E%A5Freeze%E6%88%91%E4%BB%AC%E7%9A%84%E6%9C%8D%E5%8A%A1%EF%BC%8C%E5%9B%A0%E6%AD%A4%E6%88%91%E4%BB%AC%E6%9A%82%E6%97%B6%E7%A7%BB%E9%99%A4%E4%BA%86Loki%E6%9C%8D%E5%8A%A1%EF%BC%8C%E6%82%A8%E7%9B%AE%E5%89%8D%E4%B8%8D%E9%9C%80%E8%A6%81%E6%89%A7%E8%A1%8C%E4%B8%8B%E8%BF%B0%E5%91%BD%E4%BB%A4%EF%BC%8C%E4%B9%9F%E5%8F%AF%E7%9B%B4%E6%8E%A5%E8%BF%90%E8%A1%8C%60docker-compose.standalone.yml%60%EF%BC%9A" target="_blank" rel="noreferrer">https://github.com/grafana/loki/issues/2361），即当日志无法送达Loki服务端时，直接Freeze我们的服务，因此我们暂时移除了Loki服务，您目前不需要执行下述命令，也可直接运行`docker-compose.standalone.yml`：</a></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># Install Go</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">add-apt-repository</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ppa:longsleep/golang-backports</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">update</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apt</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">golang-go</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Install Loki</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">grafana/loki-docker-driver:latest</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--alias</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">loki</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--grant-all-permissions</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Build and Enable Loki</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/grafana/loki.git</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">loki</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">checkout</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tags/v2.4.1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-b</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">setup</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">GOOS=linux</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">GOARCH=arm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">GOARM=</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">go</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">./clients/cmd/docker-driver</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Replace &quot;&lt;ALPHA_NUMERIC_FOLDER&gt;&quot; with the real path on your machine</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mv</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-driver</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/var/lib/docker/plugins/</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">ALPHA_NUMERIC_FOLDE</span><span style="color:#A6ACCD;">R</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">/rootfs/bin</span></span>
<span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">enable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">loki</span></span></code></pre></div><p>补充：</p><ul><li>配合<code>--profile monitoring</code>（<code>docker compose -f docker-compose.standalone.yml --profile monitoring up --force-recreate</code>），还可以额外自动搭建Prometheus与Grafana服务端。</li><li>Turms服务端默认使用生产环境配置，不会向控制台打印日志，只会打印日志文件，因此您通过<code>docker logs &lt;TURMS_CONTAINER_ID&gt;</code>是无法查看到Turms服务端的运行日志的。为了方便排查问题，您可以在本地开发测试时，把环境变量设置为<code>ENV=dev</code>，然后再次启动<code>docker-compose.standalone.yml</code>。在dev环境下，Turms会向控制台打印日志，并自动生成测试用的Fake数据，与模拟真实客户端TCP连接与请求</li><li>如果您通过上述指令，无法启动<code>docker-compose.standalone.yml</code>。则确保服务器的<code>Docker</code>版本为<code>20.x.x</code>与<code>Docker Compose</code>插件版本为<code>2.x.x</code>，</li><li>Turms的Playground环境与网站每次都是通过<code>ENV=dev,demo docker compose -f docker-compose.standalone.yml --profile monitoring up --force-recreate -d</code>这一条命令自动搭建的</li></ul><h4 id="基于terraform与docker-compose" tabindex="-1">基于Terraform与Docker Compose <a class="header-anchor" href="#基于terraform与docker-compose" aria-label="Permalink to &quot;基于Terraform与Docker Compose&quot;">​</a></h4><p>（由于Turms目前并没有提供封装好的镜像，因此仍需要使用Docker Compose进行环境搭建）</p><p>该方案是在上述Docker Compose方案的基础上，引入了Turms自定义的Terraform模块，以帮助用户自动开通并配置VPC、交换机、安全组与单机ECS抢占式实例。在这台ECS上，Terraform会通过user-data系统初始化脚本，来安装Docker、Docker Compose与Turms等服务，并最终启动Turms单机集群。</p><p>具体操作命令如下：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--depth</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/turms-im/turms.git</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">turms/terraform/alicloud/playground</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> ALICLOUD_ACCESS_KEY</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#C3E88D;">your_access_ke</span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> ALICLOUD_SECRET_KEY</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#C3E88D;">your_secret_ke</span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">terraform</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">init</span></span>
<span class="line"><span style="color:#FFCB6B;">terraform</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apply</span></span></code></pre></div><p>在<code>terraform apply</code>命令执行完毕后，等待约3~15分钟（阿里云ECS拉取ghcr镜像很慢），然后再访问<code>http://公网IP:6510</code>（公网IP可以通过查看控制台输出的<code>public_ip</code>或查看云服务的ECS控制台获得），如果可以成功访问turms-admin后台管理系统，则表明搭建成功。</p><p>注意：该方案需要购买与使用云服务，而其开销取决于ECS的运行时长。默认配置下，约一小时0.1元（抢占实例的价格随时有可能波动，因此具体价格请查阅云服务的价目表）</p><h3 id="基于云服务的集群环境" tabindex="-1">基于云服务的集群环境 <a class="header-anchor" href="#基于云服务的集群环境" aria-label="Permalink to &quot;基于云服务的集群环境&quot;">​</a></h3><p>适用场景：有容灾、弹性扩展、跨地域部署与负载均衡等需求。该方案提供的各种能力直接与搭建成本挂钩，因此您通常需要修改默认提供的Terraform module配置，以保证配置既能满足您的需求，同时搭建与运维成本最低。</p><p>具体操作命令如下：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--depth</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/turms-im/turms.git</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">turms/terraform/alicloud/cluster</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> ALICLOUD_ACCESS_KEY</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#C3E88D;">your_access_ke</span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#C792EA;">export</span><span style="color:#A6ACCD;"> ALICLOUD_SECRET_KEY</span><span style="color:#89DDFF;">=&lt;</span><span style="color:#C3E88D;">your_secret_ke</span><span style="color:#A6ACCD;">y</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">terraform</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">init</span></span>
<span class="line"><span style="color:#FFCB6B;">terraform</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">apply</span></span></code></pre></div><p>该Terraform模块会进行按照互联网应用的常规同城容灾级的部署方案，进行云服务的部署。具体而言包括：</p><ol><li>在一个地域内搭建一个<code>VPC</code>，该VPC下开通2台<code>交换机</code>，代表两个<code>可用区</code></li><li>在上述两个可用区内默认部署一套<code>MongoDB分片集群服务</code>，实现同城容灾</li><li>在一个可用区内默认部署一套<code>Redis服务</code></li><li>为接收发送给Turms ECS的外网流量，开通<code>SLB服务</code></li><li>为实现Turms ECS的外网访问，开通<code>NAT服务</code></li><li>为turms-gateway、turms-service与turms-admin服务端分别搭建各自的<code>安全组</code></li><li>为turms-gateway服务端，开通无公网带宽的<code>ECS实例</code>（默认数量为1）。通过user-data实现turms-gateway服务初始化与执行，并与上述SLB、NAT、安全组、MongoDB、Redis服务绑定</li><li>为turms-service服务端，开通无公网带宽的<code>ECS实例</code>（默认数量为1）。通过user-data实现turms-service服务初始化与执行，并与上述SLB、NAT、安全组、MongoDB、Redis服务绑定</li><li>为turms-admin服务端，开通无公网带宽的<code>ECS实例</code>（默认数量为1）。通过user-data实现turms-admin服务初始化与执行，并与上述安全组服务绑定</li></ol><p>自此整套Turms基础集群搭建完成（未来还会提供诸如日志分析服务等）。若希望了解更多实现细节，请查阅<code>turms/terraform/alicloud/cluster</code>目录下的具体Terraform模块配置</p><h2 id="手动搭建与启动" tabindex="-1">手动搭建与启动 <a class="header-anchor" href="#手动搭建与启动" aria-label="Permalink to &quot;手动搭建与启动&quot;">​</a></h2><p>适用场景：通用，无特别限制场景。但一般只适用于小规模手动部署。</p><p>若您网络畅通，第一次完成以下全部操作大概需要花费10~30分钟。当您熟练之后，可在1~3分钟完成一整套集群的部署工作。</p><ol><li><p>MongoDB集群搭建（用于业务数据存储、服务发现、配置管理）</p><ul><li><p>下载并安装<a href="https://www.mongodb.com/download-center/community" target="_blank" rel="noreferrer">MongoDB</a>（因为Turms服务端需要使用支持分布式事务的分片集群，所以要求MongoDB的最低版本为4.2。推荐用户使用最新稳定版）。以RHEL/CentOS为例（具体可参考：<a href="https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat%EF%BC%89%EF%BC%9A" target="_blank" rel="noreferrer">https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat）：</a></p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">cat</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;&lt;EOF</span><span style="color:#C3E88D;"> &gt; /etc/yum.repos.d/mongodb-org-6.0.repo</span></span>
<span class="line"><span style="color:#C3E88D;">[mongodb-org-6.0]</span></span>
<span class="line"><span style="color:#C3E88D;">name=MongoDB Repository</span></span>
<span class="line"><span style="color:#C3E88D;">baseurl=https://repo.mongodb.org/yum/redhat/</span><span style="color:#A6ACCD;">$releasever</span><span style="color:#C3E88D;">/mongodb-org/6.0/x86_64/</span></span>
<span class="line"><span style="color:#C3E88D;">gpgcheck=1</span></span>
<span class="line"><span style="color:#C3E88D;">enabled=1</span></span>
<span class="line"><span style="color:#C3E88D;">gpgkey=https://www.mongodb.org/static/pgp/server-6.0.asc</span></span>
<span class="line"><span style="color:#89DDFF;">EOF</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mongodb-org</span></span></code></pre></div></li><li><p>搭建MongoDB服务端分片集群。以基于工具<a href="https://github.com/rueckstiess/mtools" target="_blank" rel="noreferrer">mtools/mlaunch</a>搭建为例：</p><p>（关于mlaunch提供的更多指令，读者可查阅：<a href="https://rueckstiess.github.io/mtools/mlaunch" target="_blank" rel="noreferrer">mlaunch文档</a>)</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pip3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mtools[mlaunch]</span></span>
<span class="line"><span style="color:#FFCB6B;">mlaunch</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">init</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--replicaset</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--sharded</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--nodes</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--config</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--hostname</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">localhost</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--port</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">27017</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--mongos</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span></code></pre></div><p>注意：</p><ul><li>如果在Windows环境执行<code>pip3 install mtools[mlaunch]</code>命令时，遇到类似<code>error: Microsoft Visual C++ 14.0 or greater is required. Get it with &quot;Microsoft C++ Build Tools&quot;</code>的错误，则您需要先在<a href="https://visualstudio.microsoft.com/downloads%E9%A1%B5%E9%9D%A2%E4%B8%8B%EF%BC%8C%E4%B8%8B%E8%BD%BD%60Visual" target="_blank" rel="noreferrer">https://visualstudio.microsoft.com/downloads页面下，下载`Visual</a> Studio Installer<code>，并通过它安装</code>MSVC build tools<code>，然后再执行</code>pip3 install mtools[mlaunch]`指令。</li><li>请确保MongoDB服务端运行正常，否则Turms服务端在启动时会抛出<code>MongoSocketOpenException</code>异常。</li></ul></li></ul></li><li><p>下载、安装并启动Redis服务端（用于实现用户状态管理以及“附近的用户”）。以RHEL/CentOS为例：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">epel-release</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">update</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">enable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redis</span></span></code></pre></div><p>对于Windows平台，可在 <a href="https://github.com/tporadowski/redis/releases" target="_blank" rel="noreferrer">tporadowski/redis</a> 下载Windows版本供本地开发测试用。</p></li><li><p>Turms集群搭建</p><p>方案一：拉取Turms服务端Docker镜像，并运行：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># Pull and run images</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6510</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">6510</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ghcr.io/turms-im/turms-admin</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">7510</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">7510</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">8510</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">8510</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ghcr.io/turms-im/turms-service</span></span>
<span class="line"><span style="color:#FFCB6B;">docker</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">run</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--ulimit</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nofile=</span><span style="color:#F78C6C;">102400</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">102400</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">7510</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">7510</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">9510</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">9510</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10510</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">10510</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">11510</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">11510</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">12510</span><span style="color:#C3E88D;">:</span><span style="color:#F78C6C;">12510</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ghcr.io/turms-im/turms-gateway</span></span></code></pre></div><p>另外，您可以通过volume挂载的方式来使用自定义的<code>application.yaml</code>与<code>jvm.options</code>。如配置<code>-v /your-custom-config-dir:/opt/turms/turms/config</code>。</p><p>方案二：<s>下载并解压<a href="https://github.com/turms-im/turms/releases" target="_blank" rel="noreferrer">Turms服务端</a>压缩包</s>（由于v.0.10.0尚未发布在release页面中，因此该方案暂不可用），根据下述步骤运行：</p><ul><li><p>（如果您将MongoDB与Redis都安装默认配置安装在本地，可跳过此步骤）根据您的需求配置config/jvm.options、config/application.yaml（您可以在此处配置Turms自定义的配置参数，并且您也可以在此处配置多个MongoDB或mongos的服务端地址。具体可参考：<a href="https://docs.mongodb.com/manual/reference/connection-string%EF%BC%89%E3%80%82" target="_blank" rel="noreferrer">https://docs.mongodb.com/manual/reference/connection-string）。</a></p></li><li><p>（推荐使用Ansible）在所有需要运行Turms服务端的系统上，运行bin/turms脚本（默认以Thin包形式执行，若需以Fat包形式执行，请在执行脚本时加上<code>-f</code>参数，如：<code>sh run.sh -f</code>。之后再运行turms-gateway服务端。turms-gateway与turms-service服务端会通过MongoDB（作为服务注册中心）来自动寻找其他服务端节点，由此Turms集群开始运作。</p></li></ul><p>方案三：克隆Turms仓库源码，直接通过IDE运行turms-gateway与turms-service服务端。（参考命令：<code>git clone --depth 1 https://github.com/turms-im/turms.git</code>）</p></li></ol><p><strong>提醒</strong></p><ul><li>turms-service服务端在启动时，会自动检测数据库中是否已存在一个角色为<code>ROOT</code>，且账号为<code>turms</code>的超级管理员账号。如果不存在，则turms-service服务端会自动创建一个角色为<code>ROOT</code>、名称为<code>turms</code>与密码为<code>turms.security.password.initial-root-password</code>（默认为：<code>turms</code>）的管理员账号。在生产环境中，请务必记得要修改默认密码。</li><li>上述操作主要用于您初次体验Turms集群使用，若您需将Turms部署在生产环境当中，请务必查阅Wiki手册，了解各种配置参数的意义，以最小的资源消耗，来定制属于您自己的业务需求与业务组合。</li></ul><h2 id="turms服务端启动与关闭的大致流程" tabindex="-1">Turms服务端启动与关闭的大致流程 <a class="header-anchor" href="#turms服务端启动与关闭的大致流程" aria-label="Permalink to &quot;Turms服务端启动与关闭的大致流程&quot;">​</a></h2><h3 id="启动流程" tabindex="-1">启动流程 <a class="header-anchor" href="#启动流程" aria-label="Permalink to &quot;启动流程&quot;">​</a></h3><ol><li>连接并校验mongos与Redis服务端。</li><li>检测MongoDB是否已建表，如果已经建好表了，则跳过这步。如果没有就进行：建表、添加索引、添加分片键、添加Zones用于冷热数据分离存储。如果开启了MongoDB的Fake数据，则turms-service会自动向MongoDB生成Fake数据，用于开发测试。</li><li>对于turms-service服务端，它会检测MongoDB中是否已存在一个角色为<code>ROOT</code>，且账号为<code>turms</code>的超级管理员账号。如果不存在，则会向MongoDB创建一个角色为<code>ROOT</code>、名称为<code>turms</code>与密码为<code>turms.security.password.initial-root-password</code>（默认为：<code>turms</code>）的管理员账号。</li><li>注册本地Node节点到服务注册中心，如果注册成功，则拉取并应用集群全局配置，并搭建RPC服务端，用于接收RPC客户端连接。如果失败，则抛异常并退出进程。</li><li>开启Admin HTTP服务端，用于接收管理员API请求。另外，对于turms-gateway，还要开启网关服务端（如TCP/WebSocket），用于接收客户端连接与请求。</li><li>对于turms-gateway，如果开启了Fake客户端，则生成真实的客户端连接并随机发送真实客户端请求（请求类型随机、请求参数随机），用于开发测试。</li></ol><p>至此，服务端启动完毕。</p><h3 id="关闭流程" tabindex="-1">关闭流程 <a class="header-anchor" href="#关闭流程" aria-label="Permalink to &quot;关闭流程&quot;">​</a></h3><p>（对于turms-gateway）</p><ol><li>拒绝新客户端网络连接与客户端请求。</li><li>关闭Fake客户端，关闭已建立的客户端会话连接。</li><li>关闭对接TCP/UDP/WebSocket客户端连接的服务端，与HTTP管理员API服务端。</li></ol><p>（对于turms-gateway与turms-service） 4. 关闭黑名单同步机制。 5. 关闭集群服务（如RPC节点间的连接、服务注册与发现服务）。 6. 关闭插件机制。 7. 发送完Redis/MongoDB客户端请求后，关闭Turms服务端连接到Redis和MongoDB的网络连接。 8. 打印完日志，关闭日志服务。</p><p>至此，服务端关闭完成。</p></div></div></main><footer class="VPDocFooter" data-v-c4b0d3cf data-v-face870a><!--[--><!--]--><!----><div class="prev-next" data-v-face870a><div class="pager" data-v-face870a><a class="pager-link prev" href="/docs/zh-CN/design/status-aware.html" data-v-face870a><span class="desc" data-v-face870a>上一页</span><span class="title" data-v-face870a>状态感知</span></a></div><div class="has-prev pager" data-v-face870a><a class="pager-link next" href="/docs/zh-CN/server/deployment/distribution.html" data-v-face870a><span class="desc" data-v-face870a>下一页</span><span class="title" data-v-face870a>发布</span></a></div></div></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"feature_simultaneous-login.md\":\"b27be3af\",\"server_module_data-analytics.md\":\"9637df23\",\"server_module_identity-access-management.md\":\"aeb89734\",\"client_api.md\":\"32fbcee6\",\"zh-cn_server_module_xmpp.md\":\"bbdea2f0\",\"turms-admin.md\":\"95365cef\",\"zh-cn_client_api.md\":\"8be40789\",\"zh-cn_client_communication-protocol.md\":\"8da0b50e\",\"zh-cn_client_quick-start.md\":\"e8d5cf88\",\"zh-cn_client_requirements.md\":\"326d8549\",\"zh-cn_client_session.md\":\"cc2f9526\",\"zh-cn_community_index.md\":\"5331cb03\",\"zh-cn_design_architecture.md\":\"7c93c5fa\",\"zh-cn_design_status-aware.md\":\"02e982b6\",\"zh-cn_feature_group.md\":\"9680e961\",\"zh-cn_feature_index.md\":\"0c97076a\",\"zh-cn_feature_message.md\":\"8365d67b\",\"zh-cn_feature_simultaneous-login.md\":\"eec58c7f\",\"zh-cn_feature_user.md\":\"98693644\",\"zh-cn_index.md\":\"4068b513\",\"zh-cn_server_module_chatbot.md\":\"1518f83b\",\"zh-cn_server_module_data-analytics.md\":\"7a0c76a2\",\"zh-cn_server_module_identity-access-management.md\":\"60223284\",\"zh-cn_server_module_cluster.md\":\"d81b1787\",\"zh-cn_server_module_observability.md\":\"4df2365d\",\"zh-cn_server_module_security.md\":\"7151ce4c\",\"zh-cn_server_module_storage.md\":\"7381be67\",\"zh-cn_server_module_system-resource-management.md\":\"496ebe5e\",\"zh-cn_reference_admin-api.md\":\"651c7516\",\"zh-cn_server_deployment_config.md\":\"9af2edf5\",\"zh-cn_server_deployment_getting-started.md\":\"bca91df8\",\"zh-cn_server_deployment_distribution.md\":\"3d9010e0\",\"zh-cn_server_development_redevelopment.md\":\"b228c24a\",\"zh-cn_server_development_rules.md\":\"a8967b8f\",\"zh-cn_server_development_plugin.md\":\"303552d1\",\"zh-cn_server_module_anti-spam.md\":\"df44bbf2\",\"zh-cn_server_development_code.md\":\"bed825d4\",\"zh-cn_reference_status-code.md\":\"93beef6e\",\"reference_status-code.md\":\"c298a113\",\"server_deployment_config.md\":\"1c739bba\",\"server_deployment_distribution.md\":\"11acc723\",\"server_deployment_getting-started.md\":\"ea354766\",\"server_development_code.md\":\"07c8719f\",\"server_development_plugin.md\":\"7b8edd47\",\"server_development_redevelopment.md\":\"fd676d5a\",\"server_development_testing.md\":\"031eacf0\",\"server_module_anti-spam.md\":\"8a45ca95\",\"server_module_chatbot.md\":\"8949064c\",\"server_module_cluster.md\":\"268f78ff\",\"server_module_observability.md\":\"c4c9204e\",\"server_module_security.md\":\"d48a3174\",\"server_module_storage.md\":\"9f80c272\",\"server_module_system-resource-management.md\":\"0d87c49f\",\"server_module_xmpp.md\":\"b2b73117\",\"zh-cn_turms-admin.md\":\"1f9ebfcf\",\"client_requirements.md\":\"ac24b2fa\",\"zh-cn_design_schema.md\":\"f9704095\",\"community_index.md\":\"ee52f5b0\",\"design_architecture.md\":\"dbc0e4cc\",\"design_schema.md\":\"efa03370\",\"design_status-aware.md\":\"27f62819\",\"feature_group.md\":\"2fe71513\",\"feature_index.md\":\"cfee6d12\",\"feature_message.md\":\"02efe372\",\"client_communication-protocol.md\":\"4e1981bd\",\"client_metrics.md\":\"1080928b\",\"client_quick-start.md\":\"bac4da35\",\"server_development_rules.md\":\"230f8b60\",\"zh-cn_server_development_testing.md\":\"fbb2dac5\",\"client_session.md\":\"6404c66b\",\"client_turms-client-js.md\":\"74a7635f\",\"zh-cn_client_metrics.md\":\"567914e8\",\"zh-cn_client_turms-client-js.md\":\"b3c45ee4\",\"feature_user.md\":\"b75bb87f\",\"index.md\":\"a3c63c9f\",\"reference_admin-api.md\":\"89675154\"}")
__VP_SITE_DATA__ = JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Turms Documentation\",\"description\":\"A VitePress site\",\"base\":\"/docs/\",\"head\":[],\"appearance\":true,\"themeConfig\":{\"logo\":\"https://raw.githubusercontent.com/turms-im/assets/master/logo/pegion.svg\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/turms-im/turms\"}],\"search\":{\"provider\":\"algolia\",\"options\":{\"appId\":\"WV3XO0QV2E\",\"apiKey\":\"f7a7c652875d1f2cc0f0ec52d8f8f660\",\"indexName\":\"turms-imio\",\"locales\":{\"zh-CN\":{\"placeholder\":\"搜索\",\"translations\":{\"button\":{\"buttonText\":\"搜索\",\"buttonAriaLabel\":\"搜索\"},\"modal\":{\"searchBox\":{\"resetButtonTitle\":\"重置查询\",\"resetButtonAriaLabel\":\"重置查询\",\"cancelButtonText\":\"取消\",\"cancelButtonAriaLabel\":\"取消\"},\"startScreen\":{\"recentSearchesTitle\":\"搜索历史\",\"noRecentSearchesText\":\"没有搜索历史\",\"saveRecentSearchButtonTitle\":\"保存至搜索历史\",\"removeRecentSearchButtonTitle\":\"从搜索历史中移除\",\"favoriteSearchesTitle\":\"收藏\",\"removeFavoriteSearchButtonTitle\":\"从收藏中移除\"},\"errorScreen\":{\"titleText\":\"无法获取搜索结果\",\"helpText\":\"请检查网络连接\"},\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\",\"closeText\":\"关闭\",\"searchByText\":\"搜索提供者\"},\"noResultsScreen\":{\"noResultsText\":\"没有找到相关结果\",\"suggestedQueryText\":\"您可能想搜索\",\"reportMissingResultsLinkText\":\"点击反馈\",\"reportMissingResultsText\":\"没有找到结果？请报告缺失\"}}}}}}}},\"locales\":{\"root\":{\"label\":\"English\",\"lang\":\"en\",\"themeConfig\":{\"sidebar\":[{\"text\":\"Introduction\",\"link\":\"/index.md\"},{\"text\":\"Community FAQ\",\"link\":\"/community/index.md\"},{\"text\":\"Business Features\",\"collapsed\":true,\"items\":[{\"text\":\"Business Features\",\"link\":\"/feature/index.md\"},{\"text\":\"Simultaneous Login\",\"link\":\"/feature/simultaneous-login.md\"},{\"text\":\"User-related Features\",\"link\":\"/feature/user.md\"},{\"text\":\"Group-related Features\",\"link\":\"/feature/group.md\"},{\"text\":\"Message-related Features\",\"link\":\"/feature/message.md\"}]},{\"text\":\"Design\",\"collapsed\":true,\"items\":[{\"text\":\"Architecture Design\",\"link\":\"/design/architecture.md\"},{\"text\":\"Collection Schema Design\",\"link\":\"/design/schema.md\"},{\"text\":\"Status Awareness\",\"link\":\"/design/status-aware.md\"}]},{\"text\":\"Server Guide\",\"collapsed\":true,\"items\":[{\"text\":\"Deployment\",\"items\":[{\"text\":\"Build and Start\",\"link\":\"/server/deployment/getting-started.md\"},{\"text\":\"Distribution\",\"link\":\"/server/deployment/distribution.md\"},{\"text\":\"Configuration\",\"link\":\"/server/deployment/config.md\"}]},{\"text\":\"Development\",\"items\":[{\"text\":\"About Secondary Development\",\"link\":\"/server/development/redevelopment.md\"},{\"text\":\"Basic Development Rules\",\"link\":\"/server/development/rules.md\"},{\"text\":\"Custom Plugins\",\"link\":\"/server/development/plugin.md\"},{\"text\":\"Source Code\",\"link\":\"/server/development/code.md\"},{\"text\":\"Testing\",\"link\":\"/server/development/testing.md\"}]},{\"text\":\"Main Modules\",\"items\":[{\"text\":\"Identity and Access Management\",\"link\":\"/server/module/identity-access-management.md\"},{\"text\":\"Cluster Design and Implementation\",\"link\":\"/server/module/cluster.md\"},{\"text\":\"System Resource Management\",\"link\":\"/server/module/system-resource-management.md\"},{\"text\":\"Observability\",\"link\":\"/server/module/observability.md\"},{\"text\":\"Security\",\"link\":\"/server/module/security.md\"},{\"text\":\"XMPP\",\"link\":\"/server/module/xmpp.md\"},{\"text\":\"Storage Service\",\"link\":\"/server/module/storage.md\"},{\"text\":\"Chatbot\",\"link\":\"/server/module/chatbot.md\"},{\"text\":\"Content Moderation\",\"link\":\"/server/module/anti-spam.md\"},{\"text\":\"Data Analysis\",\"link\":\"/server/module/data-analytics.md\"}]}]},{\"text\":\"Client Guide\",\"collapsed\":true,\"items\":[{\"text\":\"Quick Start\",\"link\":\"/client/quick-start.md\"},{\"text\":\"Version Requirements\",\"link\":\"/client/requirements.md\"},{\"text\":\"API\",\"link\":\"/client/api.md\"},{\"text\":\"Session Lifecycle\",\"link\":\"/client/session.md\"},{\"text\":\"Metrics\",\"link\":\"/client/metrics.md\"},{\"text\":\"Communication Protocol Used Between Client and Server\",\"link\":\"/client/communication-protocol.md\"},{\"text\":\"turms-client-js Shared Context\",\"link\":\"/client/turms-client-js.md\"}]},{\"text\":\"turms-admin\",\"link\":\"/turms-admin.md\"},{\"text\":\"Reference\",\"collapsed\":true,\"items\":[{\"text\":\"Admin API\",\"link\":\"/reference/admin-api.md\"},{\"text\":\"Status Code\",\"link\":\"/reference/status-code.md\"}]}]}},\"zh-CN\":{\"label\":\"简体中文\",\"lang\":\"zh-CN\",\"themeConfig\":{\"lastUpdatedText\":\"上次更新\",\"outline\":{\"label\":\"当前页\"},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"sidebar\":[{\"text\":\"介绍\",\"link\":\"/zh-CN/index.md\"},{\"text\":\"社区常见问题\",\"link\":\"/zh-CN/community/index.md\"},{\"text\":\"业务功能\",\"collapsed\":true,\"items\":[{\"text\":\"业务功能介绍\",\"link\":\"/zh-CN/feature/index.md\"},{\"text\":\"多端登录\",\"link\":\"/zh-CN/feature/simultaneous-login.md\"},{\"text\":\"用户相关功能\",\"link\":\"/zh-CN/feature/user.md\"},{\"text\":\"群组相关功能\",\"link\":\"/zh-CN/feature/group.md\"},{\"text\":\"消息相关功能\",\"link\":\"/zh-CN/feature/message.md\"}]},{\"text\":\"设计\",\"collapsed\":true,\"items\":[{\"text\":\"架构设计\",\"link\":\"/zh-CN/design/architecture.md\"},{\"text\":\"集合结构设计\",\"link\":\"/zh-CN/design/schema.md\"},{\"text\":\"状态感知\",\"link\":\"/zh-CN/design/status-aware.md\"}]},{\"text\":\"服务端指南\",\"collapsed\":true,\"items\":[{\"text\":\"部署\",\"items\":[{\"text\":\"搭建与启动\",\"link\":\"/zh-CN/server/deployment/getting-started.md\"},{\"text\":\"发布\",\"link\":\"/zh-CN/server/deployment/distribution.md\"},{\"text\":\"配置参数\",\"link\":\"/zh-CN/server/deployment/config.md\"}]},{\"text\":\"开发\",\"items\":[{\"text\":\"关于二次开发\",\"link\":\"/zh-CN/server/development/redevelopment.md\"},{\"text\":\"基本开发规约\",\"link\":\"/zh-CN/server/development/rules.md\"},{\"text\":\"自定义插件\",\"link\":\"/zh-CN/server/development/plugin.md\"},{\"text\":\"源码\",\"link\":\"/zh-CN/server/development/code.md\"},{\"text\":\"测试\",\"link\":\"/zh-CN/server/development/testing.md\"}]},{\"text\":\"主要模块\",\"items\":[{\"text\":\"身份与访问管理\",\"link\":\"/zh-CN/server/module/identity-access-management.md\"},{\"text\":\"集群的设计与实现\",\"link\":\"/zh-CN/server/module/cluster.md\"},{\"text\":\"系统资源管理\",\"link\":\"/zh-CN/server/module/system-resource-management.md\"},{\"text\":\"可观测性体系\",\"link\":\"/zh-CN/server/module/observability.md\"},{\"text\":\"安全\",\"link\":\"/zh-CN/server/module/security.md\"},{\"text\":\"XMPP\",\"link\":\"/zh-CN/server/module/xmpp.md\"},{\"text\":\"存储服务\",\"link\":\"/zh-CN/server/module/storage.md\"},{\"text\":\"聊天机器人\",\"link\":\"/zh-CN/server/module/chatbot.md\"},{\"text\":\"敏感词过滤\",\"link\":\"/zh-CN/server/module/anti-spam.md\"},{\"text\":\"数据分析\",\"link\":\"/zh-CN/server/module/data-analytics.md\"}]}]},{\"text\":\"客户端指南\",\"collapsed\":true,\"items\":[{\"text\":\"Quick Start\",\"link\":\"/zh-CN/client/quick-start.md\"},{\"text\":\"版本要求\",\"link\":\"/zh-CN/client/requirements.md\"},{\"text\":\"接口\",\"link\":\"/zh-CN/client/api.md\"},{\"text\":\"会话的生命周期\",\"link\":\"/zh-CN/client/session.md\"},{\"text\":\"度量数据\",\"link\":\"/zh-CN/client/metrics.md\"},{\"text\":\"与服务端通信时使用的数据格式\",\"link\":\"/zh-CN/client/communication-protocol.md\"},{\"text\":\"turms-client-js共享上下文\",\"link\":\"/zh-CN/client/turms-client-js.md\"}]},{\"text\":\"turms-admin\",\"link\":\"/zh-CN/turms-admin.md\"},{\"text\":\"手册\",\"collapsed\":true,\"items\":[{\"text\":\"管理员API接口\",\"link\":\"/zh-CN/reference/admin-api.md\"},{\"text\":\"状态码\",\"link\":\"/zh-CN/reference/status-code.md\"}]}]}}},\"scrollOffset\":90,\"cleanUrls\":false}")</script>
    
  </body>
</html>