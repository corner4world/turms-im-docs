"use strict";(self.webpackChunkturms_docs=self.webpackChunkturms_docs||[]).push([[378],{7548:(t,d,e)=>{e.r(d),e.d(d,{default:()=>i});const r=(0,e(6252).uE)('<h1 id="配置参数" tabindex="-1"><a class="header-anchor" href="#配置参数" aria-hidden="true">#</a> 配置参数</h1><h2 id="重要性" tabindex="-1"><a class="header-anchor" href="#重要性" aria-hidden="true">#</a> 重要性</h2><p>即时通讯的业务场景繁多，因此不同业务对硬件资源有着<strong>天差地别</strong>的要求（比如：需要数据库的架构与不需要数据库的架构）。 为了有效利用服务器资源，请务必细心了解Turms服务端所提供的配置参数。</p><ul><li><p>场景一：100%的消息可达率 vs 主动抛弃消息</p><ul><li>在社交应用中，一般都会要求消息有100%的可达率。反之，对于在直播聊天室应用中，服务端甚至会专门根据消息优先级与服务端负载，来主动地抛弃用户消息或是把消息只发送给聊天室中的部分用户。</li><li>对于前者，Turms使用Redis来拉取会话级别的递增<code>sequence ID</code>来实现消息的100%必达。对于后者，Turms会根据内存中的消息与服务端负载信息来主动抛弃消息。二者对于消息可达率有着完全不同但又都合理的需求，因此二者的实现对于硬件配置也有着截然不同的要求。</li></ul></li><li><p>场景二：读扩散消息存储 vs 零消息存储</p><ul><li><p>A应用是一款主要面向商务客户的即时通讯应用。这款应用有一个需求：当一名用户在商务群里发送了一条消息，该用户能够得知群组中其他<strong>每一名用户</strong>是否已读该消息，就算该用户发完消息就下线了，当其再次上线时，仍能查询其他人对该消息的已读状态。</p><p>因此，如果一个商务群有100名用户，当其中一名用户发出一条消息时，Turms需要存储1条Message与1条Conversation（Turms采用读扩散消息模型，另外请注意：该条Conversation记录会携带99个群成员的最后已读时间）。</p></li><li><p>B应用是一款直播弹幕聊天应用，它对消息的处理非常随意。当一名用户在一个直播频道发出一条消息后，该用户不仅无需得知其他用户的已读状态，甚至连消息本身都不要求存储（即无离线消息需求）。</p><p>因此，如果一个直播频道有100名，当其中一名用户发出一条消息时，Turms需要存储0条Message与0条Conversation记录。</p></li><li><p>对比A应用需要消息存储功能，而B应用不用。因此在B应用的架构设计中甚至都不要用到存储消息的表（当然，实际应用中一般还是会存储用户消息来做用户行为分析）。因此二者对硬件需求也截然不同。</p></li></ul></li></ul><h2 id="配置分类" tabindex="-1"><a class="header-anchor" href="#配置分类" aria-hidden="true">#</a> 配置分类</h2><p>Turms属性分为三大类配置：Turms Service配置、Turms Gateway配置，以及Common通用配置。Turms Service配置对应turms服务端独有的配置，Turms Gateway配置对应turms-gateway服务端独有的配置，而Common通用配置可以被turms和turms-gateway服务端共用。</p><p>每个类别中的属性都能通过<code>application.yaml</code>配置，并且对于标有<code>MutablePropertiesView</code>注释的属性，您都能通过供管理员专用的API接口在Turms集群运行时进行零停机实时更新。</p><p>由于所有的配置项高达上百个，直接看代码比看文档更加直观，因此推荐您直接查阅<code>im.turms.server.common.property</code>目录下各配置类，下文仅对大的分类做简要介绍。</p><p>提醒：您在本地编译<code>turms/turms-gateway</code>服务端项目后，编译器会生成<code>target/classes/META-INF/spring-configuration-metadata.json</code>文件。IntelliJ IDEA 能够自动检测到该文件，并在您输入Turms相关配置的时提供配置提示与补全功能，如下图所示：</p><p><img src="https://raw.githubusercontent.com/turms-im/assets/master/turms/configuration-code-completion.png" alt=""></p><h3 id="tumrs-service配置" tabindex="-1"><a class="header-anchor" href="#tumrs-service配置" aria-hidden="true">#</a> Tumrs Service配置</h3><table><thead><tr><th>类别</th><th>类</th><th>字段名</th><th>描述</th><th>补充</th></tr></thead><tbody><tr><td>管理员API</td><td>AdminApiProperties</td><td>adminApi</td><td>管理员API接口相关配置</td><td></td></tr><tr><td>客户端API</td><td>ClientApiProperties</td><td>clientApi</td><td>客户端API接口相关配置</td><td></td></tr><tr><td>Fake数据</td><td>FakeProperties</td><td>fake</td><td>Fake数据相关配置</td><td></td></tr><tr><td>数据源</td><td>MongoProperties</td><td>mongo</td><td>MongoDB数据库相关配置</td><td>Turms完全复用MongoDB的URI配置。参考文档：<br>https://docs.mongodb.com/manual/reference/connection-string/</td></tr><tr><td></td><td>TurmsRedisProperties</td><td>redis</td><td>Redis数据库相关配置</td><td></td></tr><tr><td>统计</td><td>StatisticsProperties</td><td>statistics</td><td>统计相关配置</td><td></td></tr><tr><td>通知</td><td>NotificationProperties</td><td>notification</td><td>通知相关配置</td><td></td></tr><tr><td>文件存储</td><td>StorageProperties</td><td>storage</td><td>存储相关配置</td><td></td></tr><tr><td>业务行为</td><td>UserProperties</td><td>user</td><td>用户相关配置</td><td></td></tr><tr><td></td><td>GroupProperties</td><td>group</td><td>群组相关配置</td><td></td></tr><tr><td></td><td>ConversationProperties</td><td>conversation</td><td>消息会话服务相关配置</td><td></td></tr><tr><td></td><td>MessageProperties</td><td>message</td><td>消息服务相关配置</td><td></td></tr></tbody></table><h3 id="turms-gateway配置" tabindex="-1"><a class="header-anchor" href="#turms-gateway配置" aria-hidden="true">#</a> Turms Gateway配置</h3><table><thead><tr><th>类别</th><th>类</th><th>字段名</th><th>描述</th></tr></thead><tbody><tr><td>管理员API</td><td>AddressProperties</td><td>metricsApiAddress</td><td>度量API地址相关配置</td></tr><tr><td>客户端API</td><td>ClientApiProperties</td><td>clientApi</td><td>面向客户端的HTTP接入层相关配置（即ReasonController的相关配置）</td></tr><tr><td></td><td>NotificationLoggingProperties</td><td>notificationLogging</td><td>通知日志相关配置</td></tr><tr><td>服务接口</td><td>UdpProperties</td><td>udp</td><td>UDP服务端相关配置</td></tr><tr><td></td><td>TcpProperties</td><td>tcp</td><td>TCP服务端相关配置</td></tr><tr><td></td><td>WebSocketProperties</td><td>websocket</td><td>WebSocket服务端相关配置</td></tr><tr><td></td><td>DiscoveryProperties</td><td>serviceDiscovery</td><td>服务发现相关配置</td></tr><tr><td>Fake数据</td><td>FakeProperties</td><td>fake</td><td>Fake数据相关配置</td></tr><tr><td>数据源</td><td>MongoProperties</td><td>mongo</td><td>MongoDB数据库相关配置</td></tr><tr><td></td><td>TurmsRedisProperties</td><td>redis</td><td>Redis数据库相关配置</td></tr><tr><td>业务行为</td><td>SimultaneousLoginProperties</td><td>simultaneousLogin</td><td>多端登录相关配置</td></tr><tr><td></td><td>SessionProperties</td><td>session</td><td>会话相关配置</td></tr></tbody></table><h3 id="common通用配置" tabindex="-1"><a class="header-anchor" href="#common通用配置" aria-hidden="true">#</a> Common通用配置</h3><table><thead><tr><th>类</th><th>字段名</th><th>描述</th></tr></thead><tbody><tr><td>ClusterProperties</td><td>cluster</td><td>集群相关配置。包括配置当前运行节点信息、服务发现注册信息、配置中心信息、RPC参数</td></tr><tr><td>HealthCheckProperties</td><td>healthCheck</td><td>监控节点健康状态</td></tr><tr><td>IpProperties</td><td>ip</td><td>公网IP探测相关配置</td></tr><tr><td>LocationProperties</td><td>location</td><td>用户坐标相关配置</td></tr><tr><td>LoggingProperties</td><td>logging</td><td>基础日志配置</td></tr><tr><td>PluginProperties</td><td>plugin</td><td>插件相关配置</td></tr><tr><td>SecurityProperties</td><td>security</td><td>用户与管理员密码加密相关配置</td></tr><tr><td>UserStatusProperties</td><td>userStatus</td><td>用户会话（连接）状态相关配置</td></tr></tbody></table><h2 id="补充" tabindex="-1"><a class="header-anchor" href="#补充" aria-hidden="true">#</a> 补充</h2><h3 id="服务端默认端口号" tabindex="-1"><a class="header-anchor" href="#服务端默认端口号" aria-hidden="true">#</a> 服务端默认端口号</h3><table><thead><tr><th>服务端</th><th>端口</th><th>作用</th></tr></thead><tbody><tr><td>turms-admin</td><td>6510（HTTP）</td><td>提供后台管理员系统的Web页面</td></tr><tr><td>turms-service/turms-gateway</td><td>7510（TCP）</td><td>供turms-service与turms-gateway服务端的RPC使用</td></tr><tr><td>turms-service</td><td>8510（HTTP）</td><td>提供admin API与metrics API</td></tr><tr><td>turms-gateway</td><td>9510（HTTP）</td><td>提供metrics API</td></tr><tr><td>turms-gateway</td><td>10510（WebSocket）</td><td>与客户端交互</td></tr><tr><td>turms-gateway</td><td>11510（TCP）</td><td>与客户端交互（Swift客户端暂不支持）</td></tr><tr><td>turms-gateway</td><td>12510（UDP）</td><td>与客户端交互（客户端均暂不支持）</td></tr></tbody></table>',19),s={},i=(0,e(3744).Z)(s,[["render",function(t,d){return r}]])},3744:(t,d)=>{d.Z=(t,d)=>{for(const[e,r]of d)t[e]=r;return t}},7122:(t,d,e)=>{e.r(d),e.d(d,{data:()=>r});const r={key:"v-f64fc224",path:"/for-developers/config.html",title:"配置参数",lang:"en-US",frontmatter:{},excerpt:"",headers:[{level:2,title:"重要性",slug:"重要性",children:[]},{level:2,title:"配置分类",slug:"配置分类",children:[{level:3,title:"Tumrs Service配置",slug:"tumrs-service配置",children:[]},{level:3,title:"Turms Gateway配置",slug:"turms-gateway配置",children:[]},{level:3,title:"Common通用配置",slug:"common通用配置",children:[]}]},{level:2,title:"补充",slug:"补充",children:[{level:3,title:"服务端默认端口号",slug:"服务端默认端口号",children:[]}]}],filePathRelative:"for-developers/config.md",git:{updatedTime:1641202602e3}}}}]);